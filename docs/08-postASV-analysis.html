<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title> Workflow part III: Analyzing ASV Data</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>


<link rel="stylesheet" href="my.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Microbiomics Workshop</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home"></span>
     
    Overview
  </a>
</li>
<li>
  <a href="00-setup.html">
    <span class="fas fa-gear"></span>
     
     Setup
  </a>
</li>
<li>
  <a href="09-references.html">
    <span class="fas fa-info-circle"></span>
     
     References
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Day 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lectures:</li>
    <li>
      <a href="01-microbiomics.html">Intro to Metabarcoding</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Lecture/Code-along:</li>
    <li>
      <a href="02-shell.html">Intro to the Shell</a>
    </li>
    <li>
      <a href="03-OSC.html">Intro to OSC</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Day 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture/Code-along:</li>
    <li>
      <a href="06-R.html">Intro to R</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Workflow Sessions:</li>
    <li>
      <a href="04-data-overview.html">Overview</a>
    </li>
    <li>
      <a href="05-preprocess-reads.html">I: Adapter and Primer Removal</a>
    </li>
    <li>
      <a href="07-ASV-inference.html">II: ASV Inference</a>
    </li>
    <li>
      <a href="08-postASV-analysis.html">III: ASV Analysis</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mcic-osu/2020-12-microbiomics-workshop.git">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><br>Workflow part III:<br>Analyzing ASV Data</h1>

</div>


<p><br></p>
<hr />
<div id="goals" class="section level2">
<h2>Goals</h2>
<p>Analyze microbiome experimental data as a phyloseq object - explore ecological metrics and identify differentially abundant taxa.</p>
<hr />
</div>
<div id="before-we-get-started" class="section level2">
<h2>Before We Get Started</h2>
<div id="notes" class="section level3">
<h3>Notes</h3>
<ul>
<li><p>This is a slightly modified version of a document created by <a href="mailto:willman.18@osu.edu">Matthew Willman</a>.</p></li>
<li><p>To convert an <code>Rmd</code> (R Markdown) file to an R script, type the following in an R console: <code>knitr::purl(input="&lt;filename&gt;.Rmd")</code>. (You can download this <code>Rmd</code> file by clicking the <code>Code</code> button in the top-right of this page – but we will open it at OSC.)</p></li>
<li><p>This document deliberately does not have any R output. In case you want to check your output against a reference, you can find a document with R output <a href="assets/08-postASV-analysis.html">here</a>.</p></li>
</ul>
</div>
<div id="open-this-file-in-rstudio-server-at-osc" class="section level3">
<h3>Open this file in RStudio Server at OSC</h3>
<ul>
<li><p>This assumes you still have an active RStudio Server job at OSC; if not see the <a href="07-ASV-inference.html#start-an-rstudio-server-job-at-osc">instructions on the previous page</a> to start one.</p></li>
<li><p>In the Files pane, in the <code>markdown</code> directory, open the file <code>08-postASV-analysis.Rmd</code>. That’s this file!</p></li>
</ul>
<hr />
</div>
</div>
<div id="getting-started" class="section level2">
<h2>Getting Started</h2>
<div id="install-and-load-packages" class="section level3">
<h3>Install and Load Packages</h3>
<p>Add our custom library again if you restarted your R session:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">.libPaths</span>(<span class="dt">new =</span> <span class="st">&#39;/fs/project/PAS0471/.R/4.0/&#39;</span>)</span></code></pre></div>
<p>And load the necessary packages:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>packages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;tidyverse&#39;</span>, <span class="st">&#39;vegan&#39;</span>, <span class="st">&#39;phyloseq&#39;</span>, <span class="st">&#39;decontam&#39;</span>, <span class="st">&#39;ape&#39;</span>,</span>
<span id="cb2-2"><a href="#cb2-2"></a>              <span class="st">&#39;DESeq2&#39;</span>, <span class="st">&#39;microbiome&#39;</span>, <span class="st">&#39;metagenomeSeq&#39;</span>, <span class="st">&#39;remotes&#39;</span>,</span>
<span id="cb2-3"><a href="#cb2-3"></a>              <span class="st">&#39;ampvis2&#39;</span>, <span class="st">&#39;breakaway&#39;</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(<span class="dt">char =</span> packages)</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co"># If you wanted to install and load these packages yourself,</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># first make sure you have the pacman package installed:</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">## install.packages(&#39;pacman&#39;)</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co"># Then, the code above would work except for the last two packages,</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co"># which are available from Github only. To install these, you would run:</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">## remotes::install_github(&quot;MadsAlbertsen/ampvis2&quot;)</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">## remotes::install_github(&quot;adw96/breakaway&quot;)</span></span></code></pre></div>
</div>
<div id="set-directories" class="section level3">
<h3>Set Directories</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Dir with input files:</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>indir &lt;-<span class="st"> &#39;analysis/ASV_inference/&#39;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># Dir for output:</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>outdir &lt;-<span class="st"> &#39;analysis/postASV_analysis/&#39;</span></span></code></pre></div>
</div>
<div id="load-the-data" class="section level3">
<h3>Load the Data</h3>
<p>This session starts with a <em>phyloseq</em> object similar to the one generated using <em>DADA2</em> in the <a href="06-reads-to-ASV.Rmd">previous session</a>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>ps_raw &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">file.path</span>(indir, <span class="st">&#39;ps_16S_V4_withtree.rds&#39;</span>))</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># This would load the object from the previous session, which doesn&#39;t contain a tree:</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># ps_raw &lt;- readRDS(file.path(indir, &#39;ps_V4.rds&#39;))</span></span></code></pre></div>
<p>Our <em>phyloseq</em> object is made up of the following components (slots):</p>
<ul>
<li><code>otu_table</code></li>
<li><code>sample_data</code></li>
<li><code>tax_table</code></li>
<li><code>phy_tree</code></li>
</ul>
<p>Let’s have a look at the object:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>ps_raw</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># And the assigned taxon names:</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">taxa_names</span>(ps_raw)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span></code></pre></div>
<p>As we can see, the taxon names are currently the associated sequences. We can create a new <em>phyloseq</em> component to store these sequences, then rename the ASVs so something shorter (“ASV_1”, “ASV_2”, etc.).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>dna &lt;-<span class="st"> </span>Biostrings<span class="op">::</span><span class="kw">DNAStringSet</span>(<span class="kw">taxa_names</span>(ps_raw))</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">names</span>(dna) &lt;-<span class="st"> </span><span class="kw">taxa_names</span>(ps_raw)</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># Merge sequence object into the phyloseq object:</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>ps_raw &lt;-<span class="st"> </span><span class="kw">merge_phyloseq</span>(ps_raw, dna)</span>
<span id="cb6-6"><a href="#cb6-6"></a>ps_raw</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co"># Rename ASVs:</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="kw">taxa_names</span>(ps_raw) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;ASV&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">ntaxa</span>(ps_raw), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="kw">taxa_names</span>(ps_raw)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span></code></pre></div>
<hr />
</div>
</div>
<div id="filter-taxa" class="section level2">
<h2>Filter taxa</h2>
<div id="identify-and-remove-contaminants" class="section level3">
<h3>Identify and Remove Contaminants</h3>
<p>It is possible to introduce contaminating microbes during sample preparation. Before analyzing the data, we will identify and remove probable contaminants using the <a href="https://benjjneb.github.io/decontam/vignettes/decontam_intro.html">decontam package</a>.</p>
<p>In this case, we will define a conataminant as an ASV whose abundance correlates with DNA concentration (post-PCR). Our assumption here is that each soil taxon’s abundance should be independant of DNA concentration. However, if we were to spike each sample with a contaminant, that contaminant would show a greater abundance in samples with lower DNA concentrations. To do this, we need DNA concentration measured after PCR and before pooling of the samples.</p>
<p>These data are in column 7 of the sample data component:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">head</span>(<span class="kw">sample_data</span>(ps_raw))</span></code></pre></div>
<p>MCIC measured our DNA concentration by comparing band intensities to a single reference band. MCIC’s DNA concentration measurements range from 0 to 1 (the reference). Zero in this case is coded as <code>NA</code>. The <em>decontam</em> package can’t handle NA’s or 0’s, so we need to change them to a small value (e.g. 0.01).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># First, we identify the NAs in the DNA measurement column:</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>NAs &lt;-<span class="st"> </span><span class="kw">is.na</span>(<span class="kw">sample_data</span>(ps_raw)<span class="op">$</span>PCR_prod_V4.V5)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># Then, we replace NAs with 0.01:</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="kw">sample_data</span>(ps_raw)<span class="op">$</span>PCR_prod_V4.V5[NAs] &lt;-<span class="st"> </span><span class="fl">0.01</span></span></code></pre></div>
<p>We will use <code>decontam::isContaminant(method = "frequency")</code> to test each taxon against the null hypothesis: abundance is not associated with DNA concentration. Because the DNA concentration measurements are not very accurate, and we want to make sure to remove possible contaminants, we use a relaxed p-value (0.2) to reject the null hypothesis:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>contam_df_freq &lt;-<span class="st"> </span><span class="kw">isContaminant</span>(ps_raw,</span>
<span id="cb9-2"><a href="#cb9-2"></a>                                <span class="dt">method =</span> <span class="st">&quot;frequency&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3"></a>                                <span class="dt">conc =</span> <span class="st">&quot;PCR_prod_V4.V5&quot;</span>,</span>
<span id="cb9-4"><a href="#cb9-4"></a>                                <span class="dt">threshold =</span> <span class="fl">0.2</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="kw">head</span>(contam_df_freq)</span></code></pre></div>
<p>As we can see, the top 3 ASVs are identified as probable contaminants. How many contaminants were identified (<code>TRUE</code> in the <code>contaminant</code> column) in total?</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">table</span>(contam_df_freq<span class="op">$</span>contaminant)</span></code></pre></div>
<p>What are the most abundant contaminant taxa?</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Get abundance ranks for contaminant ASVs:</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">head</span>(<span class="kw">which</span>(contam_df_freq<span class="op">$</span>contaminant))</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># Check which taxa are contaminants:</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>ps_contam &lt;-<span class="st"> </span><span class="kw">prune_taxa</span>(contam_df_freq<span class="op">$</span>contaminant, ps_raw)</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="kw">head</span>(<span class="kw">tax_table</span>(ps_contam))</span></code></pre></div>
<p>Let’s take a look at our tested associations for several taxa:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">plot_frequency</span>(ps_raw,</span>
<span id="cb12-2"><a href="#cb12-2"></a>               <span class="kw">taxa_names</span>(ps_raw)[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">11</span>)],</span>
<span id="cb12-3"><a href="#cb12-3"></a>               <span class="dt">conc =</span> <span class="st">&quot;PCR_prod_V4.V5&quot;</span>) <span class="op">+</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;DNA Concentration (relative to single marker)&quot;</span>)</span></code></pre></div>
<p>As we can see, abundance of ASVs 1, 2, 3, and 11 are particularly high in samples with low DNA concentration.</p>
<p>Which samples have highest abundances of the contaminants?</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>asv1 &lt;-<span class="st"> </span><span class="kw">otu_table</span>(ps_raw)[, <span class="dv">1</span>]</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">head</span>(asv1[<span class="kw">order</span>(asv1, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)])</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a>asv2 &lt;-<span class="st"> </span><span class="kw">otu_table</span>(ps_raw)[, <span class="dv">2</span>]</span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="kw">head</span>(asv2[<span class="kw">order</span>(asv2, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)])</span></code></pre></div>
<p>How do these contaminants overlap with ASVs present in the negative control?</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">otu_table</span>(ps_raw)[<span class="dv">70</span><span class="op">:</span><span class="dv">75</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">11</span>]</span></code></pre></div>
<p>ASVs have high read counts in the extraction negative control. Thus, we can be fairly certain these are contaminants and not representative of our experimental samples.</p>
<p>Remove the contaminants that we identified:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>ps_noncontam &lt;-<span class="st"> </span><span class="kw">prune_taxa</span>(<span class="op">!</span>contam_df_freq<span class="op">$</span>contaminant, ps_raw)</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>ps_noncontam</span></code></pre></div>
<p>What proportion of our count data were removed as contaminants?</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>pre &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">sample_sums</span>(ps_raw))</span>
<span id="cb16-2"><a href="#cb16-2"></a>post &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">sample_sums</span>(ps_noncontam))</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a>(pre<span class="op">-</span>post) <span class="op">/</span><span class="st"> </span>pre</span></code></pre></div>
</div>
<div id="remove-non-bacterial-non-archaeal-asvs" class="section level3">
<h3>Remove non-bacterial, non-archaeal ASVs</h3>
<p>The V4 region of 16S rRNA is conserved within certain bacteria, archaea, chloroplasts, mitochondria, and eukaryotes. Since we are only interested in bacteria and archaea here, we’ll need to remove other taxa from our object.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Create ps subsets for chloroplast, mitochondria, and eukaryotes:</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>chlr &lt;-<span class="st"> </span><span class="kw">subset_taxa</span>(ps_noncontam, Order <span class="op">==</span><span class="st"> &quot;Chloroplast&quot;</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a>mit &lt;-<span class="st"> </span><span class="kw">subset_taxa</span>(ps_noncontam, Family <span class="op">==</span><span class="st"> &quot;Mitochondria&quot;</span>)</span>
<span id="cb17-4"><a href="#cb17-4"></a>euk &lt;-<span class="st"> </span><span class="kw">subset_taxa</span>(ps_noncontam, Kingdom <span class="op">==</span><span class="st"> &quot;Eukaryota&quot;</span>)</span>
<span id="cb17-5"><a href="#cb17-5"></a></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="co"># Get all taxon IDs that we want to remove:</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>bad_taxa &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">taxa_names</span>(chlr), <span class="kw">taxa_names</span>(mit), <span class="kw">taxa_names</span>(euk))</span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co"># Get all taxon IDs that we want to keep:</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>all_taxa &lt;-<span class="st"> </span><span class="kw">taxa_names</span>(ps_noncontam)</span>
<span id="cb17-11"><a href="#cb17-11"></a>good_taxa &lt;-<span class="st"> </span>all_taxa[<span class="op">!</span>(all_taxa <span class="op">%in%</span><span class="st"> </span>bad_taxa)]</span>
<span id="cb17-12"><a href="#cb17-12"></a></span>
<span id="cb17-13"><a href="#cb17-13"></a><span class="co"># Subset phyloseq object:</span></span>
<span id="cb17-14"><a href="#cb17-14"></a>ps_bac_arc &lt;-<span class="st"> </span><span class="kw">prune_taxa</span>(good_taxa, ps_noncontam)</span></code></pre></div>
<p>What proportion of ASVs were kept?</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>pre &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">sample_sums</span>(ps_noncontam))</span>
<span id="cb18-2"><a href="#cb18-2"></a>post &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">sample_sums</span>(ps_bac_arc))</span>
<span id="cb18-3"><a href="#cb18-3"></a>post <span class="op">/</span><span class="st"> </span>pre</span></code></pre></div>
<p>Finally, we’ll also remove non-experimental samples (e.g. negative controls). Note, though, that non-experimental samples are important for evaluating the quality of your reagents, consistency across sequencing runs, and contamination.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>ps &lt;-<span class="st"> </span><span class="kw">subset_samples</span>(ps_bac_arc, Experiment <span class="op">==</span><span class="st"> &quot;HCC&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>ps</span></code></pre></div>
<hr />
</div>
</div>
<div id="filter-samples" class="section level2">
<h2>Filter samples</h2>
<p>After having filtered out unwanted taxa, we now need to filter out uninformative samples – those with low total taxon counts.</p>
<p>First, how many counts do we have for each sample?</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>sums &lt;-<span class="st"> </span><span class="kw">sample_sums</span>(ps)</span>
<span id="cb20-2"><a href="#cb20-2"></a>sums[<span class="kw">order</span>(sums)]</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co"># Lowest total count:</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="kw">min</span>(sums)</span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co"># Sample with lowest counts:</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="kw">names</span>(sums[<span class="kw">order</span>(sums)][<span class="dv">1</span>])</span></code></pre></div>
<p>To remove uninformative samples, we will only keep those with over 1,000 counts. We will also remove a technical replicate, though note that technical replicates are important for quality control of runs and for understanding the reproducibility of the methodology.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Remove samples with low counts:</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>ps &lt;-<span class="st"> </span><span class="kw">subset_samples</span>(ps, <span class="kw">sample_sums</span>(ps) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1000</span>)</span>
<span id="cb21-3"><a href="#cb21-3"></a></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co"># Remove the technical replicate:</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>ps &lt;-<span class="st"> </span><span class="kw">subset_samples</span>(ps, SampleID <span class="op">!=</span><span class="st"> &quot;501S4&quot;</span>)</span></code></pre></div>
<p>Let’s take a look at our current <code>phyloseq</code> object:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">sample_data</span>(ps)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="kw">head</span>(<span class="kw">t</span>(<span class="kw">otu_table</span>(ps)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]))</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="kw">head</span>(<span class="kw">tax_table</span>(ps))</span></code></pre></div>
<hr />
</div>
<div id="normalization" class="section level2">
<h2>Normalization</h2>
<p>Normalization is currently a much-discussed issue of microbiome studies. Differences in read depth between samples often need to be corrected before analysis. Several normalization methods have been proposed, and no single method is perfect. It may be that the most appropriate method depends on the analysis.</p>
<p>In this tutorial, we will use:</p>
<ul>
<li><p>Proportion-normalized data to estimate ecological metrics.</p></li>
<li><p>Stabilizing transformation normalized data to identify differentially abundant taxa.</p></li>
</ul>
<p>However, for your reference, we will also present code for two other normalization methods: rarefaction and cumulative sum scaling.</p>
<p>For more details, read <a href="https://dx.plos.org/10.1371/journal.pcbi.1003531">McMurdie and Holmes 2014</a> and <a href="http://doi.wiley.com/10.1111/2041-210X.13115">McKnight et al. 2019</a>.</p>
<hr />
<div id="proportion-normalization" class="section level3">
<h3>Proportion Normalization</h3>
<p>Proportion normalization involves dividing each OTU count by the total sum for each sample. The resulting count data will add up to 1 (100%) for each sample.</p>
<p>The <code>microbiome::transform</code> function can be used to easily normalize count data as proportions in a <em>phyloseq</em> object:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Proportion normalization:</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>ps_prop &lt;-<span class="st"> </span><span class="kw">transform</span>(ps, <span class="st">&quot;compositional&quot;</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co"># Have a look at the resulting OTU table:</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="kw">otu_table</span>(ps_prop)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co"># Check what the sums for each sample are now:</span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="kw">head</span>(<span class="kw">sample_sums</span>(ps_prop))</span></code></pre></div>
<hr />
</div>
<div id="variance-stabilizing-transformation" class="section level3">
<h3>Variance stabilizing transformation</h3>
<p>This transformation method, available in <a href="https://bioconductor.org/packages/release/workflows/vignettes/rnaseqGene/inst/doc/rnaseqGene.html">DESeq2</a>, normalizes data with respect to library size as well as dispersion.<br />
Type <code>?vst</code> or read <a href="http://dx.doi.org/10.1186/gb-2010-11-10-r106">Anders and Huber 2010</a> for more information.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># First we convert the phyloseq object to a DESeq object:</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>dds &lt;-<span class="st"> </span><span class="kw">phyloseq_to_deseq2</span>(ps, <span class="op">~</span><span class="dv">1</span>)</span>
<span id="cb24-3"><a href="#cb24-3"></a></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co"># Then we estimate the size factors:</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>dds &lt;-<span class="st"> </span><span class="kw">estimateSizeFactors</span>(dds)</span>
<span id="cb24-6"><a href="#cb24-6"></a></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="co"># Now can do the transformation:</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>dds_vst &lt;-<span class="st"> </span><span class="kw">vst</span>(dds, <span class="dt">blind =</span> <span class="ot">TRUE</span>)</span>
<span id="cb24-9"><a href="#cb24-9"></a></span>
<span id="cb24-10"><a href="#cb24-10"></a><span class="co"># Have a look at the resulting counts:</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>vst_counts &lt;-<span class="st"> </span><span class="kw">assay</span>(dds_vst)</span>
<span id="cb24-12"><a href="#cb24-12"></a><span class="kw">t</span>(vst_counts)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span></code></pre></div>
<hr />
</div>
<div id="rarefaction" class="section level3">
<h3>Rarefaction</h3>
<p>Rarefaction can be used to subset data such that the library depth is the same for each sample. Because sampling of the data is random, rarefaction can account for an effect of total read count on taxa richness. However, rarefaction is no longer considered to be a good way to normalize amplicon sequencing data (see <a href="https://dx.plos.org/10.1371/journal.pcbi.1003531">McMurdie &amp; Holmes 2014</a>).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>ps_rarefied &lt;-<span class="st"> </span><span class="kw">rarefy_even_depth</span>(ps,</span>
<span id="cb25-2"><a href="#cb25-2"></a>                                 <span class="dt">rngseed =</span> <span class="dv">1</span>,</span>
<span id="cb25-3"><a href="#cb25-3"></a>                                 <span class="dt">sample.size =</span> <span class="kw">min</span>(<span class="kw">sample_sums</span>(ps)),</span>
<span id="cb25-4"><a href="#cb25-4"></a>                                 <span class="dt">replace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb25-5"><a href="#cb25-5"></a></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="co"># Have a look at the result:</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="kw">otu_table</span>(ps_rarefied)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb25-8"><a href="#cb25-8"></a></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="kw">head</span>(<span class="kw">sample_sums</span>(ps_rarefied))</span></code></pre></div>
<p>Compare these sample sums to the non-rarified data sums:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">head</span>(<span class="kw">sample_sums</span>(ps))</span></code></pre></div>
<hr />
</div>
<div id="cumulative-sum-scaling" class="section level3">
<h3>Cumulative Sum Scaling</h3>
<p>The <em>metagenomeSeq</em> Cumulative Sum Scaling (CSS) normalization is another option developed for microbiome data. For more information, read <a href="http://www.nature.com/articles/nmeth.2658">Paulson et al. 2013</a>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Convert the phyloseq object to a metagenomeseq object:</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>mgs_css &lt;-<span class="st"> </span><span class="kw">phyloseq_to_metagenomeSeq</span>(ps)</span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co"># Perform the Cumulative Sum Scaling:</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>mgs_css &lt;-<span class="st"> </span><span class="kw">cumNorm</span>(mgs_css)</span>
<span id="cb27-6"><a href="#cb27-6"></a></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="co"># Extract the counts and add them to a separate phyloseq object:</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>css_counts &lt;-<span class="st"> </span><span class="kw">MRcounts</span>(mgs_css, <span class="dt">norm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb27-9"><a href="#cb27-9"></a>ps_css &lt;-<span class="st"> </span>ps</span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="kw">otu_table</span>(ps_css) &lt;-<span class="st"> </span><span class="kw">otu_table</span>(<span class="kw">t</span>(css_counts), <span class="dt">taxa_are_rows =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>Now lets compare the original data to the CSS normalized data:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">otu_table</span>(ps)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="kw">head</span>(<span class="kw">sample_sums</span>(ps))</span>
<span id="cb28-3"><a href="#cb28-3"></a></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="kw">otu_table</span>(ps_css)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="kw">head</span>(<span class="kw">sample_sums</span>(ps_css))</span></code></pre></div>
<hr />
</div>
</div>
<div id="plot-abundances" class="section level2">
<h2>Plot abundances</h2>
<p>In this and following the examples we will use the <strong>proportions</strong> data.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Subset to the T1 treatment</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>T1 &lt;-<span class="st"> </span><span class="kw">subset_samples</span>(ps_prop, Treatment <span class="op">==</span><span class="st"> &quot;T1&quot;</span>)</span>
<span id="cb29-3"><a href="#cb29-3"></a></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="co"># Agglomerate taxa to phylum level:</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>T1_phylum &lt;-<span class="st"> </span><span class="kw">tax_glom</span>(T1, <span class="dt">taxrank =</span> <span class="st">&quot;Phylum&quot;</span>, <span class="dt">NArm =</span> <span class="ot">FALSE</span>)</span>
<span id="cb29-6"><a href="#cb29-6"></a></span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="co"># Remove uncommon phyla:</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>T1_phylum &lt;-<span class="st"> </span><span class="kw">subset_taxa</span>(T1_phylum, <span class="kw">taxa_sums</span>(T1_phylum) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.1</span>)</span>
<span id="cb29-9"><a href="#cb29-9"></a></span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="co"># Plot:</span></span>
<span id="cb29-11"><a href="#cb29-11"></a><span class="kw">plot_bar</span>(T1_phylum, <span class="dt">fill =</span> <span class="st">&quot;Phylum&quot;</span>) <span class="op">+</span></span>
<span id="cb29-12"><a href="#cb29-12"></a><span class="st">   </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Timepoint, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<hr />
</div>
<div id="alpha-diversity" class="section level2">
<h2>Alpha diversity</h2>
<p>Alpha diversity measures taxonomic diversity within a single population. Measures of alpha diversity include taxonomic richness (i.e. number of taxa), and indices which combine taxonomic richness with some measure of evenness.</p>
<p><em>Note:</em> Many of these methods are greatly influenced by singleton data (i.e. taxa represented by a single count), meaning they may be unreliable if your data excludes singletons. DADA2 does not output singletons if it is run individually on each sample. Thus, if using dada2 to infer ASVs, it is advisable to use <code>pool = TRUE</code> when running the dada algorithm. This will allow calling per-sample singletons, but not per-study singletons.</p>
<div id="taxonomic-richness-rarefaction-plot" class="section level3">
<h3>Taxonomic richness: Rarefaction plot</h3>
<p>Our goal in defining richness is to determine the number of unique taxa within each population (in our case, each plot). This is difficult, as our samples contain only a portion of the total richness within our plots. As sequence depth increases for each sample, so does the number of taxa. This can be illustrated with a rarefaction plot.</p>
<p>To make a rarefaction plot, we draw random samples from our data and count the number of unique ASVs as samples are drawn. The resulting rarefaction curve is expected to rise quickly then plateu as the most abundant taxa are represented. We can make a quick rarefaction curve plot directly from our <code>phyloseq</code> object of all samples using the <a href="https://peat-clark.github.io/BIO381/veganTutorial.html"><code>vegan</code> package</a>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">rarecurve</span>(<span class="kw">otu_table</span>(ps), <span class="dt">step =</span> <span class="dv">500</span>, <span class="dt">xlab =</span> <span class="st">&quot;Sample Size&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Taxa&quot;</span>)</span></code></pre></div>
<p>We can also split rarefaction curves by group using the <a href="https://madsalbertsen.github.io/ampvis2/articles/ampvis2.html"><code>ampvis2</code> package</a>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>metadata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">sample_data</span>(ps), <span class="dt">check.names =</span> <span class="ot">FALSE</span>)</span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a>asv_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(<span class="kw">otu_table</span>(ps)),</span>
<span id="cb31-4"><a href="#cb31-4"></a>                       <span class="kw">tax_table</span>(ps),</span>
<span id="cb31-5"><a href="#cb31-5"></a>                       <span class="dt">check.names =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><code>ampvis2</code> requires a <code>Species</code> column, which must be added to our data. If your table already has a <code>Species</code> column, skip this step:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>asv_table<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="ot">NA</span></span></code></pre></div>
<p>Load an <code>ampvis2</code> object and calculate rarefaction:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>ps3 &lt;-<span class="st"> </span><span class="kw">amp_load</span>(asv_table, metadata)</span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a>rar_plot &lt;-<span class="st"> </span><span class="kw">amp_rarecurve</span>(ps3,</span>
<span id="cb33-4"><a href="#cb33-4"></a>                          <span class="dt">stepsize =</span> <span class="dv">100</span>,</span>
<span id="cb33-5"><a href="#cb33-5"></a>                          <span class="dt">facet_by =</span> <span class="st">&quot;Timepoint&quot;</span>,</span>
<span id="cb33-6"><a href="#cb33-6"></a>                          <span class="dt">color_by =</span> <span class="st">&quot;Treatment&quot;</span>) <span class="op">+</span></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="st">   </span><span class="kw">ylab</span>(<span class="st">&quot;Number of observed ASVs&quot;</span>)</span>
<span id="cb33-8"><a href="#cb33-8"></a></span>
<span id="cb33-9"><a href="#cb33-9"></a>rar_plot</span></code></pre></div>
<p>As we can see, as read depth increases for each sample, so does taxonomic richness. In all samples, increased sampling would result in increased richness. Thus, our observed sample richness is lower than the true population richness for every plot.</p>
<p>Further, sequence depth and total richness appear to be correlated across samples:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>dp_by_asv &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ct_sums =</span> <span class="kw">sample_sums</span>(ps),</span>
<span id="cb34-2"><a href="#cb34-2"></a>                        <span class="dt">asvs =</span> <span class="kw">rowSums</span>(<span class="kw">otu_table</span>(ps) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>))</span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dp_by_asv) <span class="op">+</span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span>  ct_sums, <span class="dt">y =</span> asvs)) <span class="op">+</span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Sequence depth&quot;</span>, <span class="dt">y=</span> <span class="st">&quot;ASV count&quot;</span>) <span class="op">+</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p>We can test whether this correlation is significant:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>cor &lt;-<span class="st"> </span><span class="kw">cor.test</span>(dp_by_asv<span class="op">$</span>ct_sums, dp_by_asv<span class="op">$</span>asvs, <span class="dt">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a>cor</span></code></pre></div>
<p>Here we observe a significant correlation between read count and observed taxonomic richness.</p>
<p>Thus, a sample from a population with high actual diversity, but low read depth, could have low observed richness. Fortunately, there are methods to estimate the number of unobserved taxa. For an overview of these methods, read <a href="http://www.annualreviews.org/doi/10.1146/annurev-statistics-022513-115654">Bunge et al. 2014</a>.</p>
</div>
<div id="frequency-counts" class="section level3">
<h3>Frequency counts</h3>
<p>To illustrate the difficulty of estimating population richness and importance of singletons to alpha diversity metrics, we’ll look at the frequency count distribution for our first sample: 101-S1.</p>
<p>We’ll count the number of singletons, doubletons, etc., then plot frequency as a function of count.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Get the frequency count distribution for the 1st sample:</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>frequencytablelist &lt;-<span class="st"> </span><span class="kw">build_frequency_count_tables</span>(<span class="kw">otu_table</span>(ps))</span>
<span id="cb36-3"><a href="#cb36-3"></a>freq_ct &lt;-<span class="st"> </span>frequencytablelist[[<span class="dv">1</span>]]</span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="kw">colnames</span>(freq_ct) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Frequency&quot;</span>, <span class="st">&quot;Count&quot;</span>)</span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="co"># Plot:</span></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="kw">ggplot</span>(freq_ct, <span class="kw">aes</span>(Frequency, Count)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb36-8"><a href="#cb36-8"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">600</span>, <span class="dt">by =</span> <span class="dv">50</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb36-10"><a href="#cb36-10"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;101-S1&quot;</span>) <span class="op">+</span></span>
<span id="cb36-11"><a href="#cb36-11"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p>We can see there are ~3,200 taxa represented as singletons, and ~1,600 taxa as doubletons. This is a high proportion of the total number taxa are observed in this sample:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># Total number of taxa:</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="kw">sum</span>(freq_ct<span class="op">$</span>Count)</span>
<span id="cb37-3"><a href="#cb37-3"></a></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="co"># Proportion of singletons</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>freq_ct<span class="op">$</span>Count[<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(freq_ct<span class="op">$</span>Count)</span></code></pre></div>
<p>How many more taxa might we observe if we increased our sampling?</p>
</div>
<div id="diversity-indices" class="section level3">
<h3>Diversity Indices</h3>
<p>We can use several indices to explore how evenly species are distributed within each sample. Note that ‘Observed’ is the sample taxonomic richness. The other three indices combine richness and abundance data for each taxon.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">plot_richness</span>(ps,</span>
<span id="cb38-2"><a href="#cb38-2"></a>              <span class="dt">x =</span> <span class="st">&quot;Timepoint&quot;</span>,</span>
<span id="cb38-3"><a href="#cb38-3"></a>              <span class="dt">shape =</span> <span class="st">&quot;Treatment&quot;</span>,</span>
<span id="cb38-4"><a href="#cb38-4"></a>              <span class="dt">color =</span> <span class="st">&quot;Treatment&quot;</span>, </span>
<span id="cb38-5"><a href="#cb38-5"></a>              <span class="dt">measures =</span> <span class="kw">c</span>(<span class="st">&quot;Observed&quot;</span>, <span class="st">&quot;Shannon&quot;</span>, <span class="st">&quot;Simpson&quot;</span>, <span class="st">&quot;InvSimpson&quot;</span>))</span></code></pre></div>
<p>Notice that several T2:S3 samples have low measures, suggesting they have low diversity (i.e. abundances are dominated by a few taxa) compared to the other samples.</p>
<hr />
</div>
</div>
<div id="beta-diversity" class="section level2">
<h2>Beta diversity</h2>
<p>Beta diversity measures differences in microbial compositions between populations. If available (use ps_16S_V4_withtree.rds), we can use a phylogenetic tree and otu table to estimate the <a href="https://doi.org/10.1128/AEM.71.12.8228-8235.2005">UniFrac</a> for each sample pair.</p>
<p>The result is a distance matrix with height and width equal to the number of samples. UniFrac may be <a href="https://doi.org/10.1128/AEM.01996-06">weighted or unweighted</a>. Selection of weighted or unweighted will depend on the question you want to answer. Unweighted UniFrac uses only presence or absence of a taxon from the otu table (i.e. 1000 will be treated the same as 1). It is appropriate if you want to test qualitative taxa differences between samples. Weighted UniFrac uses presence as well as quantity data (i.e. 1 &lt; 1000).</p>
<p>We are interested to know what changes to taxon abundance may be driven by our treatments, so we will use weighted UniFrac.</p>
<div id="ordination" class="section level3">
<h3>Ordination</h3>
<p>First we’ll make a weighted UniFrac distance matrix. For UniFrac, you require a tree as part of your <em>phyloseq</em> object.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="kw">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb39-2"><a href="#cb39-2"></a>wUF &lt;-<span class="st"> </span>phyloseq<span class="op">::</span><span class="kw">distance</span>(ps_prop, <span class="dt">method =</span> <span class="st">&quot;wunifrac&quot;</span>)</span>
<span id="cb39-3"><a href="#cb39-3"></a></span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="kw">as.matrix</span>(wUF)[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</span>
<span id="cb39-5"><a href="#cb39-5"></a></span>
<span id="cb39-6"><a href="#cb39-6"></a><span class="co"># Note: If your *phyloseq* object lacks a phylogenetic tree,</span></span>
<span id="cb39-7"><a href="#cb39-7"></a><span class="co"># you could use a dissimilarity index that does not require one, such as Bray-Curtis:</span></span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="co"># bray &lt;- vegan::vegdist(otu_table(ps_prop), method = &quot;bray&quot;)</span></span>
<span id="cb39-9"><a href="#cb39-9"></a><span class="co"># as.matrix(bray)[1:6,1:6]</span></span></code></pre></div>
<p>Then perform Principal Coordinate Analysis (PCoA) on your favorite distance matrix. In this case, we are using weighted UniFrac.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>do &lt;-<span class="st"> </span><span class="kw">ordinate</span>(ps_prop, <span class="dt">method =</span> <span class="st">&quot;PCoA&quot;</span>, <span class="dt">distance =</span> wUF)</span>
<span id="cb40-2"><a href="#cb40-2"></a></span>
<span id="cb40-3"><a href="#cb40-3"></a>baseplot &lt;-<span class="st"> </span><span class="kw">plot_ordination</span>(ps_prop, do,</span>
<span id="cb40-4"><a href="#cb40-4"></a>                            <span class="dt">type =</span> <span class="st">&quot;samples&quot;</span>,</span>
<span id="cb40-5"><a href="#cb40-5"></a>                            <span class="dt">color =</span> <span class="st">&quot;Treatment&quot;</span>,</span>
<span id="cb40-6"><a href="#cb40-6"></a>                            <span class="dt">shape =</span> <span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></span>
<span id="cb40-7"><a href="#cb40-7"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;HCC ordination, all samples</span><span class="ch">\n</span><span class="st">method=PCoA, distance=weighted UniFrac&quot;</span>) <span class="op">+</span></span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span>
<span id="cb40-9"><a href="#cb40-9"></a></span>
<span id="cb40-10"><a href="#cb40-10"></a><span class="co"># Single plot with all samples:</span></span>
<span id="cb40-11"><a href="#cb40-11"></a>baseplot <span class="op">+</span></span>
<span id="cb40-12"><a href="#cb40-12"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>)</span>
<span id="cb40-13"><a href="#cb40-13"></a>  </span>
<span id="cb40-14"><a href="#cb40-14"></a><span class="co"># Idem, but with sample names on the plot: </span></span>
<span id="cb40-15"><a href="#cb40-15"></a>baseplot <span class="op">+</span></span>
<span id="cb40-16"><a href="#cb40-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb40-17"><a href="#cb40-17"></a><span class="st">  </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">label =</span> SampleID), <span class="dt">size =</span> <span class="fl">3.5</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb40-18"><a href="#cb40-18"></a></span>
<span id="cb40-19"><a href="#cb40-19"></a><span class="co"># Facet by time point:</span></span>
<span id="cb40-20"><a href="#cb40-20"></a>baseplot <span class="op">+</span></span>
<span id="cb40-21"><a href="#cb40-21"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb40-22"><a href="#cb40-22"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;HCC ordination, all samples</span><span class="ch">\n</span><span class="st">method=PCoA, distance=weighted UniFrac&quot;</span>) <span class="op">+</span></span>
<span id="cb40-23"><a href="#cb40-23"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Timepoint, <span class="dv">2</span>)</span></code></pre></div>
<p>We can see some grouping by timepoint. Depending on your experiment and questions, you might want to consider other ordination or clustering approaches.</p>
</div>
<div id="permutational-analysis-of-variance-permanova" class="section level3">
<h3>Permutational analysis of variance (PERMANOVA)</h3>
<p>Finally, we’ll test whether there is a significant ecological level treatment effect. <em>PERMANOVA</em> sounds fancy, but it is just an <em>ANOVA</em> performed using permutations. Permutations are used to determine how data may appear if there is no treatment effect and group differences are due to random chance. Observed data are then compared to the randomized data to calculate a p-value.</p>
<p>Treatments are independent within Timepoints, so we will first subset the data by Timepoint:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>ps_S1 &lt;-<span class="st"> </span><span class="kw">subset_samples</span>(ps_prop, Timepoint <span class="op">==</span><span class="st"> &quot;S1&quot;</span>)</span>
<span id="cb41-2"><a href="#cb41-2"></a>ps_S3 &lt;-<span class="st"> </span><span class="kw">subset_samples</span>(ps_prop, Timepoint <span class="op">==</span><span class="st"> &quot;S3&quot;</span>)</span>
<span id="cb41-3"><a href="#cb41-3"></a>ps_S4 &lt;-<span class="st"> </span><span class="kw">subset_samples</span>(ps_prop, Timepoint <span class="op">==</span><span class="st"> &quot;S4&quot;</span>)</span></code></pre></div>
<p>Subset the metadata and estimate UniFrac for S3:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>metadata &lt;-<span class="st"> </span><span class="kw">as</span>(<span class="kw">sample_data</span>(ps_S3), <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb42-2"><a href="#cb42-2"></a>unifrac_dist &lt;-<span class="st"> </span><span class="kw">UniFrac</span>(ps_S3, <span class="dt">weighted =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Then we’ll use <code>vegan::adonis2</code> to perform the <em>PERMANOVA</em>.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">set.seed</span>(<span class="dv">100</span>)  <span class="co"># Set the seed to make the analysis reproducible</span></span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a>permanova &lt;-<span class="st"> </span><span class="kw">adonis2</span>(unifrac_dist <span class="op">~</span><span class="st"> </span>Treatment,</span>
<span id="cb43-4"><a href="#cb43-4"></a>                     <span class="dt">data =</span> metadata,</span>
<span id="cb43-5"><a href="#cb43-5"></a>                     <span class="dt">permutations =</span> <span class="dv">10000</span>)</span>
<span id="cb43-6"><a href="#cb43-6"></a></span>
<span id="cb43-7"><a href="#cb43-7"></a>permanova</span></code></pre></div>
<p>The low p-value suggests that within the S3 timepoint (post-termination), there is a significant treatment effect.</p>
<hr />
</div>
</div>
<div id="differential-taxon-abundance-deseq" class="section level2">
<h2>Differential taxon abundance (DESeq)</h2>
<p>Here, we will use <a href="https://bioconductor.org/packages/release/workflows/vignettes/rnaseqGene/inst/doc/rnaseqGene.html">DESeq2</a> to identify differentially abundant taxa between time points and treatments. <em>DESeq2</em> was designed to analyze RNAseq datasets, which are similar to OTU/ASV data sets in that both handle large, sparse contingency tables generated from Illumina sequencing data. For more details, see <a href="https://dx.plos.org/10.1371/journal.pcbi.1003531">McMurdie and Holmes 2014</a>.</p>
<p>First, we’ll convert our non-normalized count data to a <em>DESeq</em> object.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>dds &lt;-<span class="st"> </span><span class="kw">phyloseq_to_deseq2</span>(ps, <span class="op">~</span>Timepoint <span class="op">+</span><span class="st"> </span>Treatment)</span>
<span id="cb44-2"><a href="#cb44-2"></a></span>
<span id="cb44-3"><a href="#cb44-3"></a>dds</span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="kw">colData</span>(dds)</span></code></pre></div>
<p>There are two ways to analyze interaction effects using <em>DESeq2</em>. The first is to fit a multivariate model (e.g. ~A+B+A:B) and explore the model coefficients. The second is to fit a univariate model and explore pairwise contrasts. Here, we will group our two factors (Treatment and Timepoint) and use the latter approach.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Prepare the data:</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>dds<span class="op">$</span>Group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">paste0</span>(dds<span class="op">$</span>Treatment, dds<span class="op">$</span>Timepoint))</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="kw">design</span>(dds) &lt;-<span class="st"> </span><span class="kw">formula</span>(<span class="op">~</span>Group)</span>
<span id="cb45-4"><a href="#cb45-4"></a>dds &lt;-<span class="st"> </span>dds[, <span class="dv">-50</span>]                    <span class="co"># Remove tech_rep sample</span></span>
<span id="cb45-5"><a href="#cb45-5"></a>dds<span class="op">$</span>Group &lt;-<span class="st"> </span><span class="kw">droplevels</span>(dds<span class="op">$</span>Group)   <span class="co"># Drop tech_rep level from design matrix</span></span>
<span id="cb45-6"><a href="#cb45-6"></a></span>
<span id="cb45-7"><a href="#cb45-7"></a><span class="co"># Perform the differential abundance analysis:</span></span>
<span id="cb45-8"><a href="#cb45-8"></a>dds &lt;-<span class="st"> </span><span class="kw">DESeq</span>(dds)</span>
<span id="cb45-9"><a href="#cb45-9"></a></span>
<span id="cb45-10"><a href="#cb45-10"></a><span class="kw">results</span>(dds)</span></code></pre></div>
<p>Let’s explore the contrast, “T1S4 : T4S4” (no cc, seedling stage : late termination, seedling stage):</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>res &lt;-<span class="st"> </span><span class="kw">results</span>(dds, <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">&quot;Group&quot;</span>, <span class="st">&quot;T1S4&quot;</span>, <span class="st">&quot;T4S4&quot;</span>))</span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="kw">summary</span>(res)</span>
<span id="cb46-3"><a href="#cb46-3"></a></span>
<span id="cb46-4"><a href="#cb46-4"></a><span class="co"># Number of taxa with significantly higher abundance in T4S4:</span></span>
<span id="cb46-5"><a href="#cb46-5"></a><span class="kw">sum</span>(res<span class="op">$</span>padj <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span> <span class="op">&amp;</span><span class="st"> </span>res<span class="op">$</span>log2FoldChange <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb46-6"><a href="#cb46-6"></a></span>
<span id="cb46-7"><a href="#cb46-7"></a><span class="co"># Number of taxa with significantly lower abundance in T4S4:</span></span>
<span id="cb46-8"><a href="#cb46-8"></a><span class="kw">sum</span>(res<span class="op">$</span>padj <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span> <span class="op">&amp;</span><span class="st"> </span>res<span class="op">$</span>log2FoldChange <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>We can sort results by p-value and look at the top ASVs:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>res.order &lt;-<span class="st"> </span>res[<span class="kw">order</span>(res<span class="op">$</span>pvalue), ]</span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="kw">head</span>(res.order)[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">6</span>)]</span></code></pre></div>
<p>And plot counts for the first in the ordered list ASV:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="kw">plotCounts</span>(dds, <span class="dt">gene =</span> res.order<span class="op">@</span>rownames[<span class="dv">1</span>], <span class="dt">intgroup =</span> <span class="st">&quot;Group&quot;</span>)</span></code></pre></div>
<p>We can also plot counts by sample_ID:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw">plotCounts</span>(dds, <span class="dt">gene =</span> <span class="st">&quot;ASV_48&quot;</span>, <span class="dt">intgroup =</span> <span class="st">&quot;Group&quot;</span>)</span></code></pre></div>
<p>The plot can also be saved and customized with ggplot:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>d &lt;-<span class="st"> </span><span class="kw">plotCounts</span>(dds, <span class="dt">gene =</span> <span class="st">&quot;ASV_48&quot;</span>, <span class="dt">intgroup =</span> <span class="st">&quot;Group&quot;</span>, <span class="dt">returnData =</span> <span class="ot">TRUE</span>)</span>
<span id="cb50-2"><a href="#cb50-2"></a></span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="kw">ggplot</span>(d, <span class="kw">aes</span>(<span class="dt">x =</span> Group, <span class="dt">y =</span> count)) <span class="op">+</span></span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">w =</span> <span class="fl">0.1</span>, <span class="dt">h =</span> <span class="dv">0</span>), <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb50-5"><a href="#cb50-5"></a><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb50-6"><a href="#cb50-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;ASV 48, log&quot;</span>[<span class="dv">10</span>], <span class="st">&quot;-scale&quot;</span>))) <span class="op">+</span></span>
<span id="cb50-7"><a href="#cb50-7"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p>We can also subset our differentially abundant taxa to keep those with an adjusted p-value &lt; 0.05:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>sig &lt;-<span class="st"> </span><span class="kw">subset</span>(res.order, padj <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>)</span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="kw">head</span>(sig)</span></code></pre></div>
<p>What taxa are associated with significantly differentially abundant ASVs?</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>sig_asv &lt;-<span class="st"> </span><span class="kw">rownames</span>(sig)</span>
<span id="cb52-2"><a href="#cb52-2"></a>sig_taxa &lt;-<span class="st"> </span><span class="kw">tax_table</span>(ps)[sig_asv,]</span>
<span id="cb52-3"><a href="#cb52-3"></a><span class="kw">head</span>(sig_taxa)</span>
<span id="cb52-4"><a href="#cb52-4"></a></span>
<span id="cb52-5"><a href="#cb52-5"></a>sig_write &lt;-<span class="st"> </span><span class="kw">cbind</span>(sig, sig_taxa)</span>
<span id="cb52-6"><a href="#cb52-6"></a><span class="kw">write.csv</span>(sig_write, <span class="kw">file.path</span>(outdir, <span class="st">&#39;DATaxa_T1S1_T1S4.csv&#39;</span>))</span></code></pre></div>
<p>Report that we are done!</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="kw">print</span>(<span class="st">&#39;Done with ASV inference.&#39;</span>)</span></code></pre></div>
<hr />
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<ul>
<li><p><a href="https://benjjneb.github.io/decontam/vignettes/decontam_intro.html"><code>decontam</code> tutorial</a></p></li>
<li><p><a href="https://peat-clark.github.io/BIO381/veganTutorial.html"><code>vegan</code> tutorial</a></p></li>
<li><p><a href="http://bioconductor.org/packages/devel/bioc/vignettes/DESeq2/inst/doc/DESeq2.html"><code>DESeq2</code> tutorial</a></p></li>
<li><p><a href="https://mibwurrepo.github.io/Microbial-bioinformatics-introductory-course-Material-2018/">Intro course on microbiome analysis</a></p></li>
<li><p><a href="https://doi.org/10.1128/AEM.71.12.8228-8235.2005">UniFrac publication</a></p></li>
<li><p><a href="https://doi.org/10.1128/AEM.01996-06">Additional UniFrac publication</a></p></li>
<li><p><strong>Articles on data normalization:</strong></p>
<ul>
<li><a href="https://dx.plos.org/10.1371/journal.pcbi.1003531">Waste not, want not: why rarifying microbiome data is inadmissible</a></li>
<li><a href="http://journal.frontiersin.org/article/10.3389/fmicb.2017.02224/full">Microbiome datasets are compositional: and this is not optional</a></li>
<li><a href="http://doi.wiley.com/10.1111/2041-210X.13115">Methods for normalizing microbiome data: an ecological perspective</a></li>
<li><a href="http://www.nature.com/articles/nmeth.2658">Differential abundance analysis for microbial marker-gene surveys</a></li>
</ul></li>
</ul>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiPGJyPldvcmtmbG93IHBhcnQgSUlJOjxicj5BbmFseXppbmcgQVNWIERhdGEiCm91dHB1dDoKICBodG1sX2RvY3VtZW50OgogICAgdGhlbWU6IGNlcnVsZWFuCiAgICBoaWdobGlnaHQ6IHRhbmdvCiAgICBjb2RlX2Rvd25sb2FkOiB0cnVlCiAgICB0b2M6IHRydWUKICAgIHRvY19mbG9hdDogdHJ1ZQogICAgY3NzOiBteS5jc3MKICAgIGFuY2hvcl9zZWN0aW9uczogdHJ1ZQplZGl0b3Jfb3B0aW9uczogCiAgY2h1bmtfb3V0cHV0X3R5cGU6IGNvbnNvbGUKLS0tCgpgYGB7ciBzZXR1cCwgZWNobz1GQUxTRSwgcHVybD1GQUxTRX0Kcm9vdF9kaXIgPC0gJy9mcy9wcm9qZWN0L1BBUzA0NzEvd29ya3Nob3BzLzIwMjAtMTJfbWljcm8vJFVTRVInCiNrbml0cjo6b3B0c19rbml0JHNldChyb290LmRpciA9IHJvb3RfZGlyKQoKa25pdHI6Om9wdHNfY2h1bmskc2V0KAogIGNhY2hlID0gVFJVRSwKICBldmFsID0gRkFMU0UsICMgY2hhbmdlIGFzIG5lZWRlZAogIGNsYXNzLnNvdXJjZSA9ICdyX2NvZGUnLCBjbGFzcy5vdXRwdXQgPSAncl9vdXRwdXQnLCBjbGFzcy53YXJuaW5nID0gJ3Jfd2FybmluZycsIGNsYXNzLm1lc3NhZ2UgPSAncl93YXJuaW5nJywgY2xhc3MuZXJyb3IgPSAncl9lcnJvcicKICApCmBgYAoKPGJyPgoKLS0tLS0KCiMjIEdvYWxzCgpBbmFseXplIG1pY3JvYmlvbWUgZXhwZXJpbWVudGFsIGRhdGEgYXMgYSBwaHlsb3NlcSBvYmplY3QgLSBleHBsb3JlIGVjb2xvZ2ljYWwgbWV0cmljcyBhbmQgaWRlbnRpZnkgZGlmZmVyZW50aWFsbHkgYWJ1bmRhbnQgdGF4YS4KCi0tLS0tCgojIyBCZWZvcmUgV2UgR2V0IFN0YXJ0ZWQKCiMjIyBOb3RlcwoKLSBUaGlzIGlzIGEgc2xpZ2h0bHkgbW9kaWZpZWQgdmVyc2lvbiBvZiBhIGRvY3VtZW50IGNyZWF0ZWQgYnkgW01hdHRoZXcgV2lsbG1hbl0obWFpbHRvOndpbGxtYW4uMThAb3N1LmVkdSkuCgotIFRvIGNvbnZlcnQgYW4gYFJtZGAgKFIgTWFya2Rvd24pIGZpbGUgdG8gYW4gUiBzY3JpcHQsCiAgdHlwZSB0aGUgZm9sbG93aW5nIGluIGFuIFIgY29uc29sZToKICBga25pdHI6OnB1cmwoaW5wdXQ9IjxmaWxlbmFtZT4uUm1kIilgLgogIChZb3UgY2FuIGRvd25sb2FkIHRoaXMgYFJtZGAgZmlsZSBieSBjbGlja2luZyB0aGUgYENvZGVgIGJ1dHRvbgogIGluIHRoZSB0b3AtcmlnaHQgb2YgdGhpcyBwYWdlIC0tIGJ1dCB3ZSB3aWxsIG9wZW4gaXQgYXQgT1NDLikKCi0gVGhpcyBkb2N1bWVudCBkZWxpYmVyYXRlbHkgZG9lcyBub3QgaGF2ZSBhbnkgUiBvdXRwdXQuCiAgSW4gY2FzZSB5b3Ugd2FudCB0byBjaGVjayB5b3VyIG91dHB1dCBhZ2FpbnN0IGEgcmVmZXJlbmNlLAogIHlvdSBjYW4gZmluZCBhIGRvY3VtZW50IHdpdGggUiBvdXRwdXQgW2hlcmVdKGFzc2V0cy8wOC1wb3N0QVNWLWFuYWx5c2lzLmh0bWwpLgogIAojIyMgT3BlbiB0aGlzIGZpbGUgaW4gUlN0dWRpbyBTZXJ2ZXIgYXQgT1NDCgotIFRoaXMgYXNzdW1lcyB5b3Ugc3RpbGwgaGF2ZSBhbiBhY3RpdmUgUlN0dWRpbyBTZXJ2ZXIgam9iIGF0IE9TQzsKICAgaWYgbm90IHNlZSB0aGUKICAgW2luc3RydWN0aW9ucyBvbiB0aGUgcHJldmlvdXMgcGFnZV0oMDctQVNWLWluZmVyZW5jZS5odG1sI3N0YXJ0LWFuLXJzdHVkaW8tc2VydmVyLWpvYi1hdC1vc2MpIHRvIHN0YXJ0IG9uZS4KCi0gSW4gdGhlIEZpbGVzIHBhbmUsIGluIHRoZSBgbWFya2Rvd25gIGRpcmVjdG9yeSwKICBvcGVuIHRoZSBmaWxlIGAwOC1wb3N0QVNWLWFuYWx5c2lzLlJtZGAuIFRoYXQncyB0aGlzIGZpbGUhCgogCi0tLS0tCgojIyBHZXR0aW5nIFN0YXJ0ZWQKCiMjIyBJbnN0YWxsIGFuZCBMb2FkIFBhY2thZ2VzCgpBZGQgb3VyIGN1c3RvbSBsaWJyYXJ5IGFnYWluIGlmIHlvdSByZXN0YXJ0ZWQgeW91ciBSIHNlc3Npb246CgpgYGB7ciBsaWJsb2FkfQoubGliUGF0aHMobmV3ID0gJy9mcy9wcm9qZWN0L1BBUzA0NzEvLlIvNC4wLycpCmBgYAoKQW5kIGxvYWQgdGhlIG5lY2Vzc2FyeSBwYWNrYWdlczoKCmBgYHtyIHBhY2thZ2VzLCBtZXNzYWdlPUZBTFNFLCB3YXJuaW5nPUZBTFNFfQpwYWNrYWdlcyA8LSBjKCd0aWR5dmVyc2UnLCAndmVnYW4nLCAncGh5bG9zZXEnLCAnZGVjb250YW0nLCAnYXBlJywKICAgICAgICAgICAgICAnREVTZXEyJywgJ21pY3JvYmlvbWUnLCAnbWV0YWdlbm9tZVNlcScsICdyZW1vdGVzJywKICAgICAgICAgICAgICAnYW1wdmlzMicsICdicmVha2F3YXknKQpwYWNtYW46OnBfbG9hZChjaGFyID0gcGFja2FnZXMpCgojIElmIHlvdSB3YW50ZWQgdG8gaW5zdGFsbCBhbmQgbG9hZCB0aGVzZSBwYWNrYWdlcyB5b3Vyc2VsZiwKIyBmaXJzdCBtYWtlIHN1cmUgeW91IGhhdmUgdGhlIHBhY21hbiBwYWNrYWdlIGluc3RhbGxlZDoKIyMgaW5zdGFsbC5wYWNrYWdlcygncGFjbWFuJykKIyBUaGVuLCB0aGUgY29kZSBhYm92ZSB3b3VsZCB3b3JrIGV4Y2VwdCBmb3IgdGhlIGxhc3QgdHdvIHBhY2thZ2VzLAojIHdoaWNoIGFyZSBhdmFpbGFibGUgZnJvbSBHaXRodWIgb25seS4gVG8gaW5zdGFsbCB0aGVzZSwgeW91IHdvdWxkIHJ1bjoKIyMgcmVtb3Rlczo6aW5zdGFsbF9naXRodWIoIk1hZHNBbGJlcnRzZW4vYW1wdmlzMiIpCiMjIHJlbW90ZXM6Omluc3RhbGxfZ2l0aHViKCJhZHc5Ni9icmVha2F3YXkiKQpgYGAKCiMjIyBTZXQgRGlyZWN0b3JpZXMKCmBgYHtyfQojIERpciB3aXRoIGlucHV0IGZpbGVzOgppbmRpciA8LSAnYW5hbHlzaXMvQVNWX2luZmVyZW5jZS8nCgojIERpciBmb3Igb3V0cHV0OgpvdXRkaXIgPC0gJ2FuYWx5c2lzL3Bvc3RBU1ZfYW5hbHlzaXMvJwpgYGAKCiMjIyBMb2FkIHRoZSBEYXRhCgpUaGlzIHNlc3Npb24gc3RhcnRzIHdpdGggYSAqcGh5bG9zZXEqIG9iamVjdCBzaW1pbGFyIHRvIHRoZSBvbmUgZ2VuZXJhdGVkIHVzaW5nCipEQURBMiogaW4gdGhlIFtwcmV2aW91cyBzZXNzaW9uXSgwNi1yZWFkcy10by1BU1YuUm1kKS4KCmBgYHtyIGRhdGF9CnBzX3JhdyA8LSByZWFkUkRTKGZpbGUucGF0aChpbmRpciwgJ3BzXzE2U19WNF93aXRodHJlZS5yZHMnKSkKCiMgVGhpcyB3b3VsZCBsb2FkIHRoZSBvYmplY3QgZnJvbSB0aGUgcHJldmlvdXMgc2Vzc2lvbiwgd2hpY2ggZG9lc24ndCBjb250YWluIGEgdHJlZToKIyBwc19yYXcgPC0gcmVhZFJEUyhmaWxlLnBhdGgoaW5kaXIsICdwc19WNC5yZHMnKSkKYGBgCgpPdXIgKnBoeWxvc2VxKiBvYmplY3QgaXMgbWFkZSB1cCBvZiB0aGUgZm9sbG93aW5nIGNvbXBvbmVudHMgKHNsb3RzKToKCi0gYG90dV90YWJsZWAKLSBgc2FtcGxlX2RhdGFgCi0gYHRheF90YWJsZWAKLSBgcGh5X3RyZWVgCgpMZXQncyBoYXZlIGEgbG9vayBhdCB0aGUgb2JqZWN0OgoKYGBge3IgcHN9CnBzX3JhdwoKIyBBbmQgdGhlIGFzc2lnbmVkIHRheG9uIG5hbWVzOgp0YXhhX25hbWVzKHBzX3JhdylbMTozXQpgYGAKCkFzIHdlIGNhbiBzZWUsIHRoZSB0YXhvbiBuYW1lcyBhcmUgY3VycmVudGx5IHRoZSBhc3NvY2lhdGVkIHNlcXVlbmNlcy4KV2UgY2FuIGNyZWF0ZSBhIG5ldyAqcGh5bG9zZXEqIGNvbXBvbmVudCB0byBzdG9yZSB0aGVzZSBzZXF1ZW5jZXMsCnRoZW4gcmVuYW1lIHRoZSBBU1ZzIHNvIHNvbWV0aGluZyBzaG9ydGVyICgiQVNWXzEiLCAiQVNWXzIiLCBldGMuKS4KCmBgYHtyfQpkbmEgPC0gQmlvc3RyaW5nczo6RE5BU3RyaW5nU2V0KHRheGFfbmFtZXMocHNfcmF3KSkKbmFtZXMoZG5hKSA8LSB0YXhhX25hbWVzKHBzX3JhdykKCiMgTWVyZ2Ugc2VxdWVuY2Ugb2JqZWN0IGludG8gdGhlIHBoeWxvc2VxIG9iamVjdDoKcHNfcmF3IDwtIG1lcmdlX3BoeWxvc2VxKHBzX3JhdywgZG5hKQpwc19yYXcKCiMgUmVuYW1lIEFTVnM6CnRheGFfbmFtZXMocHNfcmF3KSA8LSBwYXN0ZSgiQVNWIiwgMTpudGF4YShwc19yYXcpLCBzZXAgPSAiXyIpCnRheGFfbmFtZXMocHNfcmF3KVsxOjNdCmBgYAoKLS0tLS0KCiMjIEZpbHRlciB0YXhhCgojIyMgSWRlbnRpZnkgYW5kIFJlbW92ZSBDb250YW1pbmFudHMKCkl0IGlzIHBvc3NpYmxlIHRvIGludHJvZHVjZSBjb250YW1pbmF0aW5nIG1pY3JvYmVzIGR1cmluZyBzYW1wbGUgcHJlcGFyYXRpb24uCkJlZm9yZSBhbmFseXppbmcgdGhlIGRhdGEsIHdlIHdpbGwgaWRlbnRpZnkgYW5kIHJlbW92ZSBwcm9iYWJsZSBjb250YW1pbmFudHMgdXNpbmcKdGhlIFtkZWNvbnRhbSBwYWNrYWdlXShodHRwczovL2JlbmpqbmViLmdpdGh1Yi5pby9kZWNvbnRhbS92aWduZXR0ZXMvZGVjb250YW1faW50cm8uaHRtbCkuICAgCgpJbiB0aGlzIGNhc2UsIHdlIHdpbGwgZGVmaW5lIGEgY29uYXRhbWluYW50IGFzIGFuIEFTViB3aG9zZSBhYnVuZGFuY2UgY29ycmVsYXRlcwp3aXRoIEROQSBjb25jZW50cmF0aW9uIChwb3N0LVBDUikuCk91ciBhc3N1bXB0aW9uIGhlcmUgaXMgdGhhdCBlYWNoIHNvaWwgdGF4b24ncyBhYnVuZGFuY2Ugc2hvdWxkIGJlIGluZGVwZW5kYW50IG9mCkROQSBjb25jZW50cmF0aW9uLiBIb3dldmVyLCBpZiB3ZSB3ZXJlIHRvIHNwaWtlIGVhY2ggc2FtcGxlIHdpdGggYSBjb250YW1pbmFudCwKdGhhdCBjb250YW1pbmFudCB3b3VsZCBzaG93IGEgZ3JlYXRlciBhYnVuZGFuY2UgaW4gc2FtcGxlcyB3aXRoIGxvd2VyIEROQSBjb25jZW50cmF0aW9ucy4KVG8gZG8gdGhpcywgd2UgbmVlZCBETkEgY29uY2VudHJhdGlvbiBtZWFzdXJlZCBhZnRlciBQQ1IgYW5kIGJlZm9yZSBwb29saW5nIG9mIHRoZSBzYW1wbGVzLgoKVGhlc2UgZGF0YSBhcmUgaW4gY29sdW1uIDcgb2YgdGhlIHNhbXBsZSBkYXRhIGNvbXBvbmVudDoKCmBgYHtyIEROQV9jb25jZW50cmF0aW9ufQpoZWFkKHNhbXBsZV9kYXRhKHBzX3JhdykpCmBgYAoKTUNJQyBtZWFzdXJlZCBvdXIgRE5BIGNvbmNlbnRyYXRpb24gYnkgY29tcGFyaW5nIGJhbmQgaW50ZW5zaXRpZXMgdG8gYSBzaW5nbGUKcmVmZXJlbmNlIGJhbmQuIE1DSUMncyBETkEgY29uY2VudHJhdGlvbiBtZWFzdXJlbWVudHMgcmFuZ2UgZnJvbSAwIHRvIDEgKHRoZSByZWZlcmVuY2UpLgpaZXJvIGluIHRoaXMgY2FzZSBpcyBjb2RlZCBhcyBgTkFgLgpUaGUgKmRlY29udGFtKiBwYWNrYWdlIGNhbid0IGhhbmRsZSBOQSdzIG9yIDAncywKc28gd2UgbmVlZCB0byBjaGFuZ2UgdGhlbSB0byBhIHNtYWxsIHZhbHVlIChlLmcuIDAuMDEpLgoKYGBge3J9CiMgRmlyc3QsIHdlIGlkZW50aWZ5IHRoZSBOQXMgaW4gdGhlIEROQSBtZWFzdXJlbWVudCBjb2x1bW46Ck5BcyA8LSBpcy5uYShzYW1wbGVfZGF0YShwc19yYXcpJFBDUl9wcm9kX1Y0LlY1KQoKIyBUaGVuLCB3ZSByZXBsYWNlIE5BcyB3aXRoIDAuMDE6CnNhbXBsZV9kYXRhKHBzX3JhdykkUENSX3Byb2RfVjQuVjVbTkFzXSA8LSAwLjAxCmBgYAoKV2Ugd2lsbCB1c2UgYGRlY29udGFtOjppc0NvbnRhbWluYW50KG1ldGhvZCA9ICJmcmVxdWVuY3kiKWAgdG8gdGVzdCBlYWNoIHRheG9uCmFnYWluc3QgdGhlIG51bGwgaHlwb3RoZXNpczogYWJ1bmRhbmNlIGlzIG5vdCBhc3NvY2lhdGVkIHdpdGggRE5BIGNvbmNlbnRyYXRpb24uCkJlY2F1c2UgdGhlIEROQSBjb25jZW50cmF0aW9uIG1lYXN1cmVtZW50cyBhcmUgbm90IHZlcnkgYWNjdXJhdGUsCmFuZCB3ZSB3YW50IHRvIG1ha2Ugc3VyZSB0byByZW1vdmUgcG9zc2libGUgY29udGFtaW5hbnRzLAp3ZSB1c2UgYSByZWxheGVkIHAtdmFsdWUgKDAuMikgdG8gcmVqZWN0IHRoZSBudWxsIGh5cG90aGVzaXM6CgpgYGB7ciwgY2FjaGU9VFJVRX0KY29udGFtX2RmX2ZyZXEgPC0gaXNDb250YW1pbmFudChwc19yYXcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gImZyZXF1ZW5jeSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uYyA9ICJQQ1JfcHJvZF9WNC5WNSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyZXNob2xkID0gMC4yKQpoZWFkKGNvbnRhbV9kZl9mcmVxKQpgYGAKCkFzIHdlIGNhbiBzZWUsIHRoZSB0b3AgMyBBU1ZzIGFyZSBpZGVudGlmaWVkIGFzIHByb2JhYmxlIGNvbnRhbWluYW50cy4KSG93IG1hbnkgY29udGFtaW5hbnRzIHdlcmUgaWRlbnRpZmllZCAoYFRSVUVgIGluIHRoZSBgY29udGFtaW5hbnRgIGNvbHVtbikKaW4gdG90YWw/CgpgYGB7cn0KdGFibGUoY29udGFtX2RmX2ZyZXEkY29udGFtaW5hbnQpCmBgYAoKV2hhdCBhcmUgdGhlIG1vc3QgYWJ1bmRhbnQgY29udGFtaW5hbnQgdGF4YT8KCmBgYHtyfQojIEdldCBhYnVuZGFuY2UgcmFua3MgZm9yIGNvbnRhbWluYW50IEFTVnM6CmhlYWQod2hpY2goY29udGFtX2RmX2ZyZXEkY29udGFtaW5hbnQpKQoKIyBDaGVjayB3aGljaCB0YXhhIGFyZSBjb250YW1pbmFudHM6CnBzX2NvbnRhbSA8LSBwcnVuZV90YXhhKGNvbnRhbV9kZl9mcmVxJGNvbnRhbWluYW50LCBwc19yYXcpCmhlYWQodGF4X3RhYmxlKHBzX2NvbnRhbSkpCmBgYAoKTGV0J3MgdGFrZSBhIGxvb2sgYXQgb3VyIHRlc3RlZCBhc3NvY2lhdGlvbnMgZm9yIHNldmVyYWwgdGF4YToKCmBgYHtyLCB3YXJuaW5nPUZBTFNFfQpwbG90X2ZyZXF1ZW5jeShwc19yYXcsCiAgICAgICAgICAgICAgIHRheGFfbmFtZXMocHNfcmF3KVtjKDEsIDIsIDMsIDQsIDUsIDExKV0sCiAgICAgICAgICAgICAgIGNvbmMgPSAiUENSX3Byb2RfVjQuVjUiKSArCiAgeGxhYigiRE5BIENvbmNlbnRyYXRpb24gKHJlbGF0aXZlIHRvIHNpbmdsZSBtYXJrZXIpIikKYGBgCiAgIApBcyB3ZSBjYW4gc2VlLCBhYnVuZGFuY2Ugb2YgQVNWcyAxLCAyLCAzLCBhbmQgMTEgYXJlIHBhcnRpY3VsYXJseSBoaWdoIGluIHNhbXBsZXMKd2l0aCBsb3cgRE5BIGNvbmNlbnRyYXRpb24uCgpXaGljaCBzYW1wbGVzIGhhdmUgaGlnaGVzdCBhYnVuZGFuY2VzIG9mIHRoZSBjb250YW1pbmFudHM/CgpgYGB7cn0KYXN2MSA8LSBvdHVfdGFibGUocHNfcmF3KVssIDFdCmhlYWQoYXN2MVtvcmRlcihhc3YxLCBkZWNyZWFzaW5nID0gVFJVRSldKQoKYXN2MiA8LSBvdHVfdGFibGUocHNfcmF3KVssIDJdCmhlYWQoYXN2MltvcmRlcihhc3YyLCBkZWNyZWFzaW5nID0gVFJVRSldKQpgYGAKCkhvdyBkbyB0aGVzZSBjb250YW1pbmFudHMgb3ZlcmxhcCB3aXRoIEFTVnMgcHJlc2VudCBpbiB0aGUgbmVnYXRpdmUgY29udHJvbD8KCmBgYHtyfQpvdHVfdGFibGUocHNfcmF3KVs3MDo3NSwgMToxMV0KYGBgCgpBU1ZzIGhhdmUgaGlnaCByZWFkIGNvdW50cyBpbiB0aGUgZXh0cmFjdGlvbiBuZWdhdGl2ZSBjb250cm9sLgpUaHVzLCB3ZSBjYW4gYmUgZmFpcmx5IGNlcnRhaW4gdGhlc2UgYXJlIGNvbnRhbWluYW50cyBhbmQgbm90IHJlcHJlc2VudGF0aXZlCm9mIG91ciBleHBlcmltZW50YWwgc2FtcGxlcy4gICAKICAgClJlbW92ZSB0aGUgY29udGFtaW5hbnRzIHRoYXQgd2UgaWRlbnRpZmllZDoKCmBgYHtyIHBydW5lX2RlY29udGFtfQpwc19ub25jb250YW0gPC0gcHJ1bmVfdGF4YSghY29udGFtX2RmX2ZyZXEkY29udGFtaW5hbnQsIHBzX3JhdykKCnBzX25vbmNvbnRhbQpgYGAKCldoYXQgcHJvcG9ydGlvbiBvZiBvdXIgY291bnQgZGF0YSB3ZXJlIHJlbW92ZWQgYXMgY29udGFtaW5hbnRzPwoKYGBge3IgY291bnRfZGVjb250YW0xfQpwcmUgPC0gc3VtKHNhbXBsZV9zdW1zKHBzX3JhdykpCnBvc3QgPC0gc3VtKHNhbXBsZV9zdW1zKHBzX25vbmNvbnRhbSkpCgoocHJlLXBvc3QpIC8gcHJlCmBgYAoKIyMjIFJlbW92ZSBub24tYmFjdGVyaWFsLCBub24tYXJjaGFlYWwgQVNWcwoKVGhlIFY0IHJlZ2lvbiBvZiAxNlMgclJOQSBpcyBjb25zZXJ2ZWQgd2l0aGluIGNlcnRhaW4gYmFjdGVyaWEsIGFyY2hhZWEsCmNobG9yb3BsYXN0cywgbWl0b2Nob25kcmlhLCBhbmQgZXVrYXJ5b3Rlcy4KU2luY2Ugd2UgYXJlIG9ubHkgaW50ZXJlc3RlZCBpbiBiYWN0ZXJpYSBhbmQgYXJjaGFlYSBoZXJlLAp3ZSdsbCBuZWVkIHRvIHJlbW92ZSBvdGhlciB0YXhhIGZyb20gb3VyIG9iamVjdC4KCmBgYHtyIHJlbW92ZV9ub25iYWN9CiMgQ3JlYXRlIHBzIHN1YnNldHMgZm9yIGNobG9yb3BsYXN0LCBtaXRvY2hvbmRyaWEsIGFuZCBldWthcnlvdGVzOgpjaGxyIDwtIHN1YnNldF90YXhhKHBzX25vbmNvbnRhbSwgT3JkZXIgPT0gIkNobG9yb3BsYXN0IikKbWl0IDwtIHN1YnNldF90YXhhKHBzX25vbmNvbnRhbSwgRmFtaWx5ID09ICJNaXRvY2hvbmRyaWEiKQpldWsgPC0gc3Vic2V0X3RheGEocHNfbm9uY29udGFtLCBLaW5nZG9tID09ICJFdWthcnlvdGEiKQoKIyBHZXQgYWxsIHRheG9uIElEcyB0aGF0IHdlIHdhbnQgdG8gcmVtb3ZlOgpiYWRfdGF4YSA8LSBjKHRheGFfbmFtZXMoY2hsciksIHRheGFfbmFtZXMobWl0KSwgdGF4YV9uYW1lcyhldWspKQoKIyBHZXQgYWxsIHRheG9uIElEcyB0aGF0IHdlIHdhbnQgdG8ga2VlcDoKYWxsX3RheGEgPC0gdGF4YV9uYW1lcyhwc19ub25jb250YW0pCmdvb2RfdGF4YSA8LSBhbGxfdGF4YVshKGFsbF90YXhhICVpbiUgYmFkX3RheGEpXQoKIyBTdWJzZXQgcGh5bG9zZXEgb2JqZWN0Ogpwc19iYWNfYXJjIDwtIHBydW5lX3RheGEoZ29vZF90YXhhLCBwc19ub25jb250YW0pCmBgYAoKV2hhdCBwcm9wb3J0aW9uIG9mIEFTVnMgd2VyZSBrZXB0PwoKYGBge3Iga2VwdF9iYWN9CnByZSA8LSBzdW0oc2FtcGxlX3N1bXMocHNfbm9uY29udGFtKSkKcG9zdCA8LSBzdW0oc2FtcGxlX3N1bXMocHNfYmFjX2FyYykpCnBvc3QgLyBwcmUKYGBgCiAgIApGaW5hbGx5LCB3ZSdsbCBhbHNvIHJlbW92ZSBub24tZXhwZXJpbWVudGFsIHNhbXBsZXMgKGUuZy4gbmVnYXRpdmUgY29udHJvbHMpLgpOb3RlLCB0aG91Z2gsIHRoYXQgbm9uLWV4cGVyaW1lbnRhbCBzYW1wbGVzIGFyZSBpbXBvcnRhbnQgZm9yIGV2YWx1YXRpbmcgdGhlCnF1YWxpdHkgb2YgeW91ciByZWFnZW50cywgY29uc2lzdGVuY3kgYWNyb3NzIHNlcXVlbmNpbmcgcnVucywgYW5kIGNvbnRhbWluYXRpb24uCgpgYGB7ciBzdWJzZXRfSENDfQpwcyA8LSBzdWJzZXRfc2FtcGxlcyhwc19iYWNfYXJjLCBFeHBlcmltZW50ID09ICJIQ0MiKQoKcHMKYGBgCgotLS0tLQoKIyMgRmlsdGVyIHNhbXBsZXMKCkFmdGVyIGhhdmluZyBmaWx0ZXJlZCBvdXQgdW53YW50ZWQgdGF4YSwKd2Ugbm93IG5lZWQgdG8gZmlsdGVyIG91dCB1bmluZm9ybWF0aXZlIHNhbXBsZXMgLS0KdGhvc2Ugd2l0aCBsb3cgdG90YWwgdGF4b24gY291bnRzLgoKRmlyc3QsIGhvdyBtYW55IGNvdW50cyBkbyB3ZSBoYXZlIGZvciBlYWNoIHNhbXBsZT8KCmBgYHtyIHN1bXN9CnN1bXMgPC0gc2FtcGxlX3N1bXMocHMpCnN1bXNbb3JkZXIoc3VtcyldCgojIExvd2VzdCB0b3RhbCBjb3VudDoKbWluKHN1bXMpCgojIFNhbXBsZSB3aXRoIGxvd2VzdCBjb3VudHM6Cm5hbWVzKHN1bXNbb3JkZXIoc3VtcyldWzFdKQpgYGAKClRvIHJlbW92ZSB1bmluZm9ybWF0aXZlIHNhbXBsZXMsIHdlIHdpbGwgb25seSBrZWVwIHRob3NlIHdpdGggb3ZlciAxLDAwMCBjb3VudHMuCldlIHdpbGwgYWxzbyByZW1vdmUgYSB0ZWNobmljYWwgcmVwbGljYXRlLAp0aG91Z2ggbm90ZSB0aGF0IHRlY2huaWNhbCByZXBsaWNhdGVzIGFyZSBpbXBvcnRhbnQgZm9yIHF1YWxpdHkgY29udHJvbCBvZiBydW5zCmFuZCBmb3IgdW5kZXJzdGFuZGluZyB0aGUgcmVwcm9kdWNpYmlsaXR5IG9mIHRoZSBtZXRob2RvbG9neS4gCgpgYGB7ciBzdWJzZXRfMWt9CiMgUmVtb3ZlIHNhbXBsZXMgd2l0aCBsb3cgY291bnRzOgpwcyA8LSBzdWJzZXRfc2FtcGxlcyhwcywgc2FtcGxlX3N1bXMocHMpID4gMTAwMCkKCiMgUmVtb3ZlIHRoZSB0ZWNobmljYWwgcmVwbGljYXRlOgpwcyA8LSBzdWJzZXRfc2FtcGxlcyhwcywgU2FtcGxlSUQgIT0gIjUwMVM0IikKYGBgCgpMZXQncyB0YWtlIGEgbG9vayBhdCBvdXIgY3VycmVudCBgcGh5bG9zZXFgIG9iamVjdDoKCmBgYHtyIGxvb2tfcHN9CnNhbXBsZV9kYXRhKHBzKVsxOjEwXQoKaGVhZCh0KG90dV90YWJsZShwcylbMToxMF0pKQoKaGVhZCh0YXhfdGFibGUocHMpKQpgYGAKCi0tLS0tCgojIyBOb3JtYWxpemF0aW9uCgpOb3JtYWxpemF0aW9uIGlzIGN1cnJlbnRseSBhIG11Y2gtZGlzY3Vzc2VkIGlzc3VlIG9mIG1pY3JvYmlvbWUgc3R1ZGllcy4KRGlmZmVyZW5jZXMgaW4gcmVhZCBkZXB0aCBiZXR3ZWVuIHNhbXBsZXMgb2Z0ZW4gbmVlZCB0byBiZSBjb3JyZWN0ZWQgYmVmb3JlIGFuYWx5c2lzLgpTZXZlcmFsIG5vcm1hbGl6YXRpb24gbWV0aG9kcyBoYXZlIGJlZW4gcHJvcG9zZWQsIGFuZCBubyBzaW5nbGUgbWV0aG9kIGlzIHBlcmZlY3QuCkl0IG1heSBiZSB0aGF0IHRoZSBtb3N0IGFwcHJvcHJpYXRlIG1ldGhvZCBkZXBlbmRzIG9uIHRoZSBhbmFseXNpcy4KCkluIHRoaXMgdHV0b3JpYWwsIHdlIHdpbGwgdXNlOgogIAogIC0gUHJvcG9ydGlvbi1ub3JtYWxpemVkIGRhdGEgdG8gZXN0aW1hdGUgZWNvbG9naWNhbCBtZXRyaWNzLgogIAogIC0gU3RhYmlsaXppbmcgdHJhbnNmb3JtYXRpb24gbm9ybWFsaXplZCBkYXRhIHRvIGlkZW50aWZ5IGRpZmZlcmVudGlhbGx5IGFidW5kYW50IHRheGEuCgpIb3dldmVyLCBmb3IgeW91ciByZWZlcmVuY2UsIHdlIHdpbGwgYWxzbyBwcmVzZW50IGNvZGUgZm9yIHR3byBvdGhlciBub3JtYWxpemF0aW9uCm1ldGhvZHM6IHJhcmVmYWN0aW9uIGFuZCBjdW11bGF0aXZlIHN1bSBzY2FsaW5nLgoKRm9yIG1vcmUgZGV0YWlscywgcmVhZApbTWNNdXJkaWUgYW5kIEhvbG1lcyAyMDE0XShodHRwczovL2R4LnBsb3Mub3JnLzEwLjEzNzEvam91cm5hbC5wY2JpLjEwMDM1MzEpCmFuZCBbTWNLbmlnaHQgZXQgYWwuIDIwMTldKGh0dHA6Ly9kb2kud2lsZXkuY29tLzEwLjExMTEvMjA0MS0yMTBYLjEzMTE1KS4KCi0tLS0tCgojIyMgUHJvcG9ydGlvbiBOb3JtYWxpemF0aW9uCgpQcm9wb3J0aW9uIG5vcm1hbGl6YXRpb24gaW52b2x2ZXMgZGl2aWRpbmcgZWFjaCBPVFUgY291bnQgYnkgdGhlIHRvdGFsIHN1bSBmb3IgZWFjaCBzYW1wbGUuClRoZSByZXN1bHRpbmcgY291bnQgZGF0YSB3aWxsIGFkZCB1cCB0byAxICgxMDAlKSBmb3IgZWFjaCBzYW1wbGUuCgpUaGUgYG1pY3JvYmlvbWU6OnRyYW5zZm9ybWAgZnVuY3Rpb24gY2FuIGJlIHVzZWQgdG8gZWFzaWx5IG5vcm1hbGl6ZSBjb3VudCBkYXRhIGFzCnByb3BvcnRpb25zIGluIGEgKnBoeWxvc2VxKiBvYmplY3Q6CgpgYGB7ciBub3JtX3Byb3BvcnRpb25zfQojIFByb3BvcnRpb24gbm9ybWFsaXphdGlvbjoKcHNfcHJvcCA8LSB0cmFuc2Zvcm0ocHMsICJjb21wb3NpdGlvbmFsIikKCiMgSGF2ZSBhIGxvb2sgYXQgdGhlIHJlc3VsdGluZyBPVFUgdGFibGU6Cm90dV90YWJsZShwc19wcm9wKVsxOjUsIDE6NV0KCiMgQ2hlY2sgd2hhdCB0aGUgc3VtcyBmb3IgZWFjaCBzYW1wbGUgYXJlIG5vdzoKaGVhZChzYW1wbGVfc3Vtcyhwc19wcm9wKSkKYGBgCgotLS0tLQoKIyMjIFZhcmlhbmNlIHN0YWJpbGl6aW5nIHRyYW5zZm9ybWF0aW9uCgpUaGlzIHRyYW5zZm9ybWF0aW9uIG1ldGhvZCwgYXZhaWxhYmxlIGluIFtERVNlcTJdKGh0dHBzOi8vYmlvY29uZHVjdG9yLm9yZy9wYWNrYWdlcy9yZWxlYXNlL3dvcmtmbG93cy92aWduZXR0ZXMvcm5hc2VxR2VuZS9pbnN0L2RvYy9ybmFzZXFHZW5lLmh0bWwpLApub3JtYWxpemVzIGRhdGEgd2l0aCByZXNwZWN0IHRvIGxpYnJhcnkgc2l6ZSBhcyB3ZWxsIGFzIGRpc3BlcnNpb24uICAgClR5cGUgYD92c3RgIG9yIHJlYWQgW0FuZGVycyBhbmQgSHViZXIgMjAxMF0oaHR0cDovL2R4LmRvaS5vcmcvMTAuMTE4Ni9nYi0yMDEwLTExLTEwLXIxMDYpCmZvciBtb3JlIGluZm9ybWF0aW9uLgoKYGBge3Igbm9ybV92c3QsIG1lc3NhZ2U9RkFMU0UsIHdhcm5pbmc9RkFMU0V9CiMgRmlyc3Qgd2UgY29udmVydCB0aGUgcGh5bG9zZXEgb2JqZWN0IHRvIGEgREVTZXEgb2JqZWN0OgpkZHMgPC0gcGh5bG9zZXFfdG9fZGVzZXEyKHBzLCB+MSkKCiMgVGhlbiB3ZSBlc3RpbWF0ZSB0aGUgc2l6ZSBmYWN0b3JzOgpkZHMgPC0gZXN0aW1hdGVTaXplRmFjdG9ycyhkZHMpCgojIE5vdyBjYW4gZG8gdGhlIHRyYW5zZm9ybWF0aW9uOgpkZHNfdnN0IDwtIHZzdChkZHMsIGJsaW5kID0gVFJVRSkKCiMgSGF2ZSBhIGxvb2sgYXQgdGhlIHJlc3VsdGluZyBjb3VudHM6CnZzdF9jb3VudHMgPC0gYXNzYXkoZGRzX3ZzdCkKdCh2c3RfY291bnRzKVsxOjUsIDE6NV0KYGBgCgotLS0tLQoKIyMjIFJhcmVmYWN0aW9uCgpSYXJlZmFjdGlvbiBjYW4gYmUgdXNlZCB0byBzdWJzZXQgZGF0YSBzdWNoIHRoYXQgdGhlIGxpYnJhcnkgZGVwdGggaXMgdGhlIHNhbWUKZm9yIGVhY2ggc2FtcGxlLgpCZWNhdXNlIHNhbXBsaW5nIG9mIHRoZSBkYXRhIGlzIHJhbmRvbSwKcmFyZWZhY3Rpb24gY2FuIGFjY291bnQgZm9yIGFuIGVmZmVjdCBvZiB0b3RhbCByZWFkIGNvdW50IG9uIHRheGEgcmljaG5lc3MuCkhvd2V2ZXIsIHJhcmVmYWN0aW9uIGlzIG5vIGxvbmdlciBjb25zaWRlcmVkIHRvIGJlIGEgZ29vZCB3YXkgdG8gbm9ybWFsaXplCmFtcGxpY29uIHNlcXVlbmNpbmcgZGF0YQooc2VlIFtNY011cmRpZSAmIEhvbG1lcyAyMDE0XShodHRwczovL2R4LnBsb3Mub3JnLzEwLjEzNzEvam91cm5hbC5wY2JpLjEwMDM1MzEpKS4KCmBgYHtyLCByYXJlZnksIG1lc3NhZ2U9RkFMU0UsIHdhcm5pbmc9RkFMU0V9CnBzX3JhcmVmaWVkIDwtIHJhcmVmeV9ldmVuX2RlcHRoKHBzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBybmdzZWVkID0gMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcGxlLnNpemUgPSBtaW4oc2FtcGxlX3N1bXMocHMpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZSA9IEZBTFNFKQoKIyBIYXZlIGEgbG9vayBhdCB0aGUgcmVzdWx0OgpvdHVfdGFibGUocHNfcmFyZWZpZWQpWzE6NSwgMTo1XQoKaGVhZChzYW1wbGVfc3Vtcyhwc19yYXJlZmllZCkpCmBgYAoKQ29tcGFyZSB0aGVzZSBzYW1wbGUgc3VtcyB0byB0aGUgbm9uLXJhcmlmaWVkIGRhdGEgc3VtczoKCmBgYHtyLCBub24tcmFyX3N1bXN9CmhlYWQoc2FtcGxlX3N1bXMocHMpKQpgYGAKCi0tLS0tCgojIyMgQ3VtdWxhdGl2ZSBTdW0gU2NhbGluZwoKVGhlICptZXRhZ2Vub21lU2VxKiBDdW11bGF0aXZlIFN1bSBTY2FsaW5nIChDU1MpIG5vcm1hbGl6YXRpb24gaXMgYW5vdGhlciBvcHRpb24KZGV2ZWxvcGVkIGZvciBtaWNyb2Jpb21lIGRhdGEuCkZvciBtb3JlIGluZm9ybWF0aW9uLCByZWFkCltQYXVsc29uIGV0IGFsLiAyMDEzXShodHRwOi8vd3d3Lm5hdHVyZS5jb20vYXJ0aWNsZXMvbm1ldGguMjY1OCkuCgpgYGB7ciBub3JtX2NzcywgbWVzc2FnZT1GQUxTRX0KIyBDb252ZXJ0IHRoZSBwaHlsb3NlcSBvYmplY3QgdG8gYSBtZXRhZ2Vub21lc2VxIG9iamVjdDoKbWdzX2NzcyA8LSBwaHlsb3NlcV90b19tZXRhZ2Vub21lU2VxKHBzKQoKIyBQZXJmb3JtIHRoZSBDdW11bGF0aXZlIFN1bSBTY2FsaW5nOgptZ3NfY3NzIDwtIGN1bU5vcm0obWdzX2NzcykKCiMgRXh0cmFjdCB0aGUgY291bnRzIGFuZCBhZGQgdGhlbSB0byBhIHNlcGFyYXRlIHBoeWxvc2VxIG9iamVjdDoKY3NzX2NvdW50cyA8LSBNUmNvdW50cyhtZ3NfY3NzLCBub3JtID0gVFJVRSkKcHNfY3NzIDwtIHBzCm90dV90YWJsZShwc19jc3MpIDwtIG90dV90YWJsZSh0KGNzc19jb3VudHMpLCB0YXhhX2FyZV9yb3dzID0gRkFMU0UpCmBgYAoKTm93IGxldHMgY29tcGFyZSB0aGUgb3JpZ2luYWwgZGF0YSB0byB0aGUgQ1NTIG5vcm1hbGl6ZWQgZGF0YToKCmBgYHtyIGNjc19jb21wYXJlfQpvdHVfdGFibGUocHMpWzE6NSwgMTo1XQpoZWFkKHNhbXBsZV9zdW1zKHBzKSkKCm90dV90YWJsZShwc19jc3MpWzE6NSwgMTo1XQpoZWFkKHNhbXBsZV9zdW1zKHBzX2NzcykpCmBgYAoKLS0tLS0KCiMjIFBsb3QgYWJ1bmRhbmNlcwoKSW4gdGhpcyBhbmQgZm9sbG93aW5nIHRoZSBleGFtcGxlcyB3ZSB3aWxsIHVzZSB0aGUgKipwcm9wb3J0aW9ucyoqIGRhdGEuCgpgYGB7ciBwbG90X2FidW5kYW5jZX0KIyBTdWJzZXQgdG8gdGhlIFQxIHRyZWF0bWVudApUMSA8LSBzdWJzZXRfc2FtcGxlcyhwc19wcm9wLCBUcmVhdG1lbnQgPT0gIlQxIikKCiMgQWdnbG9tZXJhdGUgdGF4YSB0byBwaHlsdW0gbGV2ZWw6ClQxX3BoeWx1bSA8LSB0YXhfZ2xvbShUMSwgdGF4cmFuayA9ICJQaHlsdW0iLCBOQXJtID0gRkFMU0UpCgojIFJlbW92ZSB1bmNvbW1vbiBwaHlsYToKVDFfcGh5bHVtIDwtIHN1YnNldF90YXhhKFQxX3BoeWx1bSwgdGF4YV9zdW1zKFQxX3BoeWx1bSkgPiAwLjEpCgojIFBsb3Q6CnBsb3RfYmFyKFQxX3BoeWx1bSwgZmlsbCA9ICJQaHlsdW0iKSArCiAgIGZhY2V0X3dyYXAoflRpbWVwb2ludCwgc2NhbGVzID0gImZyZWVfeCIsIG5yb3cgPSAxKQpgYGAKICAKLS0tLS0KCiMjIEFscGhhIGRpdmVyc2l0eQoKQWxwaGEgZGl2ZXJzaXR5IG1lYXN1cmVzIHRheG9ub21pYyBkaXZlcnNpdHkgd2l0aGluIGEgc2luZ2xlIHBvcHVsYXRpb24uCk1lYXN1cmVzIG9mIGFscGhhIGRpdmVyc2l0eSBpbmNsdWRlIHRheG9ub21pYyByaWNobmVzcyAoaS5lLiBudW1iZXIgb2YgdGF4YSksCmFuZCBpbmRpY2VzIHdoaWNoIGNvbWJpbmUgdGF4b25vbWljIHJpY2huZXNzIHdpdGggc29tZSBtZWFzdXJlIG9mIGV2ZW5uZXNzLiAgIAogICAKKk5vdGU6KiBNYW55IG9mIHRoZXNlIG1ldGhvZHMgYXJlIGdyZWF0bHkgaW5mbHVlbmNlZCBieSBzaW5nbGV0b24gZGF0YQooaS5lLiB0YXhhIHJlcHJlc2VudGVkIGJ5IGEgc2luZ2xlIGNvdW50KSwgbWVhbmluZyB0aGV5IG1heSBiZSB1bnJlbGlhYmxlIGlmIHlvdXIKZGF0YSBleGNsdWRlcyBzaW5nbGV0b25zLgpEQURBMiBkb2VzIG5vdCBvdXRwdXQgc2luZ2xldG9ucyBpZiBpdCBpcyBydW4gaW5kaXZpZHVhbGx5IG9uIGVhY2ggc2FtcGxlLgpUaHVzLCBpZiB1c2luZyBkYWRhMiB0byBpbmZlciBBU1ZzLCBpdCBpcyBhZHZpc2FibGUgdG8gdXNlIGBwb29sID0gVFJVRWAgd2hlbgpydW5uaW5nIHRoZSBkYWRhIGFsZ29yaXRobS4KVGhpcyB3aWxsIGFsbG93IGNhbGxpbmcgcGVyLXNhbXBsZSBzaW5nbGV0b25zLCBidXQgbm90IHBlci1zdHVkeSBzaW5nbGV0b25zLiAgIAogICAKIyMjIFRheG9ub21pYyByaWNobmVzczogUmFyZWZhY3Rpb24gcGxvdAoKT3VyIGdvYWwgaW4gZGVmaW5pbmcgcmljaG5lc3MgaXMgdG8gZGV0ZXJtaW5lIHRoZSBudW1iZXIgb2YgdW5pcXVlIHRheGEgd2l0aGluCmVhY2ggcG9wdWxhdGlvbiAoaW4gb3VyIGNhc2UsIGVhY2ggcGxvdCkuClRoaXMgaXMgZGlmZmljdWx0LCBhcyBvdXIgc2FtcGxlcyBjb250YWluIG9ubHkgYSBwb3J0aW9uIG9mIHRoZSB0b3RhbCByaWNobmVzcwp3aXRoaW4gb3VyIHBsb3RzLgpBcyBzZXF1ZW5jZSBkZXB0aCBpbmNyZWFzZXMgZm9yIGVhY2ggc2FtcGxlLCBzbyBkb2VzIHRoZSBudW1iZXIgb2YgdGF4YS4KVGhpcyBjYW4gYmUgaWxsdXN0cmF0ZWQgd2l0aCBhIHJhcmVmYWN0aW9uIHBsb3QuICAgCiAgIApUbyBtYWtlIGEgcmFyZWZhY3Rpb24gcGxvdCwgd2UgZHJhdyByYW5kb20gc2FtcGxlcyBmcm9tIG91ciBkYXRhIGFuZCBjb3VudCB0aGUKbnVtYmVyIG9mIHVuaXF1ZSBBU1ZzIGFzIHNhbXBsZXMgYXJlIGRyYXduLgpUaGUgcmVzdWx0aW5nIHJhcmVmYWN0aW9uIGN1cnZlIGlzIGV4cGVjdGVkIHRvIHJpc2UgcXVpY2tseSB0aGVuIHBsYXRldSBhcyB0aGUKbW9zdCBhYnVuZGFudCB0YXhhIGFyZSByZXByZXNlbnRlZC4KV2UgY2FuIG1ha2UgYSBxdWljayByYXJlZmFjdGlvbiBjdXJ2ZSBwbG90IGRpcmVjdGx5IGZyb20gb3VyIGBwaHlsb3NlcWAgb2JqZWN0IG9mCmFsbCBzYW1wbGVzIHVzaW5nIHRoZQpbYHZlZ2FuYCBwYWNrYWdlXShodHRwczovL3BlYXQtY2xhcmsuZ2l0aHViLmlvL0JJTzM4MS92ZWdhblR1dG9yaWFsLmh0bWwpOgoKYGBge3IgcmFyZWN1cnZlfQpyYXJlY3VydmUob3R1X3RhYmxlKHBzKSwgc3RlcCA9IDUwMCwgeGxhYiA9ICJTYW1wbGUgU2l6ZSIsIHlsYWIgPSAiVGF4YSIpCmBgYAogICAKV2UgY2FuIGFsc28gc3BsaXQgcmFyZWZhY3Rpb24gY3VydmVzIGJ5IGdyb3VwIHVzaW5nIHRoZQpbYGFtcHZpczJgIHBhY2thZ2VdKGh0dHBzOi8vbWFkc2FsYmVydHNlbi5naXRodWIuaW8vYW1wdmlzMi9hcnRpY2xlcy9hbXB2aXMyLmh0bWwpLgoKYGBge3IgcmFyZWZhY3Rpb24xfQptZXRhZGF0YSA8LSBkYXRhLmZyYW1lKHNhbXBsZV9kYXRhKHBzKSwgY2hlY2submFtZXMgPSBGQUxTRSkKCmFzdl90YWJsZSA8LSBkYXRhLmZyYW1lKHQob3R1X3RhYmxlKHBzKSksCiAgICAgICAgICAgICAgICAgICAgICAgdGF4X3RhYmxlKHBzKSwKICAgICAgICAgICAgICAgICAgICAgICBjaGVjay5uYW1lcyA9IEZBTFNFKQpgYGAKCmBhbXB2aXMyYCByZXF1aXJlcyBhIGBTcGVjaWVzYCBjb2x1bW4sIHdoaWNoIG11c3QgYmUgYWRkZWQgdG8gb3VyIGRhdGEuCklmIHlvdXIgdGFibGUgYWxyZWFkeSBoYXMgYSBgU3BlY2llc2AgY29sdW1uLCBza2lwIHRoaXMgc3RlcDoKCmBgYHtyIGFkZF9TcGVjaWVzfQphc3ZfdGFibGUkU3BlY2llcyA8LSBOQQpgYGAKCkxvYWQgYW4gYGFtcHZpczJgIG9iamVjdCBhbmQgY2FsY3VsYXRlIHJhcmVmYWN0aW9uOgoKYGBge3IgcmFyZWN1cnZlX2FtcHZpczIsIGNhY2hlPVRSVUUsIHdhcm5pbmc9RkFMU0V9CnBzMyA8LSBhbXBfbG9hZChhc3ZfdGFibGUsIG1ldGFkYXRhKQoKcmFyX3Bsb3QgPC0gYW1wX3JhcmVjdXJ2ZShwczMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlcHNpemUgPSAxMDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmFjZXRfYnkgPSAiVGltZXBvaW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcl9ieSA9ICJUcmVhdG1lbnQiKSArCiAgIHlsYWIoIk51bWJlciBvZiBvYnNlcnZlZCBBU1ZzIikKCnJhcl9wbG90CmBgYAogICAKQXMgd2UgY2FuIHNlZSwgYXMgcmVhZCBkZXB0aCBpbmNyZWFzZXMgZm9yIGVhY2ggc2FtcGxlLCBzbyBkb2VzIHRheG9ub21pYyByaWNobmVzcy4KSW4gYWxsIHNhbXBsZXMsIGluY3JlYXNlZCBzYW1wbGluZyB3b3VsZCByZXN1bHQgaW4gaW5jcmVhc2VkIHJpY2huZXNzLgpUaHVzLCBvdXIgb2JzZXJ2ZWQgc2FtcGxlIHJpY2huZXNzIGlzIGxvd2VyIHRoYW4gdGhlIHRydWUgcG9wdWxhdGlvbiByaWNobmVzcyBmb3IKZXZlcnkgcGxvdC4KCkZ1cnRoZXIsIHNlcXVlbmNlIGRlcHRoIGFuZCB0b3RhbCByaWNobmVzcyBhcHBlYXIgdG8gYmUgY29ycmVsYXRlZCBhY3Jvc3Mgc2FtcGxlczoKCmBgYHtyIGNvcnIsIHdhcm5pbmc9RkFMU0V9CmRwX2J5X2FzdiA8LSBkYXRhLmZyYW1lKGN0X3N1bXMgPSBzYW1wbGVfc3VtcyhwcyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFzdnMgPSByb3dTdW1zKG90dV90YWJsZShwcykgIT0gMCkpCgpnZ3Bsb3QoZGF0YSA9IGRwX2J5X2FzdikgKwogIGdlb21fcG9pbnQoYWVzKHggPSAgY3Rfc3VtcywgeSA9IGFzdnMpKSArCiAgbGFicyh4ID0gIlNlcXVlbmNlIGRlcHRoIiwgeT0gIkFTViBjb3VudCIpICsKICB0aGVtZV9taW5pbWFsKCkKYGBgCgpXZSBjYW4gdGVzdCB3aGV0aGVyIHRoaXMgY29ycmVsYXRpb24gaXMgc2lnbmlmaWNhbnQ6CgpgYGB7cn0KY29yIDwtIGNvci50ZXN0KGRwX2J5X2FzdiRjdF9zdW1zLCBkcF9ieV9hc3YkYXN2cywgbWV0aG9kID0gInNwZWFybWFuIikKY29yCmBgYAoKSGVyZSB3ZSBvYnNlcnZlIGEgc2lnbmlmaWNhbnQgY29ycmVsYXRpb24gYmV0d2VlbiByZWFkIGNvdW50IGFuZCBvYnNlcnZlZAp0YXhvbm9taWMgcmljaG5lc3MuICAgCiAgIApUaHVzLCBhIHNhbXBsZSBmcm9tIGEgcG9wdWxhdGlvbiB3aXRoIGhpZ2ggYWN0dWFsIGRpdmVyc2l0eSwgYnV0IGxvdyByZWFkIGRlcHRoLApjb3VsZCBoYXZlIGxvdyBvYnNlcnZlZCByaWNobmVzcy4KRm9ydHVuYXRlbHksIHRoZXJlIGFyZSBtZXRob2RzIHRvIGVzdGltYXRlIHRoZSBudW1iZXIgb2YgdW5vYnNlcnZlZCB0YXhhLgpGb3IgYW4gb3ZlcnZpZXcgb2YgdGhlc2UgbWV0aG9kcywgcmVhZApbQnVuZ2UgZXQgYWwuIDIwMTRdKGh0dHA6Ly93d3cuYW5udWFscmV2aWV3cy5vcmcvZG9pLzEwLjExNDYvYW5udXJldi1zdGF0aXN0aWNzLTAyMjUxMy0xMTU2NTQpLgogICAKIyMjIEZyZXF1ZW5jeSBjb3VudHMKClRvIGlsbHVzdHJhdGUgdGhlIGRpZmZpY3VsdHkgb2YgZXN0aW1hdGluZyBwb3B1bGF0aW9uIHJpY2huZXNzIGFuZCBpbXBvcnRhbmNlIG9mCnNpbmdsZXRvbnMgdG8gYWxwaGEgZGl2ZXJzaXR5IG1ldHJpY3MsCndlJ2xsIGxvb2sgYXQgdGhlIGZyZXF1ZW5jeSBjb3VudCBkaXN0cmlidXRpb24gZm9yIG91ciBmaXJzdCBzYW1wbGU6IDEwMS1TMS4KCldlJ2xsIGNvdW50IHRoZSBudW1iZXIgb2Ygc2luZ2xldG9ucywgZG91YmxldG9ucywgZXRjLiwKdGhlbiBwbG90IGZyZXF1ZW5jeSBhcyBhIGZ1bmN0aW9uIG9mIGNvdW50LgoKYGBge3IgZnJlcV9jdCwgbWVzc2FnZT1GQUxTRX0KIyBHZXQgdGhlIGZyZXF1ZW5jeSBjb3VudCBkaXN0cmlidXRpb24gZm9yIHRoZSAxc3Qgc2FtcGxlOgpmcmVxdWVuY3l0YWJsZWxpc3QgPC0gYnVpbGRfZnJlcXVlbmN5X2NvdW50X3RhYmxlcyhvdHVfdGFibGUocHMpKQpmcmVxX2N0IDwtIGZyZXF1ZW5jeXRhYmxlbGlzdFtbMV1dCmNvbG5hbWVzKGZyZXFfY3QpIDwtIGMoIkZyZXF1ZW5jeSIsICJDb3VudCIpCgojIFBsb3Q6CmdncGxvdChmcmVxX2N0LCBhZXMoRnJlcXVlbmN5LCBDb3VudCkpICsgCiAgZ2VvbV9wb2ludCgpICsgCiAgc2NhbGVfeF9jb250aW51b3VzKGJyZWFrcyA9IHNlcSgwLCA2MDAsIGJ5ID0gNTApKSArIAogIGdndGl0bGUoIjEwMS1TMSIpICsKICB0aGVtZV9taW5pbWFsKCkKYGBgCiAgIApXZSBjYW4gc2VlIHRoZXJlIGFyZSB+MywyMDAgdGF4YSByZXByZXNlbnRlZCBhcyBzaW5nbGV0b25zLAphbmQgfjEsNjAwIHRheGEgYXMgZG91YmxldG9ucy4gClRoaXMgaXMgYSBoaWdoIHByb3BvcnRpb24gb2YgdGhlIHRvdGFsIG51bWJlciB0YXhhIGFyZSBvYnNlcnZlZCBpbiB0aGlzIHNhbXBsZToKCmBgYHtyfQojIFRvdGFsIG51bWJlciBvZiB0YXhhOgpzdW0oZnJlcV9jdCRDb3VudCkKCiMgUHJvcG9ydGlvbiBvZiBzaW5nbGV0b25zCmZyZXFfY3QkQ291bnRbMV0gLyBzdW0oZnJlcV9jdCRDb3VudCkKYGBgCgpIb3cgbWFueSBtb3JlIHRheGEgbWlnaHQgd2Ugb2JzZXJ2ZSBpZiB3ZSBpbmNyZWFzZWQgb3VyIHNhbXBsaW5nPyAgIAoKIyMjIERpdmVyc2l0eSBJbmRpY2VzCgpXZSBjYW4gdXNlIHNldmVyYWwgaW5kaWNlcyB0byBleHBsb3JlIGhvdyBldmVubHkgc3BlY2llcyBhcmUgZGlzdHJpYnV0ZWQgd2l0aGluCmVhY2ggc2FtcGxlLiBOb3RlIHRoYXQgJ09ic2VydmVkJyBpcyB0aGUgc2FtcGxlIHRheG9ub21pYyByaWNobmVzcy4KVGhlIG90aGVyIHRocmVlIGluZGljZXMgY29tYmluZSByaWNobmVzcyBhbmQgYWJ1bmRhbmNlIGRhdGEgZm9yIGVhY2ggdGF4b24uCgpgYGB7ciBhbHBoYV9kaXZ9CnBsb3RfcmljaG5lc3MocHMsCiAgICAgICAgICAgICAgeCA9ICJUaW1lcG9pbnQiLAogICAgICAgICAgICAgIHNoYXBlID0gIlRyZWF0bWVudCIsCiAgICAgICAgICAgICAgY29sb3IgPSAiVHJlYXRtZW50IiwgCiAgICAgICAgICAgICAgbWVhc3VyZXMgPSBjKCJPYnNlcnZlZCIsICJTaGFubm9uIiwgIlNpbXBzb24iLCAiSW52U2ltcHNvbiIpKQpgYGAKICAgCk5vdGljZSB0aGF0IHNldmVyYWwgVDI6UzMgc2FtcGxlcyBoYXZlIGxvdyBtZWFzdXJlcywKc3VnZ2VzdGluZyB0aGV5IGhhdmUgbG93IGRpdmVyc2l0eSAoaS5lLiBhYnVuZGFuY2VzIGFyZSBkb21pbmF0ZWQgYnkgYSBmZXcgdGF4YSkKY29tcGFyZWQgdG8gdGhlIG90aGVyIHNhbXBsZXMuCiAKLS0tLS0KCiMjIEJldGEgZGl2ZXJzaXR5CgpCZXRhIGRpdmVyc2l0eSBtZWFzdXJlcyBkaWZmZXJlbmNlcyBpbiBtaWNyb2JpYWwgY29tcG9zaXRpb25zIGJldHdlZW4gcG9wdWxhdGlvbnMuCklmIGF2YWlsYWJsZSAodXNlIHBzXzE2U19WNF93aXRodHJlZS5yZHMpLCB3ZSBjYW4gdXNlIGEgcGh5bG9nZW5ldGljIHRyZWUgYW5kIG90dQp0YWJsZSB0byBlc3RpbWF0ZSB0aGUgW1VuaUZyYWNdKGh0dHBzOi8vZG9pLm9yZy8xMC4xMTI4L0FFTS43MS4xMi44MjI4LTgyMzUuMjAwNSkKZm9yIGVhY2ggc2FtcGxlIHBhaXIuCgpUaGUgcmVzdWx0IGlzIGEgZGlzdGFuY2UgbWF0cml4IHdpdGggaGVpZ2h0IGFuZCB3aWR0aCBlcXVhbCB0byB0aGUgbnVtYmVyIG9mIHNhbXBsZXMuClVuaUZyYWMgbWF5IGJlIFt3ZWlnaHRlZCBvciB1bndlaWdodGVkXShodHRwczovL2RvaS5vcmcvMTAuMTEyOC9BRU0uMDE5OTYtMDYpLgpTZWxlY3Rpb24gb2Ygd2VpZ2h0ZWQgb3IgdW53ZWlnaHRlZCB3aWxsIGRlcGVuZCBvbiB0aGUgcXVlc3Rpb24geW91IHdhbnQgdG8gYW5zd2VyLgpVbndlaWdodGVkIFVuaUZyYWMgdXNlcyBvbmx5IHByZXNlbmNlIG9yIGFic2VuY2Ugb2YgYSB0YXhvbiBmcm9tIHRoZSBvdHUgdGFibGUKKGkuZS4gMTAwMCB3aWxsIGJlIHRyZWF0ZWQgdGhlIHNhbWUgYXMgMSkuCkl0IGlzIGFwcHJvcHJpYXRlIGlmIHlvdSB3YW50IHRvIHRlc3QgcXVhbGl0YXRpdmUgdGF4YSBkaWZmZXJlbmNlcyBiZXR3ZWVuIHNhbXBsZXMuCldlaWdodGVkIFVuaUZyYWMgdXNlcyBwcmVzZW5jZSBhcyB3ZWxsIGFzIHF1YW50aXR5IGRhdGEgKGkuZS4gMSA8IDEwMDApLgoKV2UgYXJlIGludGVyZXN0ZWQgdG8ga25vdyB3aGF0IGNoYW5nZXMgdG8gdGF4b24gYWJ1bmRhbmNlIG1heSBiZSBkcml2ZW4gYnkgb3VyIHRyZWF0bWVudHMsIHNvIHdlIHdpbGwgdXNlIHdlaWdodGVkIFVuaUZyYWMuICAgIAoKIyMjIE9yZGluYXRpb24KCkZpcnN0IHdlJ2xsIG1ha2UgYSB3ZWlnaHRlZCBVbmlGcmFjIGRpc3RhbmNlIG1hdHJpeC4KRm9yIFVuaUZyYWMsIHlvdSByZXF1aXJlIGEgdHJlZSBhcyBwYXJ0IG9mIHlvdXIgKnBoeWxvc2VxKiBvYmplY3QuCgpgYGB7ciB3VUYsIHdhcm5pbmc9RkFMU0UsIGNhY2hlPUZBTFNFfQpzZXQuc2VlZCgxMDApCndVRiA8LSBwaHlsb3NlcTo6ZGlzdGFuY2UocHNfcHJvcCwgbWV0aG9kID0gInd1bmlmcmFjIikKCmFzLm1hdHJpeCh3VUYpWzE6NiwgMTo2XQoKIyBOb3RlOiBJZiB5b3VyICpwaHlsb3NlcSogb2JqZWN0IGxhY2tzIGEgcGh5bG9nZW5ldGljIHRyZWUsCiMgeW91IGNvdWxkIHVzZSBhIGRpc3NpbWlsYXJpdHkgaW5kZXggdGhhdCBkb2VzIG5vdCByZXF1aXJlIG9uZSwgc3VjaCBhcyBCcmF5LUN1cnRpczoKIyBicmF5IDwtIHZlZ2FuOjp2ZWdkaXN0KG90dV90YWJsZShwc19wcm9wKSwgbWV0aG9kID0gImJyYXkiKQojIGFzLm1hdHJpeChicmF5KVsxOjYsMTo2XQpgYGAKClRoZW4gcGVyZm9ybSBQcmluY2lwYWwgQ29vcmRpbmF0ZSBBbmFseXNpcyAoUENvQSkgb24geW91ciBmYXZvcml0ZSBkaXN0YW5jZSBtYXRyaXguCkluIHRoaXMgY2FzZSwgd2UgYXJlIHVzaW5nIHdlaWdodGVkIFVuaUZyYWMuCgpgYGB7ciBvcmRpbmF0ZSwgd2FybmluZz1GQUxTRSwgY2FjaGU9RkFMU0V9CmRvIDwtIG9yZGluYXRlKHBzX3Byb3AsIG1ldGhvZCA9ICJQQ29BIiwgZGlzdGFuY2UgPSB3VUYpCgpiYXNlcGxvdCA8LSBwbG90X29yZGluYXRpb24ocHNfcHJvcCwgZG8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gInNhbXBsZXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSAiVHJlYXRtZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXBlID0gIlRpbWVwb2ludCIpICsKICBnZ3RpdGxlKCJIQ0Mgb3JkaW5hdGlvbiwgYWxsIHNhbXBsZXNcbm1ldGhvZD1QQ29BLCBkaXN0YW5jZT13ZWlnaHRlZCBVbmlGcmFjIikgKwogIHRoZW1lX2J3KCkKCiMgU2luZ2xlIHBsb3Qgd2l0aCBhbGwgc2FtcGxlczoKYmFzZXBsb3QgKwogIGdlb21fcG9pbnQoc2l6ZSA9IDIpCiAgCiMgSWRlbSwgYnV0IHdpdGggc2FtcGxlIG5hbWVzIG9uIHRoZSBwbG90OiAKYmFzZXBsb3QgKwogIGdlb21fcG9pbnQoc2l6ZSA9IDEpICsgCiAgZ2VvbV9sYWJlbChhZXMobGFiZWwgPSBTYW1wbGVJRCksIHNpemUgPSAzLjUsIGNvbG9yID0gImJsYWNrIikKCiMgRmFjZXQgYnkgdGltZSBwb2ludDoKYmFzZXBsb3QgKwogIGdlb21fcG9pbnQoc2l6ZSA9IDIpICsgCiAgZ2d0aXRsZSgiSENDIG9yZGluYXRpb24sIGFsbCBzYW1wbGVzXG5tZXRob2Q9UENvQSwgZGlzdGFuY2U9d2VpZ2h0ZWQgVW5pRnJhYyIpICsKICBmYWNldF93cmFwKH5UaW1lcG9pbnQsIDIpCmBgYAogICAKV2UgY2FuIHNlZSBzb21lIGdyb3VwaW5nIGJ5IHRpbWVwb2ludC4KRGVwZW5kaW5nIG9uIHlvdXIgZXhwZXJpbWVudCBhbmQgcXVlc3Rpb25zLAp5b3UgbWlnaHQgd2FudCB0byBjb25zaWRlciBvdGhlciBvcmRpbmF0aW9uIG9yIGNsdXN0ZXJpbmcgYXBwcm9hY2hlcy4KCiMjIyBQZXJtdXRhdGlvbmFsIGFuYWx5c2lzIG9mIHZhcmlhbmNlIChQRVJNQU5PVkEpCgpGaW5hbGx5LCB3ZSdsbCB0ZXN0IHdoZXRoZXIgdGhlcmUgaXMgYSBzaWduaWZpY2FudCBlY29sb2dpY2FsIGxldmVsIHRyZWF0bWVudCBlZmZlY3QuCipQRVJNQU5PVkEqIHNvdW5kcyBmYW5jeSwgYnV0IGl0IGlzIGp1c3QgYW4gKkFOT1ZBKiBwZXJmb3JtZWQgdXNpbmcgcGVybXV0YXRpb25zLgpQZXJtdXRhdGlvbnMgYXJlIHVzZWQgdG8gZGV0ZXJtaW5lIGhvdyBkYXRhIG1heSBhcHBlYXIgaWYgdGhlcmUgaXMgbm8gdHJlYXRtZW50CmVmZmVjdCBhbmQgZ3JvdXAgZGlmZmVyZW5jZXMgYXJlIGR1ZSB0byByYW5kb20gY2hhbmNlLiBPYnNlcnZlZCBkYXRhIGFyZSB0aGVuCmNvbXBhcmVkIHRvIHRoZSByYW5kb21pemVkIGRhdGEgdG8gY2FsY3VsYXRlIGEgcC12YWx1ZS4gICAKICAgClRyZWF0bWVudHMgYXJlIGluZGVwZW5kZW50IHdpdGhpbiBUaW1lcG9pbnRzLApzbyB3ZSB3aWxsIGZpcnN0IHN1YnNldCB0aGUgZGF0YSBieSBUaW1lcG9pbnQ6CgpgYGB7ciBzdWJzZXRfVGltZXBvaW50cywgd2FybmluZz1GQUxTRX0KcHNfUzEgPC0gc3Vic2V0X3NhbXBsZXMocHNfcHJvcCwgVGltZXBvaW50ID09ICJTMSIpCnBzX1MzIDwtIHN1YnNldF9zYW1wbGVzKHBzX3Byb3AsIFRpbWVwb2ludCA9PSAiUzMiKQpwc19TNCA8LSBzdWJzZXRfc2FtcGxlcyhwc19wcm9wLCBUaW1lcG9pbnQgPT0gIlM0IikKYGBgCgpTdWJzZXQgdGhlIG1ldGFkYXRhIGFuZCBlc3RpbWF0ZSBVbmlGcmFjIGZvciBTMzoKCmBgYHtyIHNldF9wZXJtLCB3YXJuaW5nPUZBTFNFfQptZXRhZGF0YSA8LSBhcyhzYW1wbGVfZGF0YShwc19TMyksICJkYXRhLmZyYW1lIikKdW5pZnJhY19kaXN0IDwtIFVuaUZyYWMocHNfUzMsIHdlaWdodGVkID0gVFJVRSkKYGBgCgpUaGVuIHdlJ2xsIHVzZSBgdmVnYW46OmFkb25pczJgIHRvIHBlcmZvcm0gdGhlICpQRVJNQU5PVkEqLgoKYGBge3IgUEVSTUFOT1ZBfQpzZXQuc2VlZCgxMDApICAjIFNldCB0aGUgc2VlZCB0byBtYWtlIHRoZSBhbmFseXNpcyByZXByb2R1Y2libGUKCnBlcm1hbm92YSA8LSBhZG9uaXMyKHVuaWZyYWNfZGlzdCB+IFRyZWF0bWVudCwKICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG1ldGFkYXRhLAogICAgICAgICAgICAgICAgICAgICBwZXJtdXRhdGlvbnMgPSAxMDAwMCkKCnBlcm1hbm92YQpgYGAKClRoZSBsb3cgcC12YWx1ZSBzdWdnZXN0cyB0aGF0IHdpdGhpbiB0aGUgUzMgdGltZXBvaW50IChwb3N0LXRlcm1pbmF0aW9uKSwKdGhlcmUgaXMgYSBzaWduaWZpY2FudCB0cmVhdG1lbnQgZWZmZWN0LiAgIAogCi0tLS0tCgojIyBEaWZmZXJlbnRpYWwgdGF4b24gYWJ1bmRhbmNlIChERVNlcSkKCkhlcmUsIHdlIHdpbGwgdXNlCltERVNlcTJdKGh0dHBzOi8vYmlvY29uZHVjdG9yLm9yZy9wYWNrYWdlcy9yZWxlYXNlL3dvcmtmbG93cy92aWduZXR0ZXMvcm5hc2VxR2VuZS9pbnN0L2RvYy9ybmFzZXFHZW5lLmh0bWwpCnRvIGlkZW50aWZ5IGRpZmZlcmVudGlhbGx5IGFidW5kYW50IHRheGEgYmV0d2VlbiB0aW1lIHBvaW50cyBhbmQgdHJlYXRtZW50cy4KKkRFU2VxMiogd2FzIGRlc2lnbmVkIHRvIGFuYWx5emUgUk5Bc2VxIGRhdGFzZXRzLCB3aGljaCBhcmUgc2ltaWxhciB0byBPVFUvQVNWIGRhdGEgCnNldHMgaW4gdGhhdCBib3RoIGhhbmRsZSBsYXJnZSwgc3BhcnNlIGNvbnRpbmdlbmN5IHRhYmxlcyBnZW5lcmF0ZWQgZnJvbSBJbGx1bWluYQpzZXF1ZW5jaW5nIGRhdGEuCkZvciBtb3JlIGRldGFpbHMsIHNlZQpbTWNNdXJkaWUgYW5kIEhvbG1lcyAyMDE0XShodHRwczovL2R4LnBsb3Mub3JnLzEwLjEzNzEvam91cm5hbC5wY2JpLjEwMDM1MzEpLiAgCiAgCkZpcnN0LCB3ZSdsbCBjb252ZXJ0IG91ciBub24tbm9ybWFsaXplZCBjb3VudCBkYXRhIHRvIGEgKkRFU2VxKiBvYmplY3QuCgpgYGB7ciBwczJkc3MsIG1lc3NhZ2U9RkFMU0UsIHdhcm5pbmc9RkFMU0V9CmRkcyA8LSBwaHlsb3NlcV90b19kZXNlcTIocHMsIH5UaW1lcG9pbnQgKyBUcmVhdG1lbnQpCgpkZHMKY29sRGF0YShkZHMpCmBgYAoKVGhlcmUgYXJlIHR3byB3YXlzIHRvIGFuYWx5emUgaW50ZXJhY3Rpb24gZWZmZWN0cyB1c2luZyAqREVTZXEyKi4KVGhlIGZpcnN0IGlzIHRvIGZpdCBhIG11bHRpdmFyaWF0ZSBtb2RlbCAoZS5nLiB+QStCK0E6QikgYW5kIGV4cGxvcmUgdGhlIG1vZGVsCmNvZWZmaWNpZW50cy4KVGhlIHNlY29uZCBpcyB0byBmaXQgYSB1bml2YXJpYXRlIG1vZGVsIGFuZCBleHBsb3JlIHBhaXJ3aXNlIGNvbnRyYXN0cy4KSGVyZSwgd2Ugd2lsbCBncm91cCBvdXIgdHdvIGZhY3RvcnMgKFRyZWF0bWVudCBhbmQgVGltZXBvaW50KSBhbmQgdXNlIHRoZSBsYXR0ZXIKYXBwcm9hY2guCgpgYGB7ciBkZWcsIG1lc3NhZ2U9RkFMU0UsIGNhY2hlPUZBTFNFfQojIFByZXBhcmUgdGhlIGRhdGE6CmRkcyRHcm91cCA8LSBmYWN0b3IocGFzdGUwKGRkcyRUcmVhdG1lbnQsIGRkcyRUaW1lcG9pbnQpKQpkZXNpZ24oZGRzKSA8LSBmb3JtdWxhKH5Hcm91cCkKZGRzIDwtIGRkc1ssIC01MF0gICAgICAgICAgICAgICAgICAgICMgUmVtb3ZlIHRlY2hfcmVwIHNhbXBsZQpkZHMkR3JvdXAgPC0gZHJvcGxldmVscyhkZHMkR3JvdXApICAgIyBEcm9wIHRlY2hfcmVwIGxldmVsIGZyb20gZGVzaWduIG1hdHJpeAoKIyBQZXJmb3JtIHRoZSBkaWZmZXJlbnRpYWwgYWJ1bmRhbmNlIGFuYWx5c2lzOgpkZHMgPC0gREVTZXEoZGRzKQoKcmVzdWx0cyhkZHMpCmBgYAogICAgCkxldCdzIGV4cGxvcmUgdGhlIGNvbnRyYXN0LCAiVDFTNCA6IFQ0UzQiCihubyBjYywgc2VlZGxpbmcgc3RhZ2UgOiBsYXRlIHRlcm1pbmF0aW9uLCBzZWVkbGluZyBzdGFnZSk6CgpgYGB7cn0KcmVzIDwtIHJlc3VsdHMoZGRzLCBjb250cmFzdCA9IGMoIkdyb3VwIiwgIlQxUzQiLCAiVDRTNCIpKQpzdW1tYXJ5KHJlcykKCiMgTnVtYmVyIG9mIHRheGEgd2l0aCBzaWduaWZpY2FudGx5IGhpZ2hlciBhYnVuZGFuY2UgaW4gVDRTNDoKc3VtKHJlcyRwYWRqIDwgMC4xICYgcmVzJGxvZzJGb2xkQ2hhbmdlID4gMCwgbmEucm0gPSBUUlVFKQoKIyBOdW1iZXIgb2YgdGF4YSB3aXRoIHNpZ25pZmljYW50bHkgbG93ZXIgYWJ1bmRhbmNlIGluIFQ0UzQ6CnN1bShyZXMkcGFkaiA8IDAuMSAmIHJlcyRsb2cyRm9sZENoYW5nZSA8IDAsIG5hLnJtID0gVFJVRSkKYGBgCgpXZSBjYW4gc29ydCByZXN1bHRzIGJ5IHAtdmFsdWUgYW5kIGxvb2sgYXQgdGhlIHRvcCBBU1ZzOgoKYGBge3J9CnJlcy5vcmRlciA8LSByZXNbb3JkZXIocmVzJHB2YWx1ZSksIF0KaGVhZChyZXMub3JkZXIpW2MoMToyLCA2KV0KYGBgCgpBbmQgcGxvdCBjb3VudHMgZm9yIHRoZSBmaXJzdCBpbiB0aGUgb3JkZXJlZCBsaXN0IEFTVjoKCmBgYHtyIHBsb3RfY291bnRzfQpwbG90Q291bnRzKGRkcywgZ2VuZSA9IHJlcy5vcmRlckByb3duYW1lc1sxXSwgaW50Z3JvdXAgPSAiR3JvdXAiKQpgYGAKICAgCldlIGNhbiBhbHNvIHBsb3QgY291bnRzIGJ5IHNhbXBsZV9JRDoKCmBgYHtyIHBsb3RfY291bnRzMn0KcGxvdENvdW50cyhkZHMsIGdlbmUgPSAiQVNWXzQ4IiwgaW50Z3JvdXAgPSAiR3JvdXAiKQpgYGAKClRoZSBwbG90IGNhbiBhbHNvIGJlIHNhdmVkIGFuZCBjdXN0b21pemVkIHdpdGggZ2dwbG90OgoKYGBge3J9CmQgPC0gcGxvdENvdW50cyhkZHMsIGdlbmUgPSAiQVNWXzQ4IiwgaW50Z3JvdXAgPSAiR3JvdXAiLCByZXR1cm5EYXRhID0gVFJVRSkKCmdncGxvdChkLCBhZXMoeCA9IEdyb3VwLCB5ID0gY291bnQpKSArCiAgZ2VvbV9wb2ludChwb3NpdGlvbiA9IHBvc2l0aW9uX2ppdHRlcih3ID0gMC4xLCBoID0gMCksIHNpemUgPSAyKSArCiAgc2NhbGVfeV9sb2cxMCgpICsKICBnZ3RpdGxlKGV4cHJlc3Npb24ocGFzdGUoIkFTViA0OCwgbG9nIlsxMF0sICItc2NhbGUiKSkpICsKICB0aGVtZV9idygpCmBgYAogICAKV2UgY2FuIGFsc28gc3Vic2V0IG91ciBkaWZmZXJlbnRpYWxseSBhYnVuZGFudCB0YXhhIHRvIGtlZXAgdGhvc2Ugd2l0aCBhbgphZGp1c3RlZCBwLXZhbHVlIDwgMC4wNToKCmBgYHtyIGZpbHRlcl8wNX0Kc2lnIDwtIHN1YnNldChyZXMub3JkZXIsIHBhZGogPD0gMC4wNSkKaGVhZChzaWcpCmBgYAoKV2hhdCB0YXhhIGFyZSBhc3NvY2lhdGVkIHdpdGggc2lnbmlmaWNhbnRseSBkaWZmZXJlbnRpYWxseSBhYnVuZGFudCBBU1ZzPwoKYGBge3Igc2lnX3RheGF9CnNpZ19hc3YgPC0gcm93bmFtZXMoc2lnKQpzaWdfdGF4YSA8LSB0YXhfdGFibGUocHMpW3NpZ19hc3YsXQpoZWFkKHNpZ190YXhhKQoKc2lnX3dyaXRlIDwtIGNiaW5kKHNpZywgc2lnX3RheGEpCndyaXRlLmNzdihzaWdfd3JpdGUsIGZpbGUucGF0aChvdXRkaXIsICdEQVRheGFfVDFTMV9UMVM0LmNzdicpKQpgYGAKClJlcG9ydCB0aGF0IHdlIGFyZSBkb25lIQoKYGBge3IgcmVwb3J0X2RvbmV9CnByaW50KCdEb25lIHdpdGggQVNWIGluZmVyZW5jZS4nKQpgYGAKCi0tLS0tCgojIyBSZXNvdXJjZXMKCi0gW2BkZWNvbnRhbWAgdHV0b3JpYWxdKGh0dHBzOi8vYmVuampuZWIuZ2l0aHViLmlvL2RlY29udGFtL3ZpZ25ldHRlcy9kZWNvbnRhbV9pbnRyby5odG1sKQoKLSBbYHZlZ2FuYCB0dXRvcmlhbF0oaHR0cHM6Ly9wZWF0LWNsYXJrLmdpdGh1Yi5pby9CSU8zODEvdmVnYW5UdXRvcmlhbC5odG1sKQoKLSBbYERFU2VxMmAgdHV0b3JpYWxdKGh0dHA6Ly9iaW9jb25kdWN0b3Iub3JnL3BhY2thZ2VzL2RldmVsL2Jpb2MvdmlnbmV0dGVzL0RFU2VxMi9pbnN0L2RvYy9ERVNlcTIuaHRtbCkKCi0gW0ludHJvIGNvdXJzZSBvbiBtaWNyb2Jpb21lIGFuYWx5c2lzXShodHRwczovL21pYnd1cnJlcG8uZ2l0aHViLmlvL01pY3JvYmlhbC1iaW9pbmZvcm1hdGljcy1pbnRyb2R1Y3RvcnktY291cnNlLU1hdGVyaWFsLTIwMTgvKQoKLSBbVW5pRnJhYyBwdWJsaWNhdGlvbl0oaHR0cHM6Ly9kb2kub3JnLzEwLjExMjgvQUVNLjcxLjEyLjgyMjgtODIzNS4yMDA1KQotIFtBZGRpdGlvbmFsIFVuaUZyYWMgcHVibGljYXRpb25dKGh0dHBzOi8vZG9pLm9yZy8xMC4xMTI4L0FFTS4wMTk5Ni0wNikKCi0gKipBcnRpY2xlcyBvbiBkYXRhIG5vcm1hbGl6YXRpb246KiogICAKICAgLSBbV2FzdGUgbm90LCB3YW50IG5vdDogd2h5IHJhcmlmeWluZyBtaWNyb2Jpb21lIGRhdGEgaXMgaW5hZG1pc3NpYmxlXShodHRwczovL2R4LnBsb3Mub3JnLzEwLjEzNzEvam91cm5hbC5wY2JpLjEwMDM1MzEpCiAgIC0gW01pY3JvYmlvbWUgZGF0YXNldHMgYXJlIGNvbXBvc2l0aW9uYWw6IGFuZCB0aGlzIGlzIG5vdCBvcHRpb25hbF0oaHR0cDovL2pvdXJuYWwuZnJvbnRpZXJzaW4ub3JnL2FydGljbGUvMTAuMzM4OS9mbWljYi4yMDE3LjAyMjI0L2Z1bGwpCiAgIC0gW01ldGhvZHMgZm9yIG5vcm1hbGl6aW5nIG1pY3JvYmlvbWUgZGF0YTogYW4gZWNvbG9naWNhbCBwZXJzcGVjdGl2ZV0oaHR0cDovL2RvaS53aWxleS5jb20vMTAuMTExMS8yMDQxLTIxMFguMTMxMTUpCiAgIC0gW0RpZmZlcmVudGlhbCBhYnVuZGFuY2UgYW5hbHlzaXMgZm9yIG1pY3JvYmlhbCBtYXJrZXItZ2VuZSBzdXJ2ZXlzXShodHRwOi8vd3d3Lm5hdHVyZS5jb20vYXJ0aWNsZXMvbm1ldGguMjY1OCkK</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("08-postASV-analysis.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
