<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title> Workflow part II: ASV Inference and Taxon Assignment</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>

<link rel="stylesheet" href="my.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Microbiomics Workshop</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Overview
  </a>
</li>
<li>
  <a href="00-setup.html">
    <span class="fa fa-gear"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Day 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lectures:</li>
    <li>
      <a href="01-microbiomics.html">Intro to Amplicon Sequencing</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Lecture/Code-along:</li>
    <li>
      <a href="02-shell.html">Intro to the Shell</a>
    </li>
    <li>
      <a href="03-OSC.html">Intro to OSC</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Workflow Sessions:</li>
    <li>
      <a href="04-data-overview.html">Overview</a>
    </li>
    <li>
      <a href="05-preprocess-reads.html">I: Adapter and Primer Removal</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Day 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture/Code-along:</li>
    <li>
      <a href="06-R.html">Intro to R</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Workflow Sessions:</li>
    <li>
      <a href="07-ASV-inference.html">II: ASV Inference</a>
    </li>
    <li>
      <a href="08-postASV-analysis.html">III: ASV Analysis</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mcic-osu/2020-12-microbiomics-workshop.git">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><br>Workflow part II:<br>ASV Inference and Taxon Assignment</h1>

</div>


<p><br></p>
<hr />
<div id="goals" class="section level2">
<h2>Goals</h2>
<p>Process metabarcoding reads, post-adapter removal, including:</p>
<ul>
<li>Evaluation of quality</li>
<li>Quality trimming and filtering</li>
<li>Error correction and denoising</li>
<li>Read merging</li>
<li>Assigning taxonomy</li>
</ul>
<hr />
</div>
<div id="before-we-get-started" class="section level2">
<h2>Before We Get Started</h2>
<div id="notes" class="section level3">
<h3>Notes</h3>
<ul>
<li><p>This documented was adapted from <a href="https://f1000research.com/articles/5-1492/v2">Callahan et al. 2006</a> by Matthew Willman, with further edits by Soledad Benitez Ponce and Jelmer Poelstra.</p></li>
<li><p>To convert an <code>Rmd</code> (R Markdown) file to an R script, type the following in an R console: <code>knitr::purl(input="&lt;filename&gt;.Rmd")</code>. (You can download this <code>Rmd</code> file by clicking the <code>Code</code> button in the top-right of this page – but we will open it at OSC.)</p></li>
</ul>
</div>
<div id="start-an-rstudio-server-job-at-osc" class="section level3">
<h3>Start an RStudio Server job at OSC</h3>
<p>For more detailed instructions of the first steps, see <a href="06-R.html#rstudio-at-OSC">this section</a> from our intro to R session.</p>
<ul>
<li><p>Login to OSC at <a href="https://ondemand.osc.edu" class="uri">https://ondemand.osc.edu</a>.</p></li>
<li><p>Click on <code>Interactive Apps</code> (top bar) &gt; <code>RStudio Server (Owens and Pitzer)</code>.</p></li>
<li><p>Fill out the form as shown <a href="slides/03-OSC-slides.html#rstudio_server_job">here</a>.</p></li>
<li><p>Once your job has started, click <code>Connect to RStudio Server</code>.</p></li>
<li><p>You should automatically be in your personal dir inside the dir <code>/fs/project/PAS0471/workshops/2020-12_micro</code>.</p>
<p>(In the <em>Files</em> pane in RStudio, you should see your <code>.Rproj</code> file. If not, type <code>setwd('/fs/project/PAS0471/workshops/2020-12_micro')</code> and then click on the dir with your name in the <em>Files</em> pane).</p></li>
<li><p>Now, click on the <code>markdown</code> directory in the <em>Files</em> pane, and open the file <code>06-reads-to-ASV.Rmd</code>. That’s this file!</p></li>
</ul>
<hr />
</div>
</div>
<div id="step-1-getting-started" class="section level2">
<h2>Step 1: Getting Started</h2>
<div id="install-and-load-packages" class="section level3">
<h3>Install and load packages</h3>
<p>To save time, we have already installed all the necessary R packages at OSC into a custom library. To add this library for the current R session:</p>
<pre class="r r_code"><code>.libPaths(new = &#39;/fs/project/PAS0471/.R/4.0/&#39;)</code></pre>
<p>Then, load the packages:</p>
<pre class="r r_code"><code>packages &lt;- c(&quot;ggplot2&quot;, &quot;gridExtra&quot;,
              &quot;dada2&quot;, &quot;phyloseq&quot;, &quot;DECIPHER&quot;, &quot;phangorn&quot;)
pacman::p_load(char = packages)

# If you wanted to install and load these packages yourself,
# just make sure you have the pacman package installed:
## install.packages(&#39;pacman&#39;)
# Then, the code above would work, as it will install pacakes as needed.</code></pre>
</div>
<div id="set-the-file-paths" class="section level3">
<h3>Set the file paths</h3>
<pre class="r r_code"><code># Dir with input fastq files:
indir &lt;- &quot;processed_data/fastq_trimmed/second_trim/&quot;

# Dir for output:
outdir &lt;- &#39;analysis/ASV_inference/&#39;
dir.create(outdir, recursive = TRUE)

# Fasta file with training data:
# (Check for an up-to-date version at &lt;https://benjjneb.github.io/dada2/training.html&gt;)
tax_key &lt;- &quot;data/ref/silva_nr99_v138_train_set.fa&quot; 

# File with sample metadata:
sample_names_file &lt;- &quot;metadata/sample_meta.txt&quot;</code></pre>
</div>
<div id="assign-files-to-forward-and-reverse-reads" class="section level3">
<h3>Assign files to forward and reverse reads</h3>
<p>For forward and reverse fastq filenames which have the following name format: <code>&lt;SAMPLENAME&gt;_R1_001.fastq</code> and <code>&lt;SAMPLENAME&gt;_R2_001.fastq</code>.</p>
<pre class="r r_code"><code>fnFs &lt;- sort(list.files(indir, pattern=&quot;_R1_001.fastq.gz&quot;, full.names = TRUE))
fnRs &lt;- sort(list.files(indir, pattern=&quot;_R2_001.fastq.gz&quot;, full.names = TRUE))</code></pre>
</div>
<div id="extract-sample-names" class="section level3">
<h3>Extract sample names</h3>
<p>Extract the sample names from the <code>.fastq</code> file names, assuming file names have format: <code>&lt;SAMPLENAME&gt;_XXX.fastq</code>.</p>
<p>The resulting <code>sample.names</code> should match the SampleID column in the <code>sample_data_example</code> file.</p>
<pre class="r r_code"><code>sample.names &lt;- sapply(strsplit(basename(fnFs), &quot;-V4-V5_&quot;), `[`, 1)</code></pre>
<hr />
</div>
</div>
<div id="step-2-qc" class="section level2">
<h2>Step 2: QC</h2>
<div id="plot-sequence-quality-data" class="section level3">
<h3>Plot sequence quality data</h3>
<p>You can generate and evaluate plots individually:</p>
<pre class="r r_code"><code>plotQualityProfile(fnFs[1:2])</code></pre>
<p><br></p>
<p>Or generate pdf files to inspect multiple plots at once:</p>
<pre class="r r_code"><code>ii &lt;- sample(length(fnFs), 3)
pdf(&quot;Error_profiles.pdf&quot;)
par(mfrow=c(2,3))
for (i in ii) { print (plotQualityProfile(fnFs[i]) + ggtitle(&quot;Fwd&quot;)) }
ii &lt;- sample(length(fnRs), 3)
for (i in ii) { print (plotQualityProfile(fnRs[i]) + ggtitle(&quot;Rev&quot;)) }
dev.off()</code></pre>
<details>
<summary>   <i class="fas  fa-info-circle "></i>   More on QC of fastq files </summary> It is a good idea to run the <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/"><code>fastqc</code></a> program on your fastq files for more extensive QC. This is a stand-alone program that is easy to run from the command-line. When you have many samples, as is often the case, <code>fastqc</code>’s results can moreover be nicely summarized using [<code>multiqc</code>](<a href="https://multiqc.info/" class="uri">https://multiqc.info/</a>. In the interest of time, we skipped these steps during this workshop.
</details>
<hr />
</div>
</div>
<div id="step-3-trimming" class="section level2">
<h2>Step 3: Trimming</h2>
<p>The <code>truncLen</code> parameters should be based on sequence quality visualized above. It is suggested to trim first 10 nucleotides of each read, empirical observations across Illumina datasets show these positions are likely to contain pathological errors. Trimming length could be different for R1 and R2, but ideally not too drastically so, in order to maximize merging pairs in subsequent steps.</p>
<p>First, define paths for trimming:</p>
<pre class="r r_code"><code>filtFs &lt;- file.path(output, &quot;filtered&quot;, paste0(sample.names, &quot;_F_filt.fastq&quot;))
filtRs &lt;- file.path(output, &quot;filtered&quot;, paste0(sample.names, &quot;_R_filt.fastq&quot;))</code></pre>
<p><br></p>
<p>Then, perform the trimming:</p>
<pre class="r r_code"><code>print(&quot;filter and Trimming&quot;)
Sys.time()
out &lt;- filterAndTrim(fnFs, filtFs, fnRs, filtRs, trimLeft=10, truncLen=c(250,210), maxN=0, maxEE=c(2,2), truncQ=2, rm.phix=F, compress=FALSE, multithread=TRUE, verbose=TRUE) 
print(&quot;done&quot;)
Sys.time()</code></pre>
<hr />
</div>
<div id="step-4-dereplication-error-training" class="section level2">
<h2>Step 4: Dereplication &amp; Error Training</h2>
<pre class="r r_code"><code>derepFs &lt;- derepFastq(filtFs, verbose = FALSE)
derepRs &lt;- derepFastq(filtRs, verbose = FALSE)

print(&quot;Learning errors:&quot;)
Sys.time()
errF &lt;- learnErrors(derepFs, multithread = TRUE, verbose = TRUE)
errR &lt;- learnErrors(derepRs, multithread = TRUE, verbose = TRUE)
print(&quot;Done.&quot;)
Sys.time()

names(derepFs) &lt;- sample.names
names(derepRs) &lt;- sample.names</code></pre>
<p><br></p>
<p>Plot errors to verify that error rates have been reasonable well-estimated. Observe the fit between observed error rates (points) and fitted error rates (lines):</p>
<pre class="r r_code"><code>plotErrors(errF, nominalQ = TRUE)
plotErrors(errR, nominalQ = TRUE)</code></pre>
<hr />
</div>
<div id="step-5-infer-asvs" class="section level2">
<h2>Step 5: Infer ASVs</h2>
<p>We will run the dada algorithm to infer ASVs.</p>
<p>This step is more computationally intensity. Indepedant inference by sample (pool=F) will keep memory requirements linear to sample number. Pooling will increase computation time but improve detection of rare variants seen once or twice in an individual sample but many times across all samples.</p>
<pre class="r r_code"><code>print(&quot;inferring ASVs (running dada algorithm)&quot;)
Sys.time()
dadaFs &lt;- dada(derepFs, err = errF, multithread = T, pool = FALSE)
dadaRs &lt;- dada(derepRs, err = errR, multithread = T, pool = FALSE)
print(&quot;done&quot;)
Sys.time()

#inspect object
dadaFs[[1]]</code></pre>
<hr />
</div>
<div id="step-6-merge-read-pairs" class="section level2">
<h2>Step 6: Merge Read Pairs</h2>
<p>In this step, we will merge read pairs and generate sequence table of paired ASVs.</p>
<pre class="r r_code"><code>mergers &lt;- mergePairs(dadaFs, derepFs, dadaRs, derepRs,
                      verbose=TRUE)

seqtab.all &lt;- makeSequenceTable(mergers)
dim(seqtab.all)</code></pre>
<hr />
</div>
<div id="step-7-summarize-sequences-and-remove-chimeras" class="section level2">
<h2>Step 7: Summarize Sequences and Remove Chimeras</h2>
<pre class="r r_code"><code># Inspect distribution of sequence lengths
table(nchar(getSequences(seqtab.all)))

#If you need to remove sequences of a particular length (e.g. too long):
#seqtab2 &lt;- seqtab[,nchar(colnames(seqtab.all)) %in% seq(250,256)]

# Remove chimeras:
seqtab &lt;- removeBimeraDenovo(seqtab.all,
                             method = &quot;consensus&quot;,
                             multithread = TRUE,
                             verbose = TRUE)
dim(seqtab)

# Proportion of removed sequences
sum(seqtab) / sum(seqtab.all)

# Save seqtab file as an RDS object
saveRDS(seqtab, file = file.path(outdir, &quot;seqtab_V4.rds&quot;))</code></pre>
<hr />
</div>
<div id="step-8-generate-a-summary-table" class="section level2">
<h2>Step 8: Generate a Summary Table</h2>
<p>In this step, we will generate a summary table of the number of sequences processed and outputs of different steps of the pipeline.</p>
<p>This information is generally used to further evaluate characteristics and quality of the run, sample-to-sample variation, and resulting sequencing depth for each sample.</p>
<pre class="r r_code"><code>getN &lt;- function(x) sum(getUniques(x))

track &lt;- cbind(out,
               sapply(dadaFs, getN),
               sapply(dadaRs, getN),
               sapply(mergers, getN),
               rowSums(seqtab))

# If processing a single sample, remove the sapply calls:
# e.g. replace sapply(dadaFs, getN) with getN(dadaFs)

colnames(track) &lt;- c(&quot;input&quot;, &quot;filtered&quot;, &quot;denoisedF&quot;,
                     &quot;denoisedR&quot;, &quot;merged&quot;, &quot;nonchim&quot;)
rownames(track) &lt;- sample.names
head(track)

outfile_track &lt;- file.path(outdir, &#39;track.txt&#39;)
write.table(track, file = outfile_track)</code></pre>
<hr />
</div>
<div id="step-9-assign-taxonomy-to-asvs" class="section level2">
<h2>Step 9: Assign Taxonomy to ASVs</h2>
<p>Depending on the marker gene and the data, you will choose the appropriate file for this step. Several files have been formatted for taxony assignments in DADA2 pipeline and are available in the following website: <a href="https://benjjneb.github.io/dada2/index.html" class="uri">https://benjjneb.github.io/dada2/index.html</a></p>
<pre class="r r_code"><code>print(&quot;Assigning taxa to ASVs&quot;)
Sys.time()
taxa &lt;- assignTaxonomy(seqtab, tax_key, multithread = TRUE)
colnames(taxa) &lt;- c(&quot;Kingdom&quot;, &quot;Phylum&quot;, &quot;Class&quot;, &quot;Order&quot;, &quot;Family&quot;, &quot;Genus&quot;)
print(&quot;done&quot;)
Sys.time()</code></pre>
<hr />
</div>
<div id="step-10-phylogenetic-tree-estimation" class="section level2">
<h2>Step 10: Phylogenetic Tree Estimation</h2>
<p>A phylogenetic tree can be estimated for the sequence data you generated. Depending on the number of ASVs recovered and the phylogenetic tree algorithm of choice, this step could take several days. Simpler trees will be less computationally intensive. Depending on the marker gene you are working on, you might choose or not to use this option.</p>
<pre class="r r_code"><code>#seqtab&lt;- readRDS(&quot;seqtab_V4.rds&quot;)
seqs &lt;- getSequences(seqtab)
names(seqs) &lt;- seqs # This propagates to the tip labels of the tree. At this stage ASV labels are full ASV sequence
alignment &lt;- AlignSeqs(DNAStringSet(seqs), anchor=NA, iterations = 5, refinements = 5)

print(&quot;Computing pairwise distances from ASVs&quot;)
Sys.time()
phang.align &lt;- phyDat(as(alignment, &quot;matrix&quot;), type=&quot;DNA&quot;)
dm &lt;- dist.ml(phang.align)
treeNJ &lt;- NJ(dm) # Note, tip order != sequence order
fit = pml(treeNJ, data=phang.align)
print(&quot;done&quot;)
Sys.time()

fitGTR &lt;- update(fit, k=4, inv=0.2)
print(&quot;done&quot;)
Sys.time()

print(&quot;Computing likelihood of tree&quot;)
Sys.time()
fitGTR &lt;- optim.pml(fitGTR, model=&quot;GTR&quot;, optInv=TRUE, optGamma=TRUE,
                      rearrangement = &quot;stochastic&quot;, control = pml.control(trace = 0))
print(&quot;done&quot;)
Sys.time()</code></pre>
<hr />
</div>
<div id="step-11-generate-output-files" class="section level2">
<h2>Step 11: Generate Output Files</h2>
<p>In this step, we will generate output files formatted for downstream analysis in phyloseq</p>
<p>Data will be extracted from the DADA2 outputs and formatted for downstream analysis and data inspection. The last step of this pipeline saves a phyloseq object as an .RDS file and can be imported directly in phyloseq.</p>
<pre class="r r_code"><code># Rename ASV names: 
asv_seqs&lt;- colnames(seqtab)
asv_headers&lt;- vector(dim(seqtab)[2], mode = &quot;character&quot;)

for (i in 1:dim(seqtab)[2]) {
    asv_headers[i] &lt;- paste(&quot;&gt;ASV&quot;, i, sep = &quot;_&quot;)
}


# Write ASV fasta for final ASV seqs.
#This fasta file can also be used for phylogenetic tree inference in different platforms
asv_fasta&lt;- c(rbind(asv_headers, asv_seqs))

outfile_fasta &lt;- file.path(outdir, &#39;ASVs.fa&#39;)
write(asv_fasta, outfile_fasta)


# Count table:
asv_tab &lt;- t(seqtab)
row.names(asv_tab) &lt;- sub(&quot;&gt;&quot;, &quot;&quot;, asv_headers)

outfile_tab &lt;- file.path(outdir, &#39;ASVs_counts.tsv&#39;)
write.table(asv_tab, outfile_tab, 
            sep = &quot;\t&quot;, quote = FALSE, col.names = NA)


# Tax table:
asv_tax &lt;- taxa
row.names(asv_tax) &lt;- sub(&quot;&gt;&quot;, &quot;&quot;, asv_headers)

outfile_tax &lt;- file.path(outdir, &#39;ASVs_taxonomy.tsv&#39;)
write.table(asv_tax, outfile_tax,
            sep = &quot;\t&quot;, quote = FALSE, col.names = NA)


# Read files back in:
count_tab &lt;- read.table(outfile_tab,
                        header = TRUE, row.names = 1,
                        check.names = FALSE, sep = &quot;\t&quot;)

tax_tab &lt;- as.matrix(
  read.table(outfile_tax,
             header = TRUE, row.names = 1,
             check.names = FALSE, sep = &quot;\t&quot;)
  )


# Load and prepare sample metadata:
sample_df &lt;- read.table(file = sample_names_file,
                        sep = &quot;\t&quot;, header = TRUE)
colnames(samdf)[1]&lt;- &quot;SampleID&quot;
rownames(samdf)&lt;- samdf$SampleID


# Build the final phyloseq object:
# We will not do this now, but a phylogenetic tree can also be added to the phyloseq object.
ps &lt;- phyloseq(otu_table(count_tab, taxa_are_rows = TRUE),
               sample_data(sample_df),
               tax_table(tax_tab))

outfile_ps &lt;- file.path(outdir, &#39;ps_V4.rds&#39;)
saveRDS(ps, file = outfile_ps)

print(&quot;done&quot;)</code></pre>
<hr />
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<ul>
<li><a href="https://f1000research.com/articles/5-1492/v2">Callahan et al. 2006: “Bioconductor Workflow for Microbiome Data Analysis: from raw reads to community analyses”</a></li>
<li><a href="https://benjjneb.github.io/dada2/index.html"><code>dada2</code> documentation and tutorials</a></li>
<li><a href="https://benjjneb.github.io/dada2/training.html">Taxonomic references for <code>dada2</code></a></li>
<li><a href="https://cutadapt.readthedocs.io/en/stable/index.html"><code>cutadapt</code> documentation and tutorials</a></li>
</ul>
<hr />
</div>
<div id="bonus-submit-script-as-an-osc-job" class="section level2">
<h2>Bonus: Submit script as an OSC job</h2>
<ul>
<li>Script <code>dada2.sh</code>:</li>
</ul>
<pre class="sh"><code>#PBS -l walltime=100:00:00
#PBS -l nodes=1:ppn=28
#PBS -A PAS1548

module load gnu/9.1.0
module load mkl/2019.0.3
module load R/3.6.1
cd /fs/scratch/PAS1548/BaseSpace_out/11-21-19/V4_V5/scripts
Rscript dada2_V4.R</code></pre>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiPGJyPldvcmtmbG93IHBhcnQgSUk6PGJyPkFTViBJbmZlcmVuY2UgYW5kIFRheG9uIEFzc2lnbm1lbnQiCm91dHB1dDoKICBybWFya2Rvd246Omh0bWxfZG9jdW1lbnQ6CiAgICB0aGVtZTogY2VydWxlYW4KICAgIGNvZGVfZG93bmxvYWQ6IHRydWUKICAgIHRvYzogdHJ1ZQogICAgdG9jX2Zsb2F0OiB0cnVlCi0tLQoKYGBge3Iga25pdHJfb3B0aW9ucywgZWNobz1GQUxTRX0Ka25pdHI6Om9wdHNfY2h1bmskc2V0KHJlc3VsdHM9J2hpZGUnLAogICAgICAgICAgICAgICAgICAgICAgZXZhbCA9IEZBTFNFLAogICAgICAgICAgICAgICAgICAgICAgI2tuaXRyOjpvcHRzX2tuaXQkc2V0KHJvb3QuZGlyID0gIi9mcy9wcm9qZWN0L1BBUzA0NzEvd29ya3Nob3BzLzIwMjAtMTJfbWljcm8vJFVTRVIiKSwKICAgICAgICAgICAgICAgICAgICAgIGNsYXNzLnNvdXJjZT0icl9jb2RlIiwKICAgICAgICAgICAgICAgICAgICAgIGNsYXNzLm91dHB1dD0icl9vdXRwdXQiLAogICAgICAgICAgICAgICAgICAgICAgY2xhc3Mud2FybmluZz0icl93YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgICAgIGNsYXNzLm1lc3NhZ2U9InJfd2FybmluZyIsCiAgICAgICAgICAgICAgICAgICAgICBjbGFzcy5lcnJvcj0icl9lcnJvciIpCmBgYAoKPGJyPgoKLS0tLS0KCiMjIEdvYWxzCgpQcm9jZXNzIG1ldGFiYXJjb2RpbmcgcmVhZHMsIHBvc3QtYWRhcHRlciByZW1vdmFsLCBpbmNsdWRpbmc6CgotIEV2YWx1YXRpb24gb2YgcXVhbGl0eQotIFF1YWxpdHkgdHJpbW1pbmcgYW5kIGZpbHRlcmluZwotIEVycm9yIGNvcnJlY3Rpb24gYW5kIGRlbm9pc2luZwotIFJlYWQgbWVyZ2luZwotIEFzc2lnbmluZyB0YXhvbm9teQoKLS0tLS0KCiMjIEJlZm9yZSBXZSBHZXQgU3RhcnRlZAoKIyMjIE5vdGVzCgotIFRoaXMgZG9jdW1lbnRlZCB3YXMgYWRhcHRlZCBmcm9tIFtDYWxsYWhhbiBldCBhbC4gMjAwNl0oaHR0cHM6Ly9mMTAwMHJlc2VhcmNoLmNvbS9hcnRpY2xlcy81LTE0OTIvdjIpCiAgYnkgTWF0dGhldyBXaWxsbWFuLCB3aXRoIGZ1cnRoZXIgZWRpdHMgYnkgU29sZWRhZCBCZW5pdGV6IFBvbmNlIGFuZCBKZWxtZXIgUG9lbHN0cmEuCiAgCi0gVG8gY29udmVydCBhbiBgUm1kYCAoUiBNYXJrZG93bikgZmlsZSB0byBhbiBSIHNjcmlwdCwKICB0eXBlIHRoZSBmb2xsb3dpbmcgaW4gYW4gUiBjb25zb2xlOgogIGBrbml0cjo6cHVybChpbnB1dD0iPGZpbGVuYW1lPi5SbWQiKWAuCiAgKFlvdSBjYW4gZG93bmxvYWQgdGhpcyBgUm1kYCBmaWxlIGJ5IGNsaWNraW5nIHRoZSBgQ29kZWAgYnV0dG9uCiAgaW4gdGhlIHRvcC1yaWdodCBvZiB0aGlzIHBhZ2UgLS0gYnV0IHdlIHdpbGwgb3BlbiBpdCBhdCBPU0MuKQoKIyMjIFN0YXJ0IGFuIFJTdHVkaW8gU2VydmVyIGpvYiBhdCBPU0MKCkZvciBtb3JlIGRldGFpbGVkIGluc3RydWN0aW9ucyBvZiB0aGUgZmlyc3Qgc3RlcHMsCnNlZSBbdGhpcyBzZWN0aW9uXSgwNi1SLmh0bWwjcnN0dWRpby1hdC1PU0MpIGZyb20gb3VyIGludHJvIHRvIFIgc2Vzc2lvbi4KCi0gTG9naW4gdG8gT1NDIGF0IDxodHRwczovL29uZGVtYW5kLm9zYy5lZHU+LgoKLSBDbGljayBvbiBgSW50ZXJhY3RpdmUgQXBwc2AgKHRvcCBiYXIpID4gYFJTdHVkaW8gU2VydmVyIChPd2VucyBhbmQgUGl0emVyKWAuCgotIEZpbGwgb3V0IHRoZSBmb3JtIGFzIHNob3duIFtoZXJlXShzbGlkZXMvMDMtT1NDLXNsaWRlcy5odG1sI3JzdHVkaW9fc2VydmVyX2pvYikuCgotIE9uY2UgeW91ciBqb2IgaGFzIHN0YXJ0ZWQsIGNsaWNrIGBDb25uZWN0IHRvIFJTdHVkaW8gU2VydmVyYC4KCi0gWW91IHNob3VsZCBhdXRvbWF0aWNhbGx5IGJlIGluIHlvdXIgcGVyc29uYWwgZGlyIGluc2lkZSB0aGUgZGlyCiAgYC9mcy9wcm9qZWN0L1BBUzA0NzEvd29ya3Nob3BzLzIwMjAtMTJfbWljcm9gLiAgIAogIAogIChJbiB0aGUgKkZpbGVzKiBwYW5lIGluIFJTdHVkaW8sIHlvdSBzaG91bGQgc2VlIHlvdXIgYC5ScHJvamAgZmlsZS4gCiAgSWYgbm90LCB0eXBlIGBzZXR3ZCgnL2ZzL3Byb2plY3QvUEFTMDQ3MS93b3Jrc2hvcHMvMjAyMC0xMl9taWNybycpYAogIGFuZCB0aGVuIGNsaWNrIG9uIHRoZSBkaXIgd2l0aCB5b3VyIG5hbWUgaW4gdGhlICpGaWxlcyogcGFuZSkuCgotIE5vdywgY2xpY2sgb24gdGhlIGBtYXJrZG93bmAgZGlyZWN0b3J5IGluIHRoZSAqRmlsZXMqIHBhbmUsCiAgYW5kIG9wZW4gdGhlIGZpbGUgYDA2LXJlYWRzLXRvLUFTVi5SbWRgLiBUaGF0J3MgdGhpcyBmaWxlIQoKLS0tLS0KCiMjIFN0ZXAgMTogR2V0dGluZyBTdGFydGVkCgojIyMgSW5zdGFsbCBhbmQgbG9hZCBwYWNrYWdlcwoKVG8gc2F2ZSB0aW1lLCB3ZSBoYXZlIGFscmVhZHkgaW5zdGFsbGVkIGFsbCB0aGUgbmVjZXNzYXJ5IFIgcGFja2FnZXMgYXQgT1NDCmludG8gYSBjdXN0b20gbGlicmFyeS4KVG8gYWRkIHRoaXMgbGlicmFyeSBmb3IgdGhlIGN1cnJlbnQgUiBzZXNzaW9uOgoKYGBge3IgbGlibG9hZH0KLmxpYlBhdGhzKG5ldyA9ICcvZnMvcHJvamVjdC9QQVMwNDcxLy5SLzQuMC8nKQpgYGAKClRoZW4sIGxvYWQgdGhlIHBhY2thZ2VzOgoKYGBge3J9CnBhY2thZ2VzIDwtIGMoImdncGxvdDIiLCAiZ3JpZEV4dHJhIiwKICAgICAgICAgICAgICAiZGFkYTIiLCAicGh5bG9zZXEiLCAiREVDSVBIRVIiLCAicGhhbmdvcm4iKQpwYWNtYW46OnBfbG9hZChjaGFyID0gcGFja2FnZXMpCgojIElmIHlvdSB3YW50ZWQgdG8gaW5zdGFsbCBhbmQgbG9hZCB0aGVzZSBwYWNrYWdlcyB5b3Vyc2VsZiwKIyBqdXN0IG1ha2Ugc3VyZSB5b3UgaGF2ZSB0aGUgcGFjbWFuIHBhY2thZ2UgaW5zdGFsbGVkOgojIyBpbnN0YWxsLnBhY2thZ2VzKCdwYWNtYW4nKQojIFRoZW4sIHRoZSBjb2RlIGFib3ZlIHdvdWxkIHdvcmssIGFzIGl0IHdpbGwgaW5zdGFsbCBwYWNha2VzIGFzIG5lZWRlZC4KYGBgCgojIyMgU2V0IHRoZSBmaWxlIHBhdGhzCgpgYGB7cn0KIyBEaXIgd2l0aCBpbnB1dCBmYXN0cSBmaWxlczoKaW5kaXIgPC0gInByb2Nlc3NlZF9kYXRhL2Zhc3RxX3RyaW1tZWQvc2Vjb25kX3RyaW0vIgoKIyBEaXIgZm9yIG91dHB1dDoKb3V0ZGlyIDwtICdhbmFseXNpcy9BU1ZfaW5mZXJlbmNlLycKZGlyLmNyZWF0ZShvdXRkaXIsIHJlY3Vyc2l2ZSA9IFRSVUUpCgojIEZhc3RhIGZpbGUgd2l0aCB0cmFpbmluZyBkYXRhOgojIChDaGVjayBmb3IgYW4gdXAtdG8tZGF0ZSB2ZXJzaW9uIGF0IDxodHRwczovL2JlbmpqbmViLmdpdGh1Yi5pby9kYWRhMi90cmFpbmluZy5odG1sPikKdGF4X2tleSA8LSAiZGF0YS9yZWYvc2lsdmFfbnI5OV92MTM4X3RyYWluX3NldC5mYSIgCgojIEZpbGUgd2l0aCBzYW1wbGUgbWV0YWRhdGE6CnNhbXBsZV9uYW1lc19maWxlIDwtICJtZXRhZGF0YS9zYW1wbGVfbWV0YS50eHQiCmBgYAoKIyMjIEFzc2lnbiBmaWxlcyB0byBmb3J3YXJkIGFuZCByZXZlcnNlIHJlYWRzIAoKRm9yIGZvcndhcmQgYW5kIHJldmVyc2UgZmFzdHEgZmlsZW5hbWVzIHdoaWNoIGhhdmUgdGhlIGZvbGxvd2luZyBuYW1lIGZvcm1hdDogYDxTQU1QTEVOQU1FPl9SMV8wMDEuZmFzdHFgIGFuZCBgPFNBTVBMRU5BTUU+X1IyXzAwMS5mYXN0cWAuCgpgYGB7cn0KZm5GcyA8LSBzb3J0KGxpc3QuZmlsZXMoaW5kaXIsIHBhdHRlcm49Il9SMV8wMDEuZmFzdHEuZ3oiLCBmdWxsLm5hbWVzID0gVFJVRSkpCmZuUnMgPC0gc29ydChsaXN0LmZpbGVzKGluZGlyLCBwYXR0ZXJuPSJfUjJfMDAxLmZhc3RxLmd6IiwgZnVsbC5uYW1lcyA9IFRSVUUpKQpgYGAKCiMjIyBFeHRyYWN0IHNhbXBsZSBuYW1lcwoKRXh0cmFjdCB0aGUgc2FtcGxlIG5hbWVzIGZyb20gdGhlIGAuZmFzdHFgIGZpbGUgbmFtZXMsIGFzc3VtaW5nIGZpbGUgbmFtZXMgaGF2ZSBmb3JtYXQ6IGA8U0FNUExFTkFNRT5fWFhYLmZhc3RxYC4KClRoZSByZXN1bHRpbmcgYHNhbXBsZS5uYW1lc2Agc2hvdWxkIG1hdGNoIHRoZSBTYW1wbGVJRCBjb2x1bW4gaW4gdGhlIGBzYW1wbGVfZGF0YV9leGFtcGxlYCBmaWxlLgoKYGBge3J9CnNhbXBsZS5uYW1lcyA8LSBzYXBwbHkoc3Ryc3BsaXQoYmFzZW5hbWUoZm5GcyksICItVjQtVjVfIiksIGBbYCwgMSkKYGBgCgotLS0tLQoKIyMgU3RlcCAyOiBRQwoKIyMjIFBsb3Qgc2VxdWVuY2UgcXVhbGl0eSBkYXRhCgpZb3UgY2FuIGdlbmVyYXRlIGFuZCBldmFsdWF0ZSBwbG90cyBpbmRpdmlkdWFsbHk6CgpgYGB7cn0KcGxvdFF1YWxpdHlQcm9maWxlKGZuRnNbMToyXSkKYGBgCgo8YnI+CgpPciBnZW5lcmF0ZSBwZGYgZmlsZXMgdG8gaW5zcGVjdCBtdWx0aXBsZSBwbG90cyBhdCBvbmNlOgoKYGBge3J9CmlpIDwtIHNhbXBsZShsZW5ndGgoZm5GcyksIDMpCnBkZigiRXJyb3JfcHJvZmlsZXMucGRmIikKcGFyKG1mcm93PWMoMiwzKSkKZm9yIChpIGluIGlpKSB7IHByaW50IChwbG90UXVhbGl0eVByb2ZpbGUoZm5Gc1tpXSkgKyBnZ3RpdGxlKCJGd2QiKSkgfQppaSA8LSBzYW1wbGUobGVuZ3RoKGZuUnMpLCAzKQpmb3IgKGkgaW4gaWkpIHsgcHJpbnQgKHBsb3RRdWFsaXR5UHJvZmlsZShmblJzW2ldKSArIGdndGl0bGUoIlJldiIpKSB9CmRldi5vZmYoKQpgYGAKCjxkZXRhaWxzPgo8c3VtbWFyeT4KJm5ic3A7ICBgciBpY29uOjpmYSgiaW5mby1jaXJjbGUiKWAgJm5ic3A7IE1vcmUgb24gUUMgb2YgZmFzdHEgZmlsZXMKPC9zdW1tYXJ5PgpJdCBpcyBhIGdvb2QgaWRlYSB0byBydW4gdGhlCltgZmFzdHFjYF0oaHR0cHM6Ly93d3cuYmlvaW5mb3JtYXRpY3MuYmFicmFoYW0uYWMudWsvcHJvamVjdHMvZmFzdHFjLykKcHJvZ3JhbSBvbiB5b3VyIGZhc3RxIGZpbGVzIGZvciBtb3JlIGV4dGVuc2l2ZSBRQy4KVGhpcyBpcyBhIHN0YW5kLWFsb25lIHByb2dyYW0gdGhhdCBpcyBlYXN5IHRvIHJ1biBmcm9tIHRoZSBjb21tYW5kLWxpbmUuCldoZW4geW91IGhhdmUgbWFueSBzYW1wbGVzLCBhcyBpcyBvZnRlbiB0aGUgY2FzZSwKYGZhc3RxY2AncyByZXN1bHRzIGNhbiBtb3Jlb3ZlciBiZSBuaWNlbHkgc3VtbWFyaXplZCB1c2luZwpbYG11bHRpcWNgXShodHRwczovL211bHRpcWMuaW5mby8uCkluIHRoZSBpbnRlcmVzdCBvZiB0aW1lLCB3ZSBza2lwcGVkIHRoZXNlIHN0ZXBzIGR1cmluZyB0aGlzIHdvcmtzaG9wLgo8L2RldGFpbHM+CgoKLS0tLS0KCiMjIFN0ZXAgMzogVHJpbW1pbmcKClRoZSBgdHJ1bmNMZW5gIHBhcmFtZXRlcnMgc2hvdWxkIGJlIGJhc2VkIG9uIHNlcXVlbmNlIHF1YWxpdHkgdmlzdWFsaXplZCBhYm92ZS4KSXQgaXMgc3VnZ2VzdGVkIHRvIHRyaW0gZmlyc3QgMTAgbnVjbGVvdGlkZXMgb2YgZWFjaCByZWFkLAplbXBpcmljYWwgb2JzZXJ2YXRpb25zIGFjcm9zcyBJbGx1bWluYSBkYXRhc2V0cyBzaG93IHRoZXNlIHBvc2l0aW9ucyBhcmUgbGlrZWx5IHRvIGNvbnRhaW4gcGF0aG9sb2dpY2FsIGVycm9ycy4gVHJpbW1pbmcgbGVuZ3RoIGNvdWxkIGJlIGRpZmZlcmVudCBmb3IgUjEgYW5kIFIyLApidXQgaWRlYWxseSBub3QgdG9vIGRyYXN0aWNhbGx5IHNvLCBpbiBvcmRlciB0byBtYXhpbWl6ZSBtZXJnaW5nIHBhaXJzIGluIHN1YnNlcXVlbnQgc3RlcHMuCgpGaXJzdCwgZGVmaW5lIHBhdGhzIGZvciB0cmltbWluZzoKCmBgYHtyfQpmaWx0RnMgPC0gZmlsZS5wYXRoKG91dHB1dCwgImZpbHRlcmVkIiwgcGFzdGUwKHNhbXBsZS5uYW1lcywgIl9GX2ZpbHQuZmFzdHEiKSkKZmlsdFJzIDwtIGZpbGUucGF0aChvdXRwdXQsICJmaWx0ZXJlZCIsIHBhc3RlMChzYW1wbGUubmFtZXMsICJfUl9maWx0LmZhc3RxIikpCmBgYAoKPGJyPgoKVGhlbiwgcGVyZm9ybSB0aGUgdHJpbW1pbmc6CgpgYGB7cn0KcHJpbnQoImZpbHRlciBhbmQgVHJpbW1pbmciKQpTeXMudGltZSgpCm91dCA8LSBmaWx0ZXJBbmRUcmltKGZuRnMsIGZpbHRGcywgZm5ScywgZmlsdFJzLCB0cmltTGVmdD0xMCwgdHJ1bmNMZW49YygyNTAsMjEwKSwgbWF4Tj0wLCBtYXhFRT1jKDIsMiksIHRydW5jUT0yLCBybS5waGl4PUYsIGNvbXByZXNzPUZBTFNFLCBtdWx0aXRocmVhZD1UUlVFLCB2ZXJib3NlPVRSVUUpIApwcmludCgiZG9uZSIpClN5cy50aW1lKCkKYGBgCgoKLS0tLS0KCiMjIFN0ZXAgNDogRGVyZXBsaWNhdGlvbiAmIEVycm9yIFRyYWluaW5nCgpgYGB7cn0KZGVyZXBGcyA8LSBkZXJlcEZhc3RxKGZpbHRGcywgdmVyYm9zZSA9IEZBTFNFKQpkZXJlcFJzIDwtIGRlcmVwRmFzdHEoZmlsdFJzLCB2ZXJib3NlID0gRkFMU0UpCgpwcmludCgiTGVhcm5pbmcgZXJyb3JzOiIpClN5cy50aW1lKCkKZXJyRiA8LSBsZWFybkVycm9ycyhkZXJlcEZzLCBtdWx0aXRocmVhZCA9IFRSVUUsIHZlcmJvc2UgPSBUUlVFKQplcnJSIDwtIGxlYXJuRXJyb3JzKGRlcmVwUnMsIG11bHRpdGhyZWFkID0gVFJVRSwgdmVyYm9zZSA9IFRSVUUpCnByaW50KCJEb25lLiIpClN5cy50aW1lKCkKCm5hbWVzKGRlcmVwRnMpIDwtIHNhbXBsZS5uYW1lcwpuYW1lcyhkZXJlcFJzKSA8LSBzYW1wbGUubmFtZXMKYGBgCgo8YnI+CgpQbG90IGVycm9ycyB0byB2ZXJpZnkgdGhhdCBlcnJvciByYXRlcyBoYXZlIGJlZW4gcmVhc29uYWJsZSB3ZWxsLWVzdGltYXRlZC4KT2JzZXJ2ZSB0aGUgZml0IGJldHdlZW4gb2JzZXJ2ZWQgZXJyb3IgcmF0ZXMgKHBvaW50cykgYW5kIGZpdHRlZCBlcnJvciByYXRlcyAobGluZXMpOgoKYGBge3J9CnBsb3RFcnJvcnMoZXJyRiwgbm9taW5hbFEgPSBUUlVFKQpwbG90RXJyb3JzKGVyclIsIG5vbWluYWxRID0gVFJVRSkKYGBgCgotLS0tLQoKIyMgU3RlcCA1OiBJbmZlciBBU1ZzCgpXZSB3aWxsIHJ1biB0aGUgZGFkYSBhbGdvcml0aG0gdG8gaW5mZXIgQVNWcy4KClRoaXMgc3RlcCBpcyBtb3JlIGNvbXB1dGF0aW9uYWxseSBpbnRlbnNpdHkuIEluZGVwZWRhbnQgaW5mZXJlbmNlIGJ5IHNhbXBsZSAocG9vbD1GKSB3aWxsIGtlZXAgbWVtb3J5IHJlcXVpcmVtZW50cyBsaW5lYXIgdG8gc2FtcGxlIG51bWJlci4gUG9vbGluZyB3aWxsIGluY3JlYXNlIGNvbXB1dGF0aW9uIHRpbWUgYnV0IGltcHJvdmUgZGV0ZWN0aW9uIG9mIHJhcmUgdmFyaWFudHMgc2VlbiBvbmNlIG9yIHR3aWNlIGluIGFuIGluZGl2aWR1YWwgc2FtcGxlIGJ1dCBtYW55IHRpbWVzIGFjcm9zcyBhbGwgc2FtcGxlcy4KCmBgYHtyfQpwcmludCgiaW5mZXJyaW5nIEFTVnMgKHJ1bm5pbmcgZGFkYSBhbGdvcml0aG0pIikKU3lzLnRpbWUoKQpkYWRhRnMgPC0gZGFkYShkZXJlcEZzLCBlcnIgPSBlcnJGLCBtdWx0aXRocmVhZCA9IFQsIHBvb2wgPSBGQUxTRSkKZGFkYVJzIDwtIGRhZGEoZGVyZXBScywgZXJyID0gZXJyUiwgbXVsdGl0aHJlYWQgPSBULCBwb29sID0gRkFMU0UpCnByaW50KCJkb25lIikKU3lzLnRpbWUoKQoKI2luc3BlY3Qgb2JqZWN0CmRhZGFGc1tbMV1dCmBgYAoKLS0tLS0KCiMjIFN0ZXAgNjogTWVyZ2UgUmVhZCBQYWlycwoKSW4gdGhpcyBzdGVwLCB3ZSB3aWxsIG1lcmdlIHJlYWQgcGFpcnMgYW5kIGdlbmVyYXRlIHNlcXVlbmNlIHRhYmxlIG9mIHBhaXJlZCBBU1ZzLgoKYGBge3J9Cm1lcmdlcnMgPC0gbWVyZ2VQYWlycyhkYWRhRnMsIGRlcmVwRnMsIGRhZGFScywgZGVyZXBScywKICAgICAgICAgICAgICAgICAgICAgIHZlcmJvc2U9VFJVRSkKCnNlcXRhYi5hbGwgPC0gbWFrZVNlcXVlbmNlVGFibGUobWVyZ2VycykKZGltKHNlcXRhYi5hbGwpCmBgYAoKLS0tLS0KCiMjIFN0ZXAgNzogU3VtbWFyaXplIFNlcXVlbmNlcyBhbmQgUmVtb3ZlIENoaW1lcmFzCgpgYGB7cn0KIyBJbnNwZWN0IGRpc3RyaWJ1dGlvbiBvZiBzZXF1ZW5jZSBsZW5ndGhzCnRhYmxlKG5jaGFyKGdldFNlcXVlbmNlcyhzZXF0YWIuYWxsKSkpCgojSWYgeW91IG5lZWQgdG8gcmVtb3ZlIHNlcXVlbmNlcyBvZiBhIHBhcnRpY3VsYXIgbGVuZ3RoIChlLmcuIHRvbyBsb25nKToKI3NlcXRhYjIgPC0gc2VxdGFiWyxuY2hhcihjb2xuYW1lcyhzZXF0YWIuYWxsKSkgJWluJSBzZXEoMjUwLDI1NildCgojIFJlbW92ZSBjaGltZXJhczoKc2VxdGFiIDwtIHJlbW92ZUJpbWVyYURlbm92byhzZXF0YWIuYWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9ICJjb25zZW5zdXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpdGhyZWFkID0gVFJVRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJib3NlID0gVFJVRSkKZGltKHNlcXRhYikKCiMgUHJvcG9ydGlvbiBvZiByZW1vdmVkIHNlcXVlbmNlcwpzdW0oc2VxdGFiKSAvIHN1bShzZXF0YWIuYWxsKQoKIyBTYXZlIHNlcXRhYiBmaWxlIGFzIGFuIFJEUyBvYmplY3QKc2F2ZVJEUyhzZXF0YWIsIGZpbGUgPSBmaWxlLnBhdGgob3V0ZGlyLCAic2VxdGFiX1Y0LnJkcyIpKQpgYGAKCgotLS0tLQoKCiMjIFN0ZXAgODogR2VuZXJhdGUgYSBTdW1tYXJ5IFRhYmxlCgpJbiB0aGlzIHN0ZXAsIHdlIHdpbGwgZ2VuZXJhdGUgYSBzdW1tYXJ5IHRhYmxlIG9mIHRoZSBudW1iZXIgb2Ygc2VxdWVuY2VzCnByb2Nlc3NlZCBhbmQgb3V0cHV0cyBvZiBkaWZmZXJlbnQgc3RlcHMgb2YgdGhlIHBpcGVsaW5lLgoKVGhpcyBpbmZvcm1hdGlvbiBpcyBnZW5lcmFsbHkgdXNlZCB0byBmdXJ0aGVyIGV2YWx1YXRlIGNoYXJhY3RlcmlzdGljcyBhbmQKcXVhbGl0eSBvZiB0aGUgcnVuLCBzYW1wbGUtdG8tc2FtcGxlIHZhcmlhdGlvbiwKYW5kIHJlc3VsdGluZyBzZXF1ZW5jaW5nIGRlcHRoIGZvciBlYWNoIHNhbXBsZS4gCgpgYGB7cn0KZ2V0TiA8LSBmdW5jdGlvbih4KSBzdW0oZ2V0VW5pcXVlcyh4KSkKCnRyYWNrIDwtIGNiaW5kKG91dCwKICAgICAgICAgICAgICAgc2FwcGx5KGRhZGFGcywgZ2V0TiksCiAgICAgICAgICAgICAgIHNhcHBseShkYWRhUnMsIGdldE4pLAogICAgICAgICAgICAgICBzYXBwbHkobWVyZ2VycywgZ2V0TiksCiAgICAgICAgICAgICAgIHJvd1N1bXMoc2VxdGFiKSkKCiMgSWYgcHJvY2Vzc2luZyBhIHNpbmdsZSBzYW1wbGUsIHJlbW92ZSB0aGUgc2FwcGx5IGNhbGxzOgojIGUuZy4gcmVwbGFjZSBzYXBwbHkoZGFkYUZzLCBnZXROKSB3aXRoIGdldE4oZGFkYUZzKQoKY29sbmFtZXModHJhY2spIDwtIGMoImlucHV0IiwgImZpbHRlcmVkIiwgImRlbm9pc2VkRiIsCiAgICAgICAgICAgICAgICAgICAgICJkZW5vaXNlZFIiLCAibWVyZ2VkIiwgIm5vbmNoaW0iKQpyb3duYW1lcyh0cmFjaykgPC0gc2FtcGxlLm5hbWVzCmhlYWQodHJhY2spCgpvdXRmaWxlX3RyYWNrIDwtIGZpbGUucGF0aChvdXRkaXIsICd0cmFjay50eHQnKQp3cml0ZS50YWJsZSh0cmFjaywgZmlsZSA9IG91dGZpbGVfdHJhY2spCmBgYAoKLS0tLS0KCiMjIFN0ZXAgOTogQXNzaWduIFRheG9ub215IHRvIEFTVnMKCkRlcGVuZGluZyBvbiB0aGUgbWFya2VyIGdlbmUgYW5kIHRoZSBkYXRhLCB5b3Ugd2lsbCBjaG9vc2UgdGhlIGFwcHJvcHJpYXRlIGZpbGUgZm9yIHRoaXMgc3RlcC4gU2V2ZXJhbCBmaWxlcyBoYXZlIGJlZW4gZm9ybWF0dGVkIGZvciB0YXhvbnkgYXNzaWdubWVudHMgaW4gREFEQTIgcGlwZWxpbmUgYW5kIGFyZSBhdmFpbGFibGUgaW4gdGhlIGZvbGxvd2luZyB3ZWJzaXRlOiBodHRwczovL2JlbmpqbmViLmdpdGh1Yi5pby9kYWRhMi9pbmRleC5odG1sIAoKYGBge3J9CnByaW50KCJBc3NpZ25pbmcgdGF4YSB0byBBU1ZzIikKU3lzLnRpbWUoKQp0YXhhIDwtIGFzc2lnblRheG9ub215KHNlcXRhYiwgdGF4X2tleSwgbXVsdGl0aHJlYWQgPSBUUlVFKQpjb2xuYW1lcyh0YXhhKSA8LSBjKCJLaW5nZG9tIiwgIlBoeWx1bSIsICJDbGFzcyIsICJPcmRlciIsICJGYW1pbHkiLCAiR2VudXMiKQpwcmludCgiZG9uZSIpClN5cy50aW1lKCkKYGBgCgotLS0tLQoKIyMgU3RlcCAxMDogUGh5bG9nZW5ldGljIFRyZWUgRXN0aW1hdGlvbgoKQSBwaHlsb2dlbmV0aWMgdHJlZSBjYW4gYmUgZXN0aW1hdGVkIGZvciB0aGUgc2VxdWVuY2UgZGF0YSB5b3UgZ2VuZXJhdGVkLiBEZXBlbmRpbmcgb24gdGhlIG51bWJlciBvZiBBU1ZzIHJlY292ZXJlZCBhbmQgdGhlIHBoeWxvZ2VuZXRpYyB0cmVlIGFsZ29yaXRobSBvZiBjaG9pY2UsIHRoaXMgc3RlcCBjb3VsZCB0YWtlIHNldmVyYWwgZGF5cy4gU2ltcGxlciB0cmVlcyB3aWxsIGJlIGxlc3MgY29tcHV0YXRpb25hbGx5IGludGVuc2l2ZS4gRGVwZW5kaW5nIG9uIHRoZSBtYXJrZXIgZ2VuZSB5b3UgYXJlIHdvcmtpbmcgb24sIHlvdSBtaWdodCBjaG9vc2Ugb3Igbm90IHRvIHVzZSB0aGlzIG9wdGlvbi4gCgpgYGB7ciwgZXZhbD1GQUxTRX0KI3NlcXRhYjwtIHJlYWRSRFMoInNlcXRhYl9WNC5yZHMiKQpzZXFzIDwtIGdldFNlcXVlbmNlcyhzZXF0YWIpCm5hbWVzKHNlcXMpIDwtIHNlcXMgIyBUaGlzIHByb3BhZ2F0ZXMgdG8gdGhlIHRpcCBsYWJlbHMgb2YgdGhlIHRyZWUuIEF0IHRoaXMgc3RhZ2UgQVNWIGxhYmVscyBhcmUgZnVsbCBBU1Ygc2VxdWVuY2UKYWxpZ25tZW50IDwtIEFsaWduU2VxcyhETkFTdHJpbmdTZXQoc2VxcyksIGFuY2hvcj1OQSwgaXRlcmF0aW9ucyA9IDUsIHJlZmluZW1lbnRzID0gNSkKCnByaW50KCJDb21wdXRpbmcgcGFpcndpc2UgZGlzdGFuY2VzIGZyb20gQVNWcyIpClN5cy50aW1lKCkKcGhhbmcuYWxpZ24gPC0gcGh5RGF0KGFzKGFsaWdubWVudCwgIm1hdHJpeCIpLCB0eXBlPSJETkEiKQpkbSA8LSBkaXN0Lm1sKHBoYW5nLmFsaWduKQp0cmVlTkogPC0gTkooZG0pICMgTm90ZSwgdGlwIG9yZGVyICE9IHNlcXVlbmNlIG9yZGVyCmZpdCA9IHBtbCh0cmVlTkosIGRhdGE9cGhhbmcuYWxpZ24pCnByaW50KCJkb25lIikKU3lzLnRpbWUoKQoKZml0R1RSIDwtIHVwZGF0ZShmaXQsIGs9NCwgaW52PTAuMikKcHJpbnQoImRvbmUiKQpTeXMudGltZSgpCgpwcmludCgiQ29tcHV0aW5nIGxpa2VsaWhvb2Qgb2YgdHJlZSIpClN5cy50aW1lKCkKZml0R1RSIDwtIG9wdGltLnBtbChmaXRHVFIsIG1vZGVsPSJHVFIiLCBvcHRJbnY9VFJVRSwgb3B0R2FtbWE9VFJVRSwKICAgICAgICAgICAgICAgICAgICAgIHJlYXJyYW5nZW1lbnQgPSAic3RvY2hhc3RpYyIsIGNvbnRyb2wgPSBwbWwuY29udHJvbCh0cmFjZSA9IDApKQpwcmludCgiZG9uZSIpClN5cy50aW1lKCkKYGBgCgoKCi0tLS0tCgojIyBTdGVwIDExOiBHZW5lcmF0ZSBPdXRwdXQgRmlsZXMKCkluIHRoaXMgc3RlcCwgd2Ugd2lsbCBnZW5lcmF0ZSBvdXRwdXQgZmlsZXMgZm9ybWF0dGVkIGZvciBkb3duc3RyZWFtIGFuYWx5c2lzIGluIHBoeWxvc2VxCgpEYXRhIHdpbGwgYmUgZXh0cmFjdGVkIGZyb20gdGhlIERBREEyIG91dHB1dHMgYW5kIGZvcm1hdHRlZCBmb3IgZG93bnN0cmVhbSBhbmFseXNpcyBhbmQgZGF0YSBpbnNwZWN0aW9uLiBUaGUgbGFzdCBzdGVwIG9mIHRoaXMgcGlwZWxpbmUgc2F2ZXMgYSBwaHlsb3NlcSBvYmplY3QgYXMgYW4gLlJEUyBmaWxlIGFuZCBjYW4gYmUgaW1wb3J0ZWQgZGlyZWN0bHkgaW4gcGh5bG9zZXEuIAoKYGBge3J9CiMgUmVuYW1lIEFTViBuYW1lczogCmFzdl9zZXFzPC0gY29sbmFtZXMoc2VxdGFiKQphc3ZfaGVhZGVyczwtIHZlY3RvcihkaW0oc2VxdGFiKVsyXSwgbW9kZSA9ICJjaGFyYWN0ZXIiKQoKZm9yIChpIGluIDE6ZGltKHNlcXRhYilbMl0pIHsKCWFzdl9oZWFkZXJzW2ldIDwtIHBhc3RlKCI+QVNWIiwgaSwgc2VwID0gIl8iKQp9CgoKIyBXcml0ZSBBU1YgZmFzdGEgZm9yIGZpbmFsIEFTViBzZXFzLgojVGhpcyBmYXN0YSBmaWxlIGNhbiBhbHNvIGJlIHVzZWQgZm9yIHBoeWxvZ2VuZXRpYyB0cmVlIGluZmVyZW5jZSBpbiBkaWZmZXJlbnQgcGxhdGZvcm1zCmFzdl9mYXN0YTwtIGMocmJpbmQoYXN2X2hlYWRlcnMsIGFzdl9zZXFzKSkKCm91dGZpbGVfZmFzdGEgPC0gZmlsZS5wYXRoKG91dGRpciwgJ0FTVnMuZmEnKQp3cml0ZShhc3ZfZmFzdGEsIG91dGZpbGVfZmFzdGEpCgoKIyBDb3VudCB0YWJsZToKYXN2X3RhYiA8LSB0KHNlcXRhYikKcm93Lm5hbWVzKGFzdl90YWIpIDwtIHN1YigiPiIsICIiLCBhc3ZfaGVhZGVycykKCm91dGZpbGVfdGFiIDwtIGZpbGUucGF0aChvdXRkaXIsICdBU1ZzX2NvdW50cy50c3YnKQp3cml0ZS50YWJsZShhc3ZfdGFiLCBvdXRmaWxlX3RhYiwgCiAgICAgICAgICAgIHNlcCA9ICJcdCIsIHF1b3RlID0gRkFMU0UsIGNvbC5uYW1lcyA9IE5BKQoKCiMgVGF4IHRhYmxlOgphc3ZfdGF4IDwtIHRheGEKcm93Lm5hbWVzKGFzdl90YXgpIDwtIHN1YigiPiIsICIiLCBhc3ZfaGVhZGVycykKCm91dGZpbGVfdGF4IDwtIGZpbGUucGF0aChvdXRkaXIsICdBU1ZzX3RheG9ub215LnRzdicpCndyaXRlLnRhYmxlKGFzdl90YXgsIG91dGZpbGVfdGF4LAogICAgICAgICAgICBzZXAgPSAiXHQiLCBxdW90ZSA9IEZBTFNFLCBjb2wubmFtZXMgPSBOQSkKCgojIFJlYWQgZmlsZXMgYmFjayBpbjoKY291bnRfdGFiIDwtIHJlYWQudGFibGUob3V0ZmlsZV90YWIsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlciA9IFRSVUUsIHJvdy5uYW1lcyA9IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrLm5hbWVzID0gRkFMU0UsIHNlcCA9ICJcdCIpCgp0YXhfdGFiIDwtIGFzLm1hdHJpeCgKICByZWFkLnRhYmxlKG91dGZpbGVfdGF4LAogICAgICAgICAgICAgaGVhZGVyID0gVFJVRSwgcm93Lm5hbWVzID0gMSwKICAgICAgICAgICAgIGNoZWNrLm5hbWVzID0gRkFMU0UsIHNlcCA9ICJcdCIpCiAgKQoKCiMgTG9hZCBhbmQgcHJlcGFyZSBzYW1wbGUgbWV0YWRhdGE6CnNhbXBsZV9kZiA8LSByZWFkLnRhYmxlKGZpbGUgPSBzYW1wbGVfbmFtZXNfZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VwID0gIlx0IiwgaGVhZGVyID0gVFJVRSkKY29sbmFtZXMoc2FtZGYpWzFdPC0gIlNhbXBsZUlEIgpyb3duYW1lcyhzYW1kZik8LSBzYW1kZiRTYW1wbGVJRAoKCiMgQnVpbGQgdGhlIGZpbmFsIHBoeWxvc2VxIG9iamVjdDoKIyBXZSB3aWxsIG5vdCBkbyB0aGlzIG5vdywgYnV0IGEgcGh5bG9nZW5ldGljIHRyZWUgY2FuIGFsc28gYmUgYWRkZWQgdG8gdGhlIHBoeWxvc2VxIG9iamVjdC4KcHMgPC0gcGh5bG9zZXEob3R1X3RhYmxlKGNvdW50X3RhYiwgdGF4YV9hcmVfcm93cyA9IFRSVUUpLAogICAgICAgICAgICAgICBzYW1wbGVfZGF0YShzYW1wbGVfZGYpLAogICAgICAgICAgICAgICB0YXhfdGFibGUodGF4X3RhYikpCgpvdXRmaWxlX3BzIDwtIGZpbGUucGF0aChvdXRkaXIsICdwc19WNC5yZHMnKQpzYXZlUkRTKHBzLCBmaWxlID0gb3V0ZmlsZV9wcykKCnByaW50KCJkb25lIikKYGBgCgotLS0tLQoKIyMgUmVzb3VyY2VzCgotIFtDYWxsYWhhbiBldCBhbC4gMjAwNjogIkJpb2NvbmR1Y3RvciBXb3JrZmxvdyBmb3IgTWljcm9iaW9tZSBEYXRhIEFuYWx5c2lzOiBmcm9tIHJhdyByZWFkcyB0byBjb21tdW5pdHkgYW5hbHlzZXMiXShodHRwczovL2YxMDAwcmVzZWFyY2guY29tL2FydGljbGVzLzUtMTQ5Mi92MikKLSBbYGRhZGEyYCBkb2N1bWVudGF0aW9uIGFuZCB0dXRvcmlhbHNdKGh0dHBzOi8vYmVuampuZWIuZ2l0aHViLmlvL2RhZGEyL2luZGV4Lmh0bWwgKQotIFtUYXhvbm9taWMgcmVmZXJlbmNlcyBmb3IgYGRhZGEyYF0oaHR0cHM6Ly9iZW5qam5lYi5naXRodWIuaW8vZGFkYTIvdHJhaW5pbmcuaHRtbCkKLSBbYGN1dGFkYXB0YCBkb2N1bWVudGF0aW9uIGFuZCB0dXRvcmlhbHNdKGh0dHBzOi8vY3V0YWRhcHQucmVhZHRoZWRvY3MuaW8vZW4vc3RhYmxlL2luZGV4Lmh0bWwpCgoKLS0tLS0KCiMjIEJvbnVzOiBTdWJtaXQgc2NyaXB0IGFzIGFuIE9TQyBqb2IKCi0gU2NyaXB0IGBkYWRhMi5zaGA6CgpgYGBzaAojUEJTIC1sIHdhbGx0aW1lPTEwMDowMDowMAojUEJTIC1sIG5vZGVzPTE6cHBuPTI4CiNQQlMgLUEgUEFTMTU0OAoKbW9kdWxlIGxvYWQgZ251LzkuMS4wCm1vZHVsZSBsb2FkIG1rbC8yMDE5LjAuMwptb2R1bGUgbG9hZCBSLzMuNi4xCmNkIC9mcy9zY3JhdGNoL1BBUzE1NDgvQmFzZVNwYWNlX291dC8xMS0yMS0xOS9WNF9WNS9zY3JpcHRzClJzY3JpcHQgZGFkYTJfVjQuUgpgYGAKCg==</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("07-ASV-inference.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
