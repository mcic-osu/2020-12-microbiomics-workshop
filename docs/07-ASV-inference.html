<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title> Workflow part II: ASV Inference and Taxon Assignment</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>

<link rel="stylesheet" href="my.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Microbiomics Workshop</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Overview
  </a>
</li>
<li>
  <a href="00-setup.html">
    <span class="fa fa-gear"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Day 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lectures:</li>
    <li>
      <a href="01-microbiomics.html">Intro to Amplicon Sequencing</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Lecture/Code-along:</li>
    <li>
      <a href="02-shell.html">Intro to the Shell</a>
    </li>
    <li>
      <a href="03-OSC.html">Intro to OSC</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Workflow Sessions:</li>
    <li>
      <a href="04-data-overview.html">Overview</a>
    </li>
    <li>
      <a href="05-preprocess-reads.html">I: Adapter and Primer Removal</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Day 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture/Code-along:</li>
    <li>
      <a href="06-R.html">Intro to R</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Workflow Sessions:</li>
    <li>
      <a href="07-ASV-inference.html">II: ASV Inference</a>
    </li>
    <li>
      <a href="08-postASV-analysis.html">III: ASV Analysis</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mcic-osu/2020-12-microbiomics-workshop.git">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><br>Workflow part II:<br>ASV Inference and Taxon Assignment</h1>

</div>


<p><br></p>
<hr />
<div id="goals" class="section level2">
<h2>Goals</h2>
<p>Process metabarcoding reads, post-adapter removal, including:</p>
<ul>
<li>Evaluation of read quality</li>
<li>Quality trimming and filtering</li>
<li>Error correction, denoising</li>
<li>ASV inference</li>
<li>Read merging</li>
<li>Taxonomy assignment</li>
</ul>
<hr />
</div>
<div id="before-we-get-started" class="section level2">
<h2>Before We Get Started</h2>
<div id="notes" class="section level3">
<h3>Notes</h3>
<ul>
<li><p>This documented was adapted from <a href="https://f1000research.com/articles/5-1492/v2">Callahan et al. 2006</a> by Matthew Willman, with further edits by Soledad Benitez Ponce and Jelmer Poelstra.</p></li>
<li><p>To convert an <code>Rmd</code> (R Markdown) file to an R script, type the following in an R console: <code>knitr::purl(input='&lt;filename&gt;.Rmd')</code>. (You can download this <code>Rmd</code> file by clicking the <code>Code</code> button in the top-right of this page – but we will open it at OSC.)</p></li>
</ul>
</div>
<div id="start-an-rstudio-server-job-at-osc" class="section level3">
<h3>Start an RStudio Server job at OSC</h3>
<p>For more detailed instructions of the first steps, see <a href="06-R.html#rstudio-at-OSC">this section</a> from our intro to R session.</p>
<ul>
<li><p>Login to OSC at <a href="https://ondemand.osc.edu" class="uri">https://ondemand.osc.edu</a>.</p></li>
<li><p>Click on <code>Interactive Apps</code> (top bar) &gt; <code>RStudio Server (Owens and Pitzer)</code>.</p></li>
<li><p>Fill out the form as shown <a href="slides/03-OSC-slides.html#rstudio_server_job">here</a>.</p></li>
<li><p>Once your job has started, click <code>Connect to RStudio Server</code>.</p></li>
<li><p>You should automatically be in your personal dir inside the dir <code>/fs/project/PAS0471/workshops/2020-12_micro</code>, with your RStudio Project open. You can see whether a Project is open and which one in the top-right of your screen:</p>
<p align="center">
<p><img src=img/rproj-open.png width="130"> Here, the project <code>jelmer</code> is open. Your project name is also your username.</p>
</p>
<p>If your Project isn’t open, click on the icon to open it:</p>
<p align="center">
<p><img src=img/rproj-dropdown.png width="250"></p>
</p></li>
<li><p>Now, click on the <code>markdown</code> directory in the <em>Files</em> pane, and open the file <code>07-ASV-inference.Rmd</code>. That’s this file!</p></li>
</ul>
<hr />
</div>
</div>
<div id="step-1-getting-started" class="section level2">
<h2>Step 1: Getting Started</h2>
<p>Print some information to screen for when running this script as a job:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">print</span>(<span class="st">&#39;Starting ASV inference script...&#39;</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">Sys.time</span>()</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">cat</span>(<span class="st">&#39;Working directory:&#39;</span>, <span class="kw">getwd</span>(), <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<div id="install-and-load-packages" class="section level3">
<h3>Install and load packages</h3>
<p>To save time, we have already installed all the necessary R packages at OSC into a custom library. To add this library for the current R session:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">.libPaths</span>(<span class="dt">new =</span> <span class="st">&#39;/fs/project/PAS0471/.R/4.0/&#39;</span>)</span></code></pre></div>
<p>Then, load the packages:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">print</span>(<span class="st">&#39;Loading packages...&#39;</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>packages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;tidyverse&#39;</span>, <span class="st">&#39;gridExtra&#39;</span>, <span class="st">&#39;dada2&#39;</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>              <span class="st">&#39;phyloseq&#39;</span>, <span class="st">&#39;DECIPHER&#39;</span>, <span class="st">&#39;phangorn&#39;</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(<span class="dt">char =</span> packages)</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># If you wanted to install and load these packages yourself,</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co"># just make sure you have the pacman package installed:</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">## install.packages(&#39;pacman&#39;)</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co"># Then, the code above would work, as it will install pacakes as needed.</span></span></code></pre></div>
</div>
<div id="set-the-file-paths" class="section level3">
<h3>Set the file paths</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Dir with input fastq files:</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>indir &lt;-<span class="st"> &#39;data/processed/fastq_trimmed/second_trim&#39;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># Dirs for output:</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>qc_dir &lt;-<span class="st"> &#39;analysis/QC&#39;</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>filter_dir &lt;-<span class="st"> &#39;data/processed/fastq_filtered&#39;</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>outdir &lt;-<span class="st"> &#39;analysis/ASV_inference&#39;</span></span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co"># Fasta file with training data:</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># (Check for an up-to-date version at &lt;https://benjjneb.github.io/dada2/training.html&gt;)</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>tax_key &lt;-<span class="st"> &#39;data/ref/silva_nr99_v138_train_set.fa&#39;</span> </span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co"># File with sample metadata:</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>metadata_file &lt;-<span class="st"> &#39;metadata/sample_meta.txt&#39;</span></span></code></pre></div>
</div>
<div id="assign-fastq-files-to-forward-and-reverse-reads" class="section level3">
<h3>Assign fastq files to forward and reverse reads</h3>
<p>We will assign the fastq files that we processed with <code>cutadapt</code> to two vectors: one with files with forward reads, and one with files with reverse reads. These files can be distinguished by having “R1” (forward) and “R2” (reverse) in their names.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>fastqs_raw_F &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">list.files</span>(indir, <span class="dt">pattern =</span> <span class="st">&#39;_R1_001.fastq.gz&#39;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>))</span>
<span id="cb5-2"><a href="#cb5-2"></a>fastqs_raw_R &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">list.files</span>(indir, <span class="dt">pattern =</span> <span class="st">&#39;_R2_001.fastq.gz&#39;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>))</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">print</span>(<span class="st">&#39;First fastq files:&#39;</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="kw">head</span>(fastqs_raw_F)</span></code></pre></div>
</div>
<div id="check-sample-ids" class="section level3">
<h3>Check sample IDs</h3>
<p>We’ll get the sample IDs from the fastq file names and from a file with metadata, and will check if they are the same.</p>
<p>First we get the metadata into a dataframe:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">print</span>(<span class="st">&#39;Load and prepare sample metadata...&#39;</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>metadata_df &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> metadata_file, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="kw">colnames</span>(metadata_df)[<span class="dv">1</span>] &lt;-<span class="st"> &#39;SampleID&#39;</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="kw">rownames</span>(metadata_df) &lt;-<span class="st"> </span>metadata_df<span class="op">$</span>SampleID</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="kw">print</span>(<span class="st">&#39;First fastq files:&#39;</span>)</span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="kw">head</span>(metadata_df)</span></code></pre></div>
<p>Let’s compare the sample IDs from the metadata with the fastq filenames:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">print</span>(<span class="st">&#39;IDs from metadata:&#39;</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a>metadata_df<span class="op">$</span>SampleID</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw">print</span>(<span class="st">&#39;Fastq file names:&#39;</span>)</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="kw">head</span>(<span class="kw">basename</span>(fastqs_raw_F))    <span class="co"># basename() strips the dir name from the filename</span></span></code></pre></div>
<p>To extract the sample IDs from the fastq file names, we remove everything after “-V4-V5” from the file names using the <code>sub()</code> function:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># sub() arguments: sub(pattern, replacement, vector)</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>sampleIDs &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;-V4-V5_.*&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">basename</span>(fastqs_raw_F))</span></code></pre></div>
<p>We can check whether the IDs from the fastq files and the metadata dataframe are the same:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">print</span>(<span class="st">&#39;Are the sample IDs from the metadata and the fastq files the same:&#39;</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">identical</span>(<span class="kw">sort</span>(metadata_df<span class="op">$</span>SampleID), sampleIDs)</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="kw">print</span>(<span class="st">&#39;Are any samples missing from the fastq files?&#39;</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="kw">setdiff</span>(<span class="kw">sort</span>(metadata_df<span class="op">$</span>SampleID), sampleIDs)</span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="kw">print</span>(<span class="st">&#39;Are any samples missing from the metadata?&#39;</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="kw">setdiff</span>(sampleIDs, <span class="kw">sort</span>(metadata_df<span class="op">$</span>SampleID))</span></code></pre></div>
<p>As it turns out, we don’t have sequences for three samples in the metadata.</p>
<hr />
</div>
</div>
<div id="step-2-qc" class="section level2">
<h2>Step 2: QC</h2>
<div id="plot-sequence-quality-data" class="section level3">
<h3>Plot sequence quality data</h3>
<p>You can generate and evaluate plots individually (forward and reverse side-by-side):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">plotQualityProfile</span>(<span class="kw">c</span>(fastqs_raw_F[<span class="dv">1</span>], fastqs_raw_R[<span class="dv">1</span>]))</span></code></pre></div>
<p><br></p>
<p>Or generate pdf files to inspect multiple plots at once:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">pdf</span>(<span class="kw">file.path</span>(qc_dir, <span class="st">&#39;error_profiles.pdf&#39;</span>))  <span class="co"># Open a pdf file</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="cf">for</span> (sample_index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) {                   <span class="co"># Loop through first three file pairs</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="kw">print</span>(<span class="kw">plotQualityProfile</span>(                   <span class="co"># Print plots into pdf</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="kw">c</span>(fastqs_raw_F[sample_index], fastqs_raw_R[sample_index])) <span class="co"># F and R together</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    )</span>
<span id="cb11-6"><a href="#cb11-6"></a>}</span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw">dev.off</span>()                                    <span class="co"># Close the pdf file</span></span></code></pre></div>
<details>
<summary>   <i class="fas  fa-info-circle "></i>   More on QC of fastq files </summary> It is a good idea to run the <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/"><code>fastqc</code></a> program on your fastq files for more extensive QC. This is a stand-alone program that is easy to run from the command-line. When you have many samples, as is often the case, <code>fastqc</code>’s results can moreover be nicely summarized using [<code>multiqc</code>](<a href="https://multiqc.info/" class="uri">https://multiqc.info/</a>. In the interest of time, we skipped these steps during this workshop.
</details>
<hr />
</div>
</div>
<div id="step-3-filtering-and-quality-trimming" class="section level2">
<h2>Step 3: Filtering and Quality Trimming</h2>
<p>We will now perform quality filtering (removing poor-quality reads) and trimming (removing poor-quality bases) on the fastq files using DADA2’s <code>filterAndTrim()</code> function.</p>
<p>The <code>truncLen</code> argument defines the read lengths (for forward and reverse reads, respectively) beyond which additional bases should be removed, and these values should be based on the sequence quality visualized above. The trimming length can thus be different for forward and reverse reads, but ideally not too drastically so, in order to maximize the number of pairs that will merge in a subsequent step.</p>
<p>It is also suggested to trim the first 10 nucleotides of each read (<code>trimLeft</code> argument), since these positions are likely to contain errors.</p>
<p>The <code>filterAndTrim()</code> function will write the filtered and trimmed reads to new fastq files. Therefore, we first define the file names for the new files:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>fastqs_filt_F &lt;-<span class="st"> </span><span class="kw">file.path</span>(filter_dir, <span class="kw">paste0</span>(sampleIDs, <span class="st">&#39;_F_filt.fastq&#39;</span>))</span>
<span id="cb12-2"><a href="#cb12-2"></a>fastqs_filt_R &lt;-<span class="st"> </span><span class="kw">file.path</span>(filter_dir, <span class="kw">paste0</span>(sampleIDs, <span class="st">&#39;_R_filt.fastq&#39;</span>))</span></code></pre></div>
<p><br></p>
<p>Then, perform the trimming:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">print</span>(<span class="st">&#39;Filtering and Trimming...&#39;</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">Sys.time</span>()  <span class="co"># Print the time to keep track of running time for individual steps </span></span>
<span id="cb13-3"><a href="#cb13-3"></a>filter_results &lt;-</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="st">  </span><span class="kw">filterAndTrim</span>(fastqs_raw_F, fastqs_filt_F,</span>
<span id="cb13-5"><a href="#cb13-5"></a>                fastqs_raw_R, fastqs_filt_R,</span>
<span id="cb13-6"><a href="#cb13-6"></a>                <span class="dt">truncLen =</span> <span class="kw">c</span>(<span class="dv">250</span>,<span class="dv">210</span>),</span>
<span id="cb13-7"><a href="#cb13-7"></a>                <span class="dt">trimLeft =</span> <span class="dv">10</span>,</span>
<span id="cb13-8"><a href="#cb13-8"></a>                <span class="dt">maxN =</span> <span class="dv">0</span>,</span>
<span id="cb13-9"><a href="#cb13-9"></a>                <span class="dt">maxEE =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb13-10"><a href="#cb13-10"></a>                <span class="dt">truncQ =</span> <span class="dv">2</span>,</span>
<span id="cb13-11"><a href="#cb13-11"></a>                <span class="dt">rm.phix =</span> <span class="ot">FALSE</span>,</span>
<span id="cb13-12"><a href="#cb13-12"></a>                <span class="dt">compress =</span> <span class="ot">FALSE</span>, <span class="dt">multithread =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>) </span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="kw">print</span>(<span class="st">&#39;...Done!&#39;</span>)</span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="kw">Sys.time</span>()</span>
<span id="cb13-15"><a href="#cb13-15"></a></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="kw">head</span>(filter_results)</span></code></pre></div>
<hr />
</div>
<div id="step-4-dereplication-error-training" class="section level2">
<h2>Step 4: Dereplication &amp; Error Training</h2>
<p>The next thing we want to do is “dereplicate” the filtered fastq files. During dereplication, we condense the data by collapsing together all reads that encode the same sequence, which significantly reduces later computation times.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>fastqs_derep_F &lt;-<span class="st"> </span><span class="kw">derepFastq</span>(fastqs_filt_F, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a>fastqs_derep_R &lt;-<span class="st"> </span><span class="kw">derepFastq</span>(fastqs_filt_R, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="kw">names</span>(fastqs_derep_F) &lt;-<span class="st"> </span>sampleIDs</span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="kw">names</span>(fastqs_derep_R) &lt;-<span class="st"> </span>sampleIDs</span></code></pre></div>
<p>The DADA2 algorithm makes use of a parametric error model (<code>err</code>) and every amplicon dataset has a different set of error rates. The <code>learnErrors</code> method learns this error model from the data, by alternating estimation of the error rates and inference of sample composition until they converge on a jointly consistent solution.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">print</span>(<span class="st">&#39;Learning errors...&#39;</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">Sys.time</span>()</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a>err_F &lt;-<span class="st"> </span><span class="kw">learnErrors</span>(fastqs_derep_F, <span class="dt">multithread =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a>err_R &lt;-<span class="st"> </span><span class="kw">learnErrors</span>(fastqs_derep_R, <span class="dt">multithread =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="kw">print</span>(<span class="st">&#39;...Done!&#39;</span>)</span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="kw">Sys.time</span>()</span></code></pre></div>
<p><br></p>
<p>Plot errors to verify that error rates have been reasonable well-estimated. Observe the fit between observed error rates (points) and fitted error rates (lines):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">plotErrors</span>(err_F, <span class="dt">nominalQ =</span> <span class="ot">TRUE</span>)</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="kw">plotErrors</span>(err_R, <span class="dt">nominalQ =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<hr />
</div>
<div id="step-5-infer-asvs" class="section level2">
<h2>Step 5: Infer ASVs</h2>
<p>We will run the dada algorithm to infer Amplicon Sequence Variants (ASVs).</p>
<p>This step is quite computationally intensive, and we will therefore perform independent inference for each sample (<code>pool = FALSE</code>), which will keep memory usage linear to the sample number. Pooling will increase memory rquirements and computation time, but improve detection of rare variants seen once or twice in an individual sample, but many times across all samples.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">print</span>(<span class="st">&#39;Inferring ASVs (running the dada algorithm)...&#39;</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">Sys.time</span>()</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a>dada_Fs &lt;-<span class="st"> </span><span class="kw">dada</span>(fastqs_derep_F, <span class="dt">err =</span> err_F, <span class="dt">pool =</span> <span class="ot">FALSE</span>, <span class="dt">multithread =</span> <span class="ot">TRUE</span>)</span>
<span id="cb17-5"><a href="#cb17-5"></a>dada_Rs &lt;-<span class="st"> </span><span class="kw">dada</span>(fastqs_derep_R, <span class="dt">err =</span> err_R, <span class="dt">pool =</span> <span class="ot">FALSE</span>, <span class="dt">multithread =</span> <span class="ot">TRUE</span>)</span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="kw">print</span>(<span class="st">&#39;...Done.&#39;</span>)</span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="kw">Sys.time</span>()</span></code></pre></div>
<p>Let’s inspect one of the resulting objects:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>dada_Fs[[<span class="dv">1</span>]]</span></code></pre></div>
<hr />
</div>
<div id="step-6-merge-read-pairs" class="section level2">
<h2>Step 6: Merge Read Pairs</h2>
<p>In this step, we will first merge the forward and reverse read pairs: the fragment that we amplified with our primers was short enough to generate lots of overlap among the sequences from the two directions.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>mergers &lt;-<span class="st"> </span><span class="kw">mergePairs</span>(dada_Fs, fastqs_derep_F,</span>
<span id="cb19-2"><a href="#cb19-2"></a>                      dada_Rs, fastqs_derep_R,</span>
<span id="cb19-3"><a href="#cb19-3"></a>                      <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><br></p>
<p>Just like tables can be saved in R using <code>write.table</code> or <code>write.csv</code>, R <em>objects</em> can be saved using <code>saveRDS</code>. The resulting .rds file can then be loaded into an R environment using <code>readRDS</code>. This is a convenient way to save R objects that require a lot of computation time.</p>
<p>We should not be needing the very large dereplicated sequence objects anymore, but to be able to quickly restart our analysis from a new R session if necessary, we now save these objects to RDS files. And after that, we can safely remove these objects from our environment.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">saveRDS</span>(fastqs_derep_F, <span class="dt">file =</span> <span class="kw">file.path</span>(outdir, <span class="st">&#39;fastqs_derep_F.rds&#39;</span>))</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="kw">saveRDS</span>(fastqs_derep_R, <span class="dt">file =</span> <span class="kw">file.path</span>(outdir, <span class="st">&#39;fastqs_derep_R.rds&#39;</span>))</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="kw">rm</span>(fastqs_derep_F, fastqs_derep_R) <span class="co"># Remove objects from environment</span></span></code></pre></div>
<hr />
</div>
<div id="step-7-construct-a-sequence-table" class="section level2">
<h2>Step 7: Construct a Sequence Table</h2>
<p>Next, we construct an amplicon sequence variant table (ASV) table:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>seqtab_all &lt;-<span class="st"> </span><span class="kw">makeSequenceTable</span>(mergers)</span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co"># The dimensions of the object are the nr of samples (rows) and the nr of ASVs (columns):</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="kw">dim</span>(seqtab_all)</span></code></pre></div>
<p>Let’s inspect the distribution of sequence lengths:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">table</span>(<span class="kw">nchar</span>(<span class="kw">getSequences</span>(seqtab_all)))</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co"># If you need to remove sequences of a particular length (e.g. too long):</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co"># seqtab2 &lt;- seqtab[, nchar(colnames(seqtab_all)) %in% seq(250,256)]</span></span></code></pre></div>
<hr />
</div>
<div id="step-8-remove-chimeras" class="section level2">
<h2>Step 8: Remove Chimeras</h2>
<p>Now, we will remove chimeras. The <code>dada</code> algorithm models and removes substitution errors, but chimeras are another importance source of spurious sequences in amplicon sequencing. Chimeras are formed during PCR amplification. When one sequence is incompletely amplified, the incomplete amplicon primes the next amplification step, yielding a spurious amplicon. The result is a sequence read which is half of one sample sequence and half another.</p>
<p>Fortunately, the accuracy of the sequence variants after denoising makes identifying chimeras simpler than it is when dealing with fuzzy OTUs. Chimeric sequences are identified if they can be exactly reconstructed by combining a left-segment and a right-segment from two more abundant “parent” sequences.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>seqtab &lt;-<span class="st"> </span><span class="kw">removeBimeraDenovo</span>(seqtab_all,</span>
<span id="cb23-2"><a href="#cb23-2"></a>                             <span class="dt">method =</span> <span class="st">&#39;consensus&#39;</span>,</span>
<span id="cb23-3"><a href="#cb23-3"></a>                             <span class="dt">multithread =</span> <span class="ot">TRUE</span>,</span>
<span id="cb23-4"><a href="#cb23-4"></a>                             <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="kw">ncol</span>(seqtab)</span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co"># Proportion of retained sequences:</span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="kw">sum</span>(seqtab) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(seqtab_all)</span></code></pre></div>
<p>We will save the <code>seqtab</code> object as an RDS file:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">saveRDS</span>(seqtab, <span class="dt">file =</span> <span class="kw">file.path</span>(outdir, <span class="st">&#39;seqtab_V4.rds&#39;</span>))</span></code></pre></div>
<hr />
</div>
<div id="step-9-generate-a-summary-table" class="section level2">
<h2>Step 9: Generate a Summary Table</h2>
<p>In this step, we will generate a summary table of the number of sequences processed and outputs of different steps of the pipeline.</p>
<p>This information is generally used to further evaluate characteristics and quality of the run, sample-to-sample variation, and resulting sequencing depth for each sample.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># We define a function `getN`, which will get the nr of unique reads for a sample: </span></span>
<span id="cb25-2"><a href="#cb25-2"></a>getN &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">sum</span>(<span class="kw">getUniques</span>(x))</span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="co"># We apply the getN function to each element of the dada_Fs, dada_Rs, and mergers objects:</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="co"># This gives us a vector with the number of unique reads for each samples,</span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="co"># for each of these steps:</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>denoised_F &lt;-<span class="st"> </span><span class="kw">sapply</span>(dada_Fs, getN)</span>
<span id="cb25-8"><a href="#cb25-8"></a>denoised_R &lt;-<span class="st"> </span><span class="kw">sapply</span>(dada_Rs, getN)</span>
<span id="cb25-9"><a href="#cb25-9"></a>merged &lt;-<span class="st"> </span><span class="kw">sapply</span>(mergers, getN)</span>
<span id="cb25-10"><a href="#cb25-10"></a></span>
<span id="cb25-11"><a href="#cb25-11"></a><span class="co"># We join these vectors together with the &quot;filter_results&quot; dataframe,</span></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="co"># and the number of nonchimeric reads:</span></span>
<span id="cb25-13"><a href="#cb25-13"></a>nreads_summary &lt;-<span class="st"> </span><span class="kw">data.frame</span>(filter_results,</span>
<span id="cb25-14"><a href="#cb25-14"></a>                             denoised_F,</span>
<span id="cb25-15"><a href="#cb25-15"></a>                             denoised_R,</span>
<span id="cb25-16"><a href="#cb25-16"></a>                             <span class="dt">nonchim =</span> <span class="kw">rowSums</span>(seqtab),</span>
<span id="cb25-17"><a href="#cb25-17"></a>                             <span class="dt">row.names =</span> sampleIDs)</span>
<span id="cb25-18"><a href="#cb25-18"></a><span class="kw">colnames</span>(nreads_summary)[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;input&#39;</span>, <span class="st">&#39;filtered&#39;</span>)</span>
<span id="cb25-19"><a href="#cb25-19"></a></span>
<span id="cb25-20"><a href="#cb25-20"></a><span class="co"># Have a look at the first few rows:</span></span>
<span id="cb25-21"><a href="#cb25-21"></a><span class="kw">head</span>(nreads_summary)</span>
<span id="cb25-22"><a href="#cb25-22"></a></span>
<span id="cb25-23"><a href="#cb25-23"></a><span class="co"># We&#39;ll write this table to file:</span></span>
<span id="cb25-24"><a href="#cb25-24"></a><span class="kw">write.table</span>(nreads_summary, <span class="dt">file =</span> <span class="kw">file.path</span>(outdir, <span class="st">&#39;nreads_summary.txt&#39;</span>),</span>
<span id="cb25-25"><a href="#cb25-25"></a>            <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">quote =</span> <span class="ot">FALSE</span>, <span class="dt">row.names =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<hr />
</div>
<div id="step-10-assign-taxonomy-to-asvs" class="section level2">
<h2>Step 10: Assign Taxonomy to ASVs</h2>
<p>Now, we will assign taxonomy to our ASVs.</p>
<p>Depending on the marker gene and the data, you will have to choose the appropriate reference file for this step.</p>
<p>Several files have been formatted for taxonomy assignments in DADA2 pipeline and are available at the <a href="https://benjjneb.github.io/dada2/index.html">DADA2 website</a>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">print</span>(<span class="st">&#39;Assigning taxa to ASVs...&#39;</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw">Sys.time</span>()</span>
<span id="cb26-3"><a href="#cb26-3"></a></span>
<span id="cb26-4"><a href="#cb26-4"></a>taxa &lt;-<span class="st"> </span><span class="kw">assignTaxonomy</span>(seqtab, tax_key, <span class="dt">multithread =</span> <span class="ot">TRUE</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="kw">colnames</span>(taxa) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Kingdom&#39;</span>, <span class="st">&#39;Phylum&#39;</span>, <span class="st">&#39;Class&#39;</span>, <span class="st">&#39;Order&#39;</span>, <span class="st">&#39;Family&#39;</span>, <span class="st">&#39;Genus&#39;</span>)</span>
<span id="cb26-6"><a href="#cb26-6"></a></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="kw">print</span>(<span class="st">&#39;...Done.&#39;</span>)</span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="kw">Sys.time</span>()</span></code></pre></div>
<hr />
</div>
<div id="step-11-generate-output-files" class="section level2">
<h2>Step 11: Generate Output Files</h2>
<p>In this step, we will generate output files formatted for downstream analysis in <em>phyloseq</em>. Data will be extracted from the DADA2 outputs and formatted for downstream analysis and data inspection. The last step of this pipeline saves a <em>phyloseq</em> object as an .RDS file, which can be imported directly by <em>phyloseq</em>.</p>
<p>First, we will write a fasta file with the final ASV sequences. This fasta file can also be used for phylogenetic tree inference in different platforms.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Prepare sequences and headers:</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>asv_seqs &lt;-<span class="st"> </span><span class="kw">colnames</span>(seqtab)</span>
<span id="cb27-3"><a href="#cb27-3"></a>asv_headers &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;&gt;ASV&#39;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(seqtab), <span class="dt">sep =</span> <span class="st">&#39;_&#39;</span>)</span>
<span id="cb27-4"><a href="#cb27-4"></a></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="co"># Interleave headers and sequences:</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>asv_fasta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rbind</span>(asv_headers, asv_seqs))</span>
<span id="cb27-7"><a href="#cb27-7"></a></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="co"># Write fasta file:</span></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="kw">write</span>(asv_fasta, <span class="dt">file =</span> <span class="kw">file.path</span>(outdir, <span class="st">&#39;ASVs.fa&#39;</span>))</span></code></pre></div>
<p>Build the final <em>phyloseq</em> object. Notes:</p>
<ul>
<li><p>While we will not add phylogenetic tree now, this can also be added to a <em>phyloseq</em> object.</p></li>
<li><p>Our metadata dataframe contains three samples that we don’t have sequences for. However, this is not a problem: <em>phyloseq</em> will match the sample IDs in the metadata with those in the OTU table, and disregard IDs not present in the OTU table.</p></li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>ps &lt;-<span class="st"> </span><span class="kw">phyloseq</span>(<span class="kw">otu_table</span>(seqtab, <span class="dt">taxa_are_rows =</span> <span class="ot">FALSE</span>),</span>
<span id="cb28-2"><a href="#cb28-2"></a>               <span class="kw">sample_data</span>(metadata_df),</span>
<span id="cb28-3"><a href="#cb28-3"></a>               <span class="kw">tax_table</span>(taxa))</span>
<span id="cb28-4"><a href="#cb28-4"></a></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="kw">saveRDS</span>(ps, <span class="dt">file =</span> <span class="kw">file.path</span>(outdir, <span class="st">&#39;ps_V4.rds&#39;</span>))</span></code></pre></div>
<p>Report that we are done!</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">print</span>(<span class="st">&#39;Done with ASV inference.&#39;</span>)</span></code></pre></div>
<hr />
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<ul>
<li><a href="https://f1000research.com/articles/5-1492/v2">Callahan et al. 2006: “Bioconductor Workflow for Microbiome Data Analysis: from raw reads to community analyses”</a></li>
<li><a href="https://benjjneb.github.io/dada2/index.html"><code>dada2</code> documentation and tutorials</a></li>
<li><a href="https://benjjneb.github.io/dada2/training.html">Taxonomic references for <code>dada2</code></a></li>
<li><a href="https://cutadapt.readthedocs.io/en/stable/index.html"><code>cutadapt</code> documentation and tutorials</a></li>
</ul>
<hr />
</div>
<div id="bonus-phylogenetic-tree-estimation" class="section level2">
<h2>Bonus: Phylogenetic Tree Estimation</h2>
<p>A phylogenetic tree can be estimated for the sequence data you generated. Depending on the number of ASVs recovered and the phylogenetic tree algorithm of choice, this step could take several days. Simpler trees will be less computationally intensive. Depending on the marker gene you are working on, you might choose or not to use this option.</p>
<p>This step can be conducted after Step 10, and then the phylogeny can be included in the <em>phyloseq</em> object in Step 11.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">#seqtab&lt;- readRDS(&#39;seqtab_V4.rds&#39;)</span></span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a>seqs &lt;-<span class="st"> </span><span class="kw">getSequences</span>(seqtab)</span>
<span id="cb30-4"><a href="#cb30-4"></a></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="co"># This propagates to the tip labels of the tree.</span></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="co"># At this stage ASV labels are full ASV sequence</span></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="kw">names</span>(seqs) &lt;-<span class="st"> </span>seqs </span>
<span id="cb30-8"><a href="#cb30-8"></a>alignment &lt;-<span class="st"> </span><span class="kw">AlignSeqs</span>(<span class="kw">DNAStringSet</span>(seqs),</span>
<span id="cb30-9"><a href="#cb30-9"></a>                       <span class="dt">anchor =</span> <span class="ot">NA</span>,</span>
<span id="cb30-10"><a href="#cb30-10"></a>                       <span class="dt">iterations =</span> <span class="dv">5</span>,</span>
<span id="cb30-11"><a href="#cb30-11"></a>                       <span class="dt">refinements =</span> <span class="dv">5</span>)</span>
<span id="cb30-12"><a href="#cb30-12"></a></span>
<span id="cb30-13"><a href="#cb30-13"></a><span class="kw">print</span>(<span class="st">&#39;Computing pairwise distances from ASVs...&#39;</span>)</span>
<span id="cb30-14"><a href="#cb30-14"></a><span class="kw">Sys.time</span>()</span>
<span id="cb30-15"><a href="#cb30-15"></a>phang.align &lt;-<span class="st"> </span><span class="kw">phyDat</span>(<span class="kw">as</span>(alignment, <span class="st">&#39;matrix&#39;</span>), <span class="dt">type =</span> <span class="st">&#39;DNA&#39;</span>)</span>
<span id="cb30-16"><a href="#cb30-16"></a>dm &lt;-<span class="st"> </span><span class="kw">dist.ml</span>(phang.align)</span>
<span id="cb30-17"><a href="#cb30-17"></a>treeNJ &lt;-<span class="st"> </span><span class="kw">NJ</span>(dm) <span class="co"># Note, tip order is not sequence order</span></span>
<span id="cb30-18"><a href="#cb30-18"></a>fit =<span class="st"> </span><span class="kw">pml</span>(treeNJ, <span class="dt">data =</span> phang.align)</span>
<span id="cb30-19"><a href="#cb30-19"></a><span class="kw">print</span>(<span class="st">&#39;...Done.&#39;</span>)</span>
<span id="cb30-20"><a href="#cb30-20"></a><span class="kw">Sys.time</span>()</span>
<span id="cb30-21"><a href="#cb30-21"></a></span>
<span id="cb30-22"><a href="#cb30-22"></a><span class="kw">print</span>(<span class="st">&#39;....&#39;</span>)</span>
<span id="cb30-23"><a href="#cb30-23"></a><span class="kw">Sys.time</span>()</span>
<span id="cb30-24"><a href="#cb30-24"></a>fitGTR &lt;-<span class="st"> </span><span class="kw">update</span>(fit, <span class="dt">k =</span> <span class="dv">4</span>, <span class="dt">inv =</span> <span class="fl">0.2</span>)</span>
<span id="cb30-25"><a href="#cb30-25"></a><span class="kw">print</span>(<span class="st">&#39;...Done.&#39;</span>)</span>
<span id="cb30-26"><a href="#cb30-26"></a><span class="kw">Sys.time</span>()</span>
<span id="cb30-27"><a href="#cb30-27"></a></span>
<span id="cb30-28"><a href="#cb30-28"></a><span class="kw">print</span>(<span class="st">&#39;Computing likelihood of tree...&#39;</span>)</span>
<span id="cb30-29"><a href="#cb30-29"></a><span class="kw">Sys.time</span>()</span>
<span id="cb30-30"><a href="#cb30-30"></a>fitGTR &lt;-<span class="st"> </span><span class="kw">optim.pml</span>(fitGTR,</span>
<span id="cb30-31"><a href="#cb30-31"></a>                    <span class="dt">model =</span> <span class="st">&#39;GTR&#39;</span>,</span>
<span id="cb30-32"><a href="#cb30-32"></a>                    <span class="dt">optInv =</span> <span class="ot">TRUE</span>,</span>
<span id="cb30-33"><a href="#cb30-33"></a>                    <span class="dt">optGamma =</span> <span class="ot">TRUE</span>,</span>
<span id="cb30-34"><a href="#cb30-34"></a>                    <span class="dt">rearrangement =</span> <span class="st">&#39;stochastic&#39;</span>,</span>
<span id="cb30-35"><a href="#cb30-35"></a>                    <span class="dt">control =</span> <span class="kw">pml.control</span>(<span class="dt">trace =</span> <span class="dv">0</span>))</span>
<span id="cb30-36"><a href="#cb30-36"></a><span class="kw">print</span>(<span class="st">&#39;...Done&#39;</span>.)</span>
<span id="cb30-37"><a href="#cb30-37"></a><span class="kw">Sys.time</span>()</span></code></pre></div>
<hr />
</div>
<div id="bonus-submit-script-as-an-osc-job" class="section level2">
<h2>Bonus: Submit script as an OSC job</h2>
<p>Extract R code from this document:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r r_code"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>knitr<span class="op">::</span><span class="kw">purl</span>(<span class="dt">input =</span> <span class="st">&#39;markdown/07-ASV-inference.Rmd&#39;</span>,</span>
<span id="cb31-2"><a href="#cb31-2"></a>            <span class="dt">output =</span> <span class="st">&#39;scripts/02-ASV-inference.R&#39;</span>)</span></code></pre></div>
<p>Our script <code>02-ASV-inference.sh</code> with <em>SLURM</em> directives that will submit the R script from the shell using <code>Rscript</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash r_code"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="co">#SBATCH --nodes=1</span></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="co">#SBATCH --ntasks-per-node=8</span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="co">#SBATCH --time=2:00:00</span></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="co">#SBATCH --account=PAS0471</span></span>
<span id="cb32-6"><a href="#cb32-6"></a></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="ex">module</span> load gnu/9.1.0</span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="ex">module</span> load mkl/2019.0.5</span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="ex">module</span> load R/4.0.2</span>
<span id="cb32-10"><a href="#cb32-10"></a></span>
<span id="cb32-11"><a href="#cb32-11"></a><span class="ex">Rscript</span> scripts/02-ASV-inference.R</span></code></pre></div>
<p>Submit the script:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash r_code"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1"></a><span class="ex">sbatch</span> scripts/02-ASV-inference.sh</span></code></pre></div>
<p><br><br></p>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiPGJyPldvcmtmbG93IHBhcnQgSUk6PGJyPkFTViBJbmZlcmVuY2UgYW5kIFRheG9uIEFzc2lnbm1lbnQiCm91dHB1dDoKICBybWFya2Rvd246Omh0bWxfZG9jdW1lbnQ6CiAgICB0aGVtZTogY2VydWxlYW4KICAgIGhpZ2hsaWdodDogdGFuZ28KICAgIGNvZGVfZG93bmxvYWQ6IHRydWUKICAgIHRvYzogdHJ1ZQogICAgdG9jX2Zsb2F0OiB0cnVlCiAgICBjc3M6IG15LmNzcwplZGl0b3Jfb3B0aW9uczoKICBjaHVua19vdXRwdXRfdHlwZTogY29uc29sZQotLS0KCmBgYHtyIGtuaXRyX29wdGlvbnMsIGVjaG89RkFMU0UsIHB1cmw9RkFMU0V9CnJvb3RfZGlyIDwtICcvZnMvcHJvamVjdC9QQVMwNDcxL3dvcmtzaG9wcy8yMDIwLTEyX21pY3JvLyRVU0VSJwoja25pdHI6Om9wdHNfa25pdCRzZXQocm9vdC5kaXIgPSByb290X2RpcikgIyBVTkNPTU1FTlQgQVQgT1NDCgprbml0cjo6b3B0c19jaHVuayRzZXQocmVzdWx0cz0naGlkZScsCiAgICAgICAgICAgICAgICAgICAgICBldmFsID0gRkFMU0UsICMgQ0hBTkdFIFRPIFRSVUUgVE8gUlVOIFVQT04gQ09NUElMSU5HCiAgICAgICAgICAgICAgICAgICAgICBjbGFzcy5zb3VyY2U9J3JfY29kZScsCiAgICAgICAgICAgICAgICAgICAgICBjbGFzcy5vdXRwdXQ9J3Jfb3V0cHV0JywKICAgICAgICAgICAgICAgICAgICAgIGNsYXNzLndhcm5pbmc9J3Jfd2FybmluZycsCiAgICAgICAgICAgICAgICAgICAgICBjbGFzcy5tZXNzYWdlPSdyX3dhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgICAgY2xhc3MuZXJyb3I9J3JfZXJyb3InKQpgYGAKCjxicj4KCi0tLS0tCgojIyBHb2FscwoKUHJvY2VzcyBtZXRhYmFyY29kaW5nIHJlYWRzLCBwb3N0LWFkYXB0ZXIgcmVtb3ZhbCwgaW5jbHVkaW5nOgoKLSBFdmFsdWF0aW9uIG9mIHJlYWQgcXVhbGl0eQotIFF1YWxpdHkgdHJpbW1pbmcgYW5kIGZpbHRlcmluZwotIEVycm9yIGNvcnJlY3Rpb24sIGRlbm9pc2luZwotIEFTViBpbmZlcmVuY2UKLSBSZWFkIG1lcmdpbmcKLSBUYXhvbm9teSBhc3NpZ25tZW50CgotLS0tLQoKIyMgQmVmb3JlIFdlIEdldCBTdGFydGVkCgojIyMgTm90ZXMKCi0gVGhpcyBkb2N1bWVudGVkIHdhcyBhZGFwdGVkIGZyb20gW0NhbGxhaGFuIGV0IGFsLiAyMDA2XShodHRwczovL2YxMDAwcmVzZWFyY2guY29tL2FydGljbGVzLzUtMTQ5Mi92MikKICBieSBNYXR0aGV3IFdpbGxtYW4sIHdpdGggZnVydGhlciBlZGl0cyBieSBTb2xlZGFkIEJlbml0ZXogUG9uY2UgYW5kIEplbG1lciBQb2Vsc3RyYS4KICAKLSBUbyBjb252ZXJ0IGFuIGBSbWRgIChSIE1hcmtkb3duKSBmaWxlIHRvIGFuIFIgc2NyaXB0LAogIHR5cGUgdGhlIGZvbGxvd2luZyBpbiBhbiBSIGNvbnNvbGU6CiAgYGtuaXRyOjpwdXJsKGlucHV0PSc8ZmlsZW5hbWU+LlJtZCcpYC4KICAoWW91IGNhbiBkb3dubG9hZCB0aGlzIGBSbWRgIGZpbGUgYnkgY2xpY2tpbmcgdGhlIGBDb2RlYCBidXR0b24KICBpbiB0aGUgdG9wLXJpZ2h0IG9mIHRoaXMgcGFnZSAtLSBidXQgd2Ugd2lsbCBvcGVuIGl0IGF0IE9TQy4pCgojIyMgU3RhcnQgYW4gUlN0dWRpbyBTZXJ2ZXIgam9iIGF0IE9TQwoKRm9yIG1vcmUgZGV0YWlsZWQgaW5zdHJ1Y3Rpb25zIG9mIHRoZSBmaXJzdCBzdGVwcywKc2VlIFt0aGlzIHNlY3Rpb25dKDA2LVIuaHRtbCNyc3R1ZGlvLWF0LU9TQykgZnJvbSBvdXIgaW50cm8gdG8gUiBzZXNzaW9uLgoKLSBMb2dpbiB0byBPU0MgYXQgPGh0dHBzOi8vb25kZW1hbmQub3NjLmVkdT4uCgotIENsaWNrIG9uIGBJbnRlcmFjdGl2ZSBBcHBzYCAodG9wIGJhcikgPiBgUlN0dWRpbyBTZXJ2ZXIgKE93ZW5zIGFuZCBQaXR6ZXIpYC4KCi0gRmlsbCBvdXQgdGhlIGZvcm0gYXMgc2hvd24gW2hlcmVdKHNsaWRlcy8wMy1PU0Mtc2xpZGVzLmh0bWwjcnN0dWRpb19zZXJ2ZXJfam9iKS4KCi0gT25jZSB5b3VyIGpvYiBoYXMgc3RhcnRlZCwgY2xpY2sgYENvbm5lY3QgdG8gUlN0dWRpbyBTZXJ2ZXJgLgoKLSBZb3Ugc2hvdWxkIGF1dG9tYXRpY2FsbHkgYmUgaW4geW91ciBwZXJzb25hbCBkaXIgaW5zaWRlIHRoZSBkaXIKICBgL2ZzL3Byb2plY3QvUEFTMDQ3MS93b3Jrc2hvcHMvMjAyMC0xMl9taWNyb2AsCiAgd2l0aCB5b3VyIFJTdHVkaW8gUHJvamVjdCBvcGVuLgogIFlvdSBjYW4gc2VlIHdoZXRoZXIgYSBQcm9qZWN0IGlzIG9wZW4gYW5kIHdoaWNoIG9uZQogIGluIHRoZSB0b3AtcmlnaHQgb2YgeW91ciBzY3JlZW46CiAgCiAgPHAgYWxpZ249ImNlbnRlciI+CiAgPGltZyBzcmM9aW1nL3Jwcm9qLW9wZW4ucG5nIHdpZHRoPSIxMzAiPgogIEhlcmUsIHRoZSBwcm9qZWN0IGBqZWxtZXJgIGlzIG9wZW4uIFlvdXIgcHJvamVjdCBuYW1lIGlzIGFsc28geW91ciB1c2VybmFtZS4KICA8L3A+CgogIElmIHlvdXIgUHJvamVjdCBpc24ndCBvcGVuLCBjbGljayBvbiB0aGUgaWNvbiB0byBvcGVuIGl0OgogIAogIDxwIGFsaWduPSJjZW50ZXIiPgogIDxpbWcgc3JjPWltZy9ycHJvai1kcm9wZG93bi5wbmcgd2lkdGg9IjI1MCI+CiAgPC9wPgoKICAKLSBOb3csIGNsaWNrIG9uIHRoZSBgbWFya2Rvd25gIGRpcmVjdG9yeSBpbiB0aGUgKkZpbGVzKiBwYW5lLAogIGFuZCBvcGVuIHRoZSBmaWxlIGAwNy1BU1YtaW5mZXJlbmNlLlJtZGAuIFRoYXQncyB0aGlzIGZpbGUhCgotLS0tLQoKIyMgU3RlcCAxOiBHZXR0aW5nIFN0YXJ0ZWQKClByaW50IHNvbWUgaW5mb3JtYXRpb24gdG8gc2NyZWVuIGZvciB3aGVuIHJ1bm5pbmcgdGhpcyBzY3JpcHQgYXMgYSBqb2I6CgpgYGB7ciBoZWxsb30KcHJpbnQoJ1N0YXJ0aW5nIEFTViBpbmZlcmVuY2Ugc2NyaXB0Li4uJykKU3lzLnRpbWUoKQoKY2F0KCdXb3JraW5nIGRpcmVjdG9yeTonLCBnZXR3ZCgpLCAnXG4nKQpgYGAKCiMjIyBJbnN0YWxsIGFuZCBsb2FkIHBhY2thZ2VzCgpUbyBzYXZlIHRpbWUsIHdlIGhhdmUgYWxyZWFkeSBpbnN0YWxsZWQgYWxsIHRoZSBuZWNlc3NhcnkgUiBwYWNrYWdlcyBhdCBPU0MKaW50byBhIGN1c3RvbSBsaWJyYXJ5LgpUbyBhZGQgdGhpcyBsaWJyYXJ5IGZvciB0aGUgY3VycmVudCBSIHNlc3Npb246CgpgYGB7ciBsaWJfbG9hZH0KLmxpYlBhdGhzKG5ldyA9ICcvZnMvcHJvamVjdC9QQVMwNDcxLy5SLzQuMC8nKQpgYGAKClRoZW4sIGxvYWQgdGhlIHBhY2thZ2VzOgoKYGBge3IgcGFja2FnZV9sb2FkfQpwcmludCgnTG9hZGluZyBwYWNrYWdlcy4uLicpCgpwYWNrYWdlcyA8LSBjKCd0aWR5dmVyc2UnLCAnZ3JpZEV4dHJhJywgJ2RhZGEyJywKICAgICAgICAgICAgICAncGh5bG9zZXEnLCAnREVDSVBIRVInLCAncGhhbmdvcm4nKQpwYWNtYW46OnBfbG9hZChjaGFyID0gcGFja2FnZXMpCgojIElmIHlvdSB3YW50ZWQgdG8gaW5zdGFsbCBhbmQgbG9hZCB0aGVzZSBwYWNrYWdlcyB5b3Vyc2VsZiwKIyBqdXN0IG1ha2Ugc3VyZSB5b3UgaGF2ZSB0aGUgcGFjbWFuIHBhY2thZ2UgaW5zdGFsbGVkOgojIyBpbnN0YWxsLnBhY2thZ2VzKCdwYWNtYW4nKQojIFRoZW4sIHRoZSBjb2RlIGFib3ZlIHdvdWxkIHdvcmssIGFzIGl0IHdpbGwgaW5zdGFsbCBwYWNha2VzIGFzIG5lZWRlZC4KYGBgCgojIyMgU2V0IHRoZSBmaWxlIHBhdGhzCgpgYGB7ciBzZXRfZGlyc30KIyBEaXIgd2l0aCBpbnB1dCBmYXN0cSBmaWxlczoKaW5kaXIgPC0gJ2RhdGEvcHJvY2Vzc2VkL2Zhc3RxX3RyaW1tZWQvc2Vjb25kX3RyaW0nCgojIERpcnMgZm9yIG91dHB1dDoKcWNfZGlyIDwtICdhbmFseXNpcy9RQycKZmlsdGVyX2RpciA8LSAnZGF0YS9wcm9jZXNzZWQvZmFzdHFfZmlsdGVyZWQnCm91dGRpciA8LSAnYW5hbHlzaXMvQVNWX2luZmVyZW5jZScKCiMgRmFzdGEgZmlsZSB3aXRoIHRyYWluaW5nIGRhdGE6CiMgKENoZWNrIGZvciBhbiB1cC10by1kYXRlIHZlcnNpb24gYXQgPGh0dHBzOi8vYmVuampuZWIuZ2l0aHViLmlvL2RhZGEyL3RyYWluaW5nLmh0bWw+KQp0YXhfa2V5IDwtICdkYXRhL3JlZi9zaWx2YV9ucjk5X3YxMzhfdHJhaW5fc2V0LmZhJyAKCiMgRmlsZSB3aXRoIHNhbXBsZSBtZXRhZGF0YToKbWV0YWRhdGFfZmlsZSA8LSAnbWV0YWRhdGEvc2FtcGxlX21ldGEudHh0JwpgYGAKCiMjIyBBc3NpZ24gZmFzdHEgZmlsZXMgdG8gZm9yd2FyZCBhbmQgcmV2ZXJzZSByZWFkcyAKCldlIHdpbGwgYXNzaWduIHRoZSBmYXN0cSBmaWxlcyB0aGF0IHdlIHByb2Nlc3NlZCB3aXRoIGBjdXRhZGFwdGAgdG8gdHdvIHZlY3RvcnM6Cm9uZSB3aXRoIGZpbGVzIHdpdGggZm9yd2FyZCByZWFkcywgYW5kIG9uZSB3aXRoIGZpbGVzIHdpdGggcmV2ZXJzZSByZWFkcy4KVGhlc2UgZmlsZXMgY2FuIGJlIGRpc3Rpbmd1aXNoZWQgYnkgaGF2aW5nICJSMSIgKGZvcndhcmQpIGFuZCAiUjIiIChyZXZlcnNlKQppbiB0aGVpciBuYW1lcy4KCmBgYHtyIGZhc3RxX3BhdGhzfQpmYXN0cXNfcmF3X0YgPC0gc29ydChsaXN0LmZpbGVzKGluZGlyLCBwYXR0ZXJuID0gJ19SMV8wMDEuZmFzdHEuZ3onLCBmdWxsLm5hbWVzID0gVFJVRSkpCmZhc3Rxc19yYXdfUiA8LSBzb3J0KGxpc3QuZmlsZXMoaW5kaXIsIHBhdHRlcm4gPSAnX1IyXzAwMS5mYXN0cS5neicsIGZ1bGwubmFtZXMgPSBUUlVFKSkKCnByaW50KCdGaXJzdCBmYXN0cSBmaWxlczonKQpoZWFkKGZhc3Rxc19yYXdfRikKYGBgCgojIyMgQ2hlY2sgc2FtcGxlIElEcwoKV2UnbGwgZ2V0IHRoZSBzYW1wbGUgSURzIGZyb20gdGhlIGZhc3RxIGZpbGUgbmFtZXMgYW5kIGZyb20gYSBmaWxlIHdpdGggbWV0YWRhdGEsCmFuZCB3aWxsIGNoZWNrIGlmIHRoZXkgYXJlIHRoZSBzYW1lLgoKRmlyc3Qgd2UgZ2V0IHRoZSBtZXRhZGF0YSBpbnRvIGEgZGF0YWZyYW1lOgoKYGBge3IgbWV0YWRhdGF9CnByaW50KCdMb2FkIGFuZCBwcmVwYXJlIHNhbXBsZSBtZXRhZGF0YS4uLicpCgptZXRhZGF0YV9kZiA8LSByZWFkLnRhYmxlKGZpbGUgPSBtZXRhZGF0YV9maWxlLCBzZXAgPSAiXHQiLCBoZWFkZXIgPSBUUlVFKQoKY29sbmFtZXMobWV0YWRhdGFfZGYpWzFdIDwtICdTYW1wbGVJRCcKcm93bmFtZXMobWV0YWRhdGFfZGYpIDwtIG1ldGFkYXRhX2RmJFNhbXBsZUlECgpwcmludCgnRmlyc3QgZmFzdHEgZmlsZXM6JykKaGVhZChtZXRhZGF0YV9kZikKYGBgCgpMZXQncyBjb21wYXJlIHRoZSBzYW1wbGUgSURzIGZyb20gdGhlIG1ldGFkYXRhIHdpdGggdGhlIGZhc3RxIGZpbGVuYW1lczoKCmBgYHtyIGNoZWNrX21ldGFkYXRhfQpwcmludCgnSURzIGZyb20gbWV0YWRhdGE6JykKbWV0YWRhdGFfZGYkU2FtcGxlSUQKCnByaW50KCdGYXN0cSBmaWxlIG5hbWVzOicpCmhlYWQoYmFzZW5hbWUoZmFzdHFzX3Jhd19GKSkgICAgIyBiYXNlbmFtZSgpIHN0cmlwcyB0aGUgZGlyIG5hbWUgZnJvbSB0aGUgZmlsZW5hbWUKYGBgCgpUbyBleHRyYWN0IHRoZSBzYW1wbGUgSURzIGZyb20gdGhlIGZhc3RxIGZpbGUgbmFtZXMsIHdlIHJlbW92ZSBldmVyeXRoaW5nIGFmdGVyCiItVjQtVjUiIGZyb20gdGhlIGZpbGUgbmFtZXMgdXNpbmcgdGhlIGBzdWIoKWAgZnVuY3Rpb246CgpgYGB7ciBzYW1wbGVJRHN9CiMgc3ViKCkgYXJndW1lbnRzOiBzdWIocGF0dGVybiwgcmVwbGFjZW1lbnQsIHZlY3RvcikKc2FtcGxlSURzIDwtIHN1YigiLVY0LVY1Xy4qIiwgIiIsIGJhc2VuYW1lKGZhc3Rxc19yYXdfRikpCmBgYAoKV2UgY2FuIGNoZWNrIHdoZXRoZXIgdGhlIElEcyBmcm9tIHRoZSBmYXN0cSBmaWxlcyBhbmQgdGhlIG1ldGFkYXRhIGRhdGFmcmFtZQphcmUgdGhlIHNhbWU6CgpgYGB7ciBjaGVja19zYW1wbGVJRHN9CnByaW50KCdBcmUgdGhlIHNhbXBsZSBJRHMgZnJvbSB0aGUgbWV0YWRhdGEgYW5kIHRoZSBmYXN0cSBmaWxlcyB0aGUgc2FtZTonKQppZGVudGljYWwoc29ydChtZXRhZGF0YV9kZiRTYW1wbGVJRCksIHNhbXBsZUlEcykKCnByaW50KCdBcmUgYW55IHNhbXBsZXMgbWlzc2luZyBmcm9tIHRoZSBmYXN0cSBmaWxlcz8nKQpzZXRkaWZmKHNvcnQobWV0YWRhdGFfZGYkU2FtcGxlSUQpLCBzYW1wbGVJRHMpCgpwcmludCgnQXJlIGFueSBzYW1wbGVzIG1pc3NpbmcgZnJvbSB0aGUgbWV0YWRhdGE/JykKc2V0ZGlmZihzYW1wbGVJRHMsIHNvcnQobWV0YWRhdGFfZGYkU2FtcGxlSUQpKQpgYGAKCkFzIGl0IHR1cm5zIG91dCwgd2UgZG9uJ3QgaGF2ZSBzZXF1ZW5jZXMgZm9yIHRocmVlIHNhbXBsZXMgaW4gdGhlIG1ldGFkYXRhLgoKLS0tLS0KCiMjIFN0ZXAgMjogUUMKCiMjIyBQbG90IHNlcXVlbmNlIHF1YWxpdHkgZGF0YQoKWW91IGNhbiBnZW5lcmF0ZSBhbmQgZXZhbHVhdGUgcGxvdHMgaW5kaXZpZHVhbGx5IChmb3J3YXJkIGFuZCByZXZlcnNlIHNpZGUtYnktc2lkZSk6CgpgYGB7ciBwbG90X3F1YWxfMX0KcGxvdFF1YWxpdHlQcm9maWxlKGMoZmFzdHFzX3Jhd19GWzFdLCBmYXN0cXNfcmF3X1JbMV0pKQpgYGAKCjxicj4KCk9yIGdlbmVyYXRlIHBkZiBmaWxlcyB0byBpbnNwZWN0IG11bHRpcGxlIHBsb3RzIGF0IG9uY2U6CgpgYGB7ciBwbG90X3F1YWxfMn0KcGRmKGZpbGUucGF0aChxY19kaXIsICdlcnJvcl9wcm9maWxlcy5wZGYnKSkgICMgT3BlbiBhIHBkZiBmaWxlCmZvciAoc2FtcGxlX2luZGV4IGluIDE6MykgeyAgICAgICAgICAgICAgICAgICAjIExvb3AgdGhyb3VnaCBmaXJzdCB0aHJlZSBmaWxlIHBhaXJzCiAgcHJpbnQocGxvdFF1YWxpdHlQcm9maWxlKCAgICAgICAgICAgICAgICAgICAjIFByaW50IHBsb3RzIGludG8gcGRmCiAgICBjKGZhc3Rxc19yYXdfRltzYW1wbGVfaW5kZXhdLCBmYXN0cXNfcmF3X1Jbc2FtcGxlX2luZGV4XSkpICMgRiBhbmQgUiB0b2dldGhlcgogICAgKQp9CmRldi5vZmYoKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ2xvc2UgdGhlIHBkZiBmaWxlCmBgYAoKPGRldGFpbHM+CjxzdW1tYXJ5PgombmJzcDsgIGByIGljb246OmZhKCJpbmZvLWNpcmNsZSIpYCAmbmJzcDsgTW9yZSBvbiBRQyBvZiBmYXN0cSBmaWxlcwo8L3N1bW1hcnk+Ckl0IGlzIGEgZ29vZCBpZGVhIHRvIHJ1biB0aGUKW2BmYXN0cWNgXShodHRwczovL3d3dy5iaW9pbmZvcm1hdGljcy5iYWJyYWhhbS5hYy51ay9wcm9qZWN0cy9mYXN0cWMvKQpwcm9ncmFtIG9uIHlvdXIgZmFzdHEgZmlsZXMgZm9yIG1vcmUgZXh0ZW5zaXZlIFFDLgpUaGlzIGlzIGEgc3RhbmQtYWxvbmUgcHJvZ3JhbSB0aGF0IGlzIGVhc3kgdG8gcnVuIGZyb20gdGhlIGNvbW1hbmQtbGluZS4KV2hlbiB5b3UgaGF2ZSBtYW55IHNhbXBsZXMsIGFzIGlzIG9mdGVuIHRoZSBjYXNlLApgZmFzdHFjYCdzIHJlc3VsdHMgY2FuIG1vcmVvdmVyIGJlIG5pY2VseSBzdW1tYXJpemVkIHVzaW5nCltgbXVsdGlxY2BdKGh0dHBzOi8vbXVsdGlxYy5pbmZvLy4KSW4gdGhlIGludGVyZXN0IG9mIHRpbWUsIHdlIHNraXBwZWQgdGhlc2Ugc3RlcHMgZHVyaW5nIHRoaXMgd29ya3Nob3AuCjwvZGV0YWlscz4KCi0tLS0tCgojIyBTdGVwIDM6IEZpbHRlcmluZyBhbmQgUXVhbGl0eSBUcmltbWluZwoKV2Ugd2lsbCBub3cgcGVyZm9ybSBxdWFsaXR5IGZpbHRlcmluZyAocmVtb3ZpbmcgcG9vci1xdWFsaXR5IHJlYWRzKQphbmQgdHJpbW1pbmcgKHJlbW92aW5nIHBvb3ItcXVhbGl0eSBiYXNlcykgb24gdGhlIGZhc3RxIGZpbGVzCnVzaW5nIERBREEyJ3MgYGZpbHRlckFuZFRyaW0oKWAgZnVuY3Rpb24uCgpUaGUgYHRydW5jTGVuYCBhcmd1bWVudCBkZWZpbmVzIHRoZSByZWFkIGxlbmd0aHMKKGZvciBmb3J3YXJkIGFuZCByZXZlcnNlIHJlYWRzLCByZXNwZWN0aXZlbHkpCmJleW9uZCB3aGljaCBhZGRpdGlvbmFsIGJhc2VzIHNob3VsZCBiZSByZW1vdmVkLAphbmQgdGhlc2UgdmFsdWVzIHNob3VsZCBiZSBiYXNlZCBvbiB0aGUgc2VxdWVuY2UgcXVhbGl0eSB2aXN1YWxpemVkIGFib3ZlLgpUaGUgdHJpbW1pbmcgbGVuZ3RoIGNhbiB0aHVzIGJlIGRpZmZlcmVudCBmb3IgZm9yd2FyZCBhbmQgcmV2ZXJzZSByZWFkcywKYnV0IGlkZWFsbHkgbm90IHRvbyBkcmFzdGljYWxseSBzbywKaW4gb3JkZXIgdG8gbWF4aW1pemUgdGhlIG51bWJlciBvZiBwYWlycyB0aGF0IHdpbGwgbWVyZ2UgaW4gYSBzdWJzZXF1ZW50IHN0ZXAuCgpJdCBpcyBhbHNvIHN1Z2dlc3RlZCB0byB0cmltIHRoZSBmaXJzdCAxMCBudWNsZW90aWRlcyBvZiBlYWNoIHJlYWQKKGB0cmltTGVmdGAgYXJndW1lbnQpLApzaW5jZSB0aGVzZSBwb3NpdGlvbnMgYXJlIGxpa2VseSB0byBjb250YWluIGVycm9ycy4KClRoZSBgZmlsdGVyQW5kVHJpbSgpYCBmdW5jdGlvbiB3aWxsIHdyaXRlIHRoZSBmaWx0ZXJlZCBhbmQgdHJpbW1lZCByZWFkcwp0byBuZXcgZmFzdHEgZmlsZXMuClRoZXJlZm9yZSwgd2UgZmlyc3QgZGVmaW5lIHRoZSBmaWxlIG5hbWVzIGZvciB0aGUgbmV3IGZpbGVzOgoKYGBge3IgZmFzdHFfZmlsdF9wYXRoc30KZmFzdHFzX2ZpbHRfRiA8LSBmaWxlLnBhdGgoZmlsdGVyX2RpciwgcGFzdGUwKHNhbXBsZUlEcywgJ19GX2ZpbHQuZmFzdHEnKSkKZmFzdHFzX2ZpbHRfUiA8LSBmaWxlLnBhdGgoZmlsdGVyX2RpciwgcGFzdGUwKHNhbXBsZUlEcywgJ19SX2ZpbHQuZmFzdHEnKSkKYGBgCgo8YnI+CgpUaGVuLCBwZXJmb3JtIHRoZSB0cmltbWluZzoKCmBgYHtyIGZhc3RxX2ZpbHRlcmluZ30KcHJpbnQoJ0ZpbHRlcmluZyBhbmQgVHJpbW1pbmcuLi4nKQpTeXMudGltZSgpICAjIFByaW50IHRoZSB0aW1lIHRvIGtlZXAgdHJhY2sgb2YgcnVubmluZyB0aW1lIGZvciBpbmRpdmlkdWFsIHN0ZXBzIApmaWx0ZXJfcmVzdWx0cyA8LQogIGZpbHRlckFuZFRyaW0oZmFzdHFzX3Jhd19GLCBmYXN0cXNfZmlsdF9GLAogICAgICAgICAgICAgICAgZmFzdHFzX3Jhd19SLCBmYXN0cXNfZmlsdF9SLAogICAgICAgICAgICAgICAgdHJ1bmNMZW4gPSBjKDI1MCwyMTApLAogICAgICAgICAgICAgICAgdHJpbUxlZnQgPSAxMCwKICAgICAgICAgICAgICAgIG1heE4gPSAwLAogICAgICAgICAgICAgICAgbWF4RUUgPSBjKDIsMiksCiAgICAgICAgICAgICAgICB0cnVuY1EgPSAyLAogICAgICAgICAgICAgICAgcm0ucGhpeCA9IEZBTFNFLAogICAgICAgICAgICAgICAgY29tcHJlc3MgPSBGQUxTRSwgbXVsdGl0aHJlYWQgPSBUUlVFLCB2ZXJib3NlID0gVFJVRSkgCnByaW50KCcuLi5Eb25lIScpClN5cy50aW1lKCkKCmhlYWQoZmlsdGVyX3Jlc3VsdHMpCmBgYAoKLS0tLS0KCiMjIFN0ZXAgNDogRGVyZXBsaWNhdGlvbiAmIEVycm9yIFRyYWluaW5nCgpUaGUgbmV4dCB0aGluZyB3ZSB3YW50IHRvIGRvIGlzICJkZXJlcGxpY2F0ZSIgdGhlIGZpbHRlcmVkIGZhc3RxIGZpbGVzLgpEdXJpbmcgZGVyZXBsaWNhdGlvbiwgd2UgY29uZGVuc2UgdGhlIGRhdGEgYnkgY29sbGFwc2luZyB0b2dldGhlciBhbGwgcmVhZHMgdGhhdAplbmNvZGUgdGhlIHNhbWUgc2VxdWVuY2UsIHdoaWNoIHNpZ25pZmljYW50bHkgcmVkdWNlcyBsYXRlciBjb21wdXRhdGlvbiB0aW1lcy4KCmBgYHtyIGZhc3RxX2RlcmVwfQpmYXN0cXNfZGVyZXBfRiA8LSBkZXJlcEZhc3RxKGZhc3Rxc19maWx0X0YsIHZlcmJvc2UgPSBGQUxTRSkKZmFzdHFzX2RlcmVwX1IgPC0gZGVyZXBGYXN0cShmYXN0cXNfZmlsdF9SLCB2ZXJib3NlID0gRkFMU0UpCgpuYW1lcyhmYXN0cXNfZGVyZXBfRikgPC0gc2FtcGxlSURzCm5hbWVzKGZhc3Rxc19kZXJlcF9SKSA8LSBzYW1wbGVJRHMKYGBgCgpgYGB7ciwgZWNobz1GQUxTRX0Kc2F2ZVJEUyhmYXN0cXNfZGVyZXBfRiwgZmlsZSA9IGZpbGUucGF0aChvdXRkaXIsICdmYXN0cXNfZGVyZXBfRi5yZHMnKSkKc2F2ZVJEUyhmYXN0cXNfZGVyZXBfUiwgZmlsZSA9IGZpbGUucGF0aChvdXRkaXIsICdmYXN0cXNfZGVyZXBfUi5yZHMnKSkKCiMgZmFzdHFzX2RlcmVwX0YgPC0gcmVhZFJEUyhmaWxlLnBhdGgob3V0ZGlyLCAnZmFzdHFzX2RlcmVwX0YucmRzJykpCiMgZmFzdHFzX2RlcmVwX1IgPC0gcmVhZFJEUyhmaWxlLnBhdGgob3V0ZGlyLCAnZmFzdHFzX2RlcmVwX1IucmRzJykpCmBgYAoKVGhlIERBREEyIGFsZ29yaXRobSBtYWtlcyB1c2Ugb2YgYSBwYXJhbWV0cmljIGVycm9yIG1vZGVsIChgZXJyYCkgYW5kIGV2ZXJ5CmFtcGxpY29uIGRhdGFzZXQgaGFzIGEgZGlmZmVyZW50IHNldCBvZiBlcnJvciByYXRlcy4KVGhlIGBsZWFybkVycm9yc2AgbWV0aG9kIGxlYXJucyB0aGlzIGVycm9yIG1vZGVsIGZyb20gdGhlIGRhdGEsCmJ5IGFsdGVybmF0aW5nIGVzdGltYXRpb24gb2YgdGhlIGVycm9yIHJhdGVzIGFuZCBpbmZlcmVuY2Ugb2Ygc2FtcGxlIGNvbXBvc2l0aW9uCnVudGlsIHRoZXkgY29udmVyZ2Ugb24gYSBqb2ludGx5IGNvbnNpc3RlbnQgc29sdXRpb24uCgpgYGB7ciBsZWFybl9lcnJvcnN9CnByaW50KCdMZWFybmluZyBlcnJvcnMuLi4nKQpTeXMudGltZSgpCgplcnJfRiA8LSBsZWFybkVycm9ycyhmYXN0cXNfZGVyZXBfRiwgbXVsdGl0aHJlYWQgPSBUUlVFLCB2ZXJib3NlID0gVFJVRSkKZXJyX1IgPC0gbGVhcm5FcnJvcnMoZmFzdHFzX2RlcmVwX1IsIG11bHRpdGhyZWFkID0gVFJVRSwgdmVyYm9zZSA9IFRSVUUpCgpwcmludCgnLi4uRG9uZSEnKQpTeXMudGltZSgpCmBgYAoKYGBge3IsIGVjaG89RkFMU0V9CnNhdmVSRFMoZXJyX0YsIGZpbGUgPSBmaWxlLnBhdGgob3V0ZGlyLCAnZXJyX0YucmRzJykpCnNhdmVSRFMoZXJyX1IsIGZpbGUgPSBmaWxlLnBhdGgob3V0ZGlyLCAnZXJyX1IucmRzJykpCiMgZXJyX0YgPC0gcmVhZFJEUyhmaWxlLnBhdGgob3V0ZGlyLCAnZXJyX0YucmRzJykpCiMgZXJyX1IgPC0gcmVhZFJEUyhmaWxlLnBhdGgob3V0ZGlyLCAnZXJyX1IucmRzJykpCmBgYAoKPGJyPgoKUGxvdCBlcnJvcnMgdG8gdmVyaWZ5IHRoYXQgZXJyb3IgcmF0ZXMgaGF2ZSBiZWVuIHJlYXNvbmFibGUgd2VsbC1lc3RpbWF0ZWQuCk9ic2VydmUgdGhlIGZpdCBiZXR3ZWVuIG9ic2VydmVkIGVycm9yIHJhdGVzIChwb2ludHMpIGFuZCBmaXR0ZWQgZXJyb3IKcmF0ZXMgKGxpbmVzKToKCmBgYHtyLCBwbG90X2Vycm9yc30KcGxvdEVycm9ycyhlcnJfRiwgbm9taW5hbFEgPSBUUlVFKQpwbG90RXJyb3JzKGVycl9SLCBub21pbmFsUSA9IFRSVUUpCmBgYAoKLS0tLS0KCiMjIFN0ZXAgNTogSW5mZXIgQVNWcwoKV2Ugd2lsbCBydW4gdGhlIGRhZGEgYWxnb3JpdGhtIHRvIGluZmVyIEFtcGxpY29uIFNlcXVlbmNlIFZhcmlhbnRzIChBU1ZzKS4KClRoaXMgc3RlcCBpcyBxdWl0ZSBjb21wdXRhdGlvbmFsbHkgaW50ZW5zaXZlLAphbmQgd2Ugd2lsbCB0aGVyZWZvcmUgcGVyZm9ybSBpbmRlcGVuZGVudCBpbmZlcmVuY2UgZm9yIGVhY2ggc2FtcGxlIChgcG9vbCA9IEZBTFNFYCksCndoaWNoIHdpbGwga2VlcCBtZW1vcnkgdXNhZ2UgbGluZWFyIHRvIHRoZSBzYW1wbGUgbnVtYmVyLgpQb29saW5nIHdpbGwgaW5jcmVhc2UgbWVtb3J5IHJxdWlyZW1lbnRzIGFuZCBjb21wdXRhdGlvbiB0aW1lLApidXQgaW1wcm92ZSBkZXRlY3Rpb24gb2YgcmFyZSB2YXJpYW50cyBzZWVuIG9uY2Ugb3IgdHdpY2UgaW4gYW4gaW5kaXZpZHVhbCBzYW1wbGUsCmJ1dCBtYW55IHRpbWVzIGFjcm9zcyBhbGwgc2FtcGxlcy4KCmBgYHtyIHJ1bl9kYWRhfQpwcmludCgnSW5mZXJyaW5nIEFTVnMgKHJ1bm5pbmcgdGhlIGRhZGEgYWxnb3JpdGhtKS4uLicpClN5cy50aW1lKCkKCmRhZGFfRnMgPC0gZGFkYShmYXN0cXNfZGVyZXBfRiwgZXJyID0gZXJyX0YsIHBvb2wgPSBGQUxTRSwgbXVsdGl0aHJlYWQgPSBUUlVFKQpkYWRhX1JzIDwtIGRhZGEoZmFzdHFzX2RlcmVwX1IsIGVyciA9IGVycl9SLCBwb29sID0gRkFMU0UsIG11bHRpdGhyZWFkID0gVFJVRSkKCnByaW50KCcuLi5Eb25lLicpClN5cy50aW1lKCkKYGBgCgpgYGB7ciwgZWNobz1GQUxTRX0Kc2F2ZVJEUyhkYWRhX0ZzLCBmaWxlID0gZmlsZS5wYXRoKG91dGRpciwgJ2RhZGFfRnMucmRzJykpCnNhdmVSRFMoZGFkYV9ScywgZmlsZSA9IGZpbGUucGF0aChvdXRkaXIsICdkYWRhX1JzLnJkcycpKQojIGRhZGFfRnMgPC0gcmVhZFJEUyhmaWxlLnBhdGgob3V0ZGlyLCAnZGFkYV9Gcy5yZHMnKSkKIyBkYWRhX1JzIDwtIHJlYWRSRFMoZmlsZSA9IGZpbGUucGF0aChvdXRkaXIsICdkYWRhX1JzLnJkcycpKQpgYGAKCkxldCdzIGluc3BlY3Qgb25lIG9mIHRoZSByZXN1bHRpbmcgb2JqZWN0czoKCmBgYGB7ciwgY2hlY2tfZGFkYX0KZGFkYV9Gc1tbMV1dCmBgYAoKLS0tLS0KCiMjIFN0ZXAgNjogTWVyZ2UgUmVhZCBQYWlycwoKSW4gdGhpcyBzdGVwLCB3ZSB3aWxsIGZpcnN0IG1lcmdlIHRoZSBmb3J3YXJkIGFuZCByZXZlcnNlIHJlYWQgcGFpcnM6CnRoZSBmcmFnbWVudCB0aGF0IHdlIGFtcGxpZmllZCB3aXRoIG91ciBwcmltZXJzIHdhcyBzaG9ydCBlbm91Z2gKdG8gZ2VuZXJhdGUgbG90cyBvZiBvdmVybGFwIGFtb25nIHRoZSBzZXF1ZW5jZXMgZnJvbSB0aGUgdHdvIGRpcmVjdGlvbnMuCgpgYGB7ciBtZXJnZV9wYWlyc30KbWVyZ2VycyA8LSBtZXJnZVBhaXJzKGRhZGFfRnMsIGZhc3Rxc19kZXJlcF9GLAogICAgICAgICAgICAgICAgICAgICAgZGFkYV9ScywgZmFzdHFzX2RlcmVwX1IsCiAgICAgICAgICAgICAgICAgICAgICB2ZXJib3NlID0gVFJVRSkKYGBgCgpgYGB7ciwgZWNobz1GQUxTRX0Kc2F2ZVJEUyhtZXJnZXJzLCBmaWxlID0gZmlsZS5wYXRoKG91dGRpciwgJ21lcmdlcnMucmRzJykpCiMgbWVyZ2VycyA8LSByZWFkUkRTKGZpbGUucGF0aChvdXRkaXIsICdtZXJnZXJzLnJkcycpKQpgYGAKCgo8YnI+CgpKdXN0IGxpa2UgdGFibGVzIGNhbiBiZSBzYXZlZCBpbiBSIHVzaW5nIGB3cml0ZS50YWJsZWAgb3IgYHdyaXRlLmNzdmAsClIgKm9iamVjdHMqIGNhbiBiZSBzYXZlZCB1c2luZyBgc2F2ZVJEU2AuClRoZSByZXN1bHRpbmcgLnJkcyBmaWxlIGNhbiB0aGVuIGJlIGxvYWRlZCBpbnRvIGFuIFIgZW52aXJvbm1lbnQgdXNpbmcgYHJlYWRSRFNgLgpUaGlzIGlzIGEgY29udmVuaWVudCB3YXkgdG8gc2F2ZSBSIG9iamVjdHMgdGhhdCByZXF1aXJlIGEgbG90IG9mIGNvbXB1dGF0aW9uIHRpbWUuCgpXZSBzaG91bGQgbm90IGJlIG5lZWRpbmcgdGhlIHZlcnkgbGFyZ2UgZGVyZXBsaWNhdGVkIHNlcXVlbmNlIG9iamVjdHMgYW55bW9yZSwKYnV0IHRvIGJlIGFibGUgdG8gcXVpY2tseSByZXN0YXJ0IG91ciBhbmFseXNpcyBmcm9tIGEgbmV3IFIgc2Vzc2lvbgppZiBuZWNlc3NhcnksIHdlIG5vdyBzYXZlIHRoZXNlIG9iamVjdHMgdG8gUkRTIGZpbGVzLgpBbmQgYWZ0ZXIgdGhhdCwgd2UgY2FuIHNhZmVseSByZW1vdmUgdGhlc2Ugb2JqZWN0cyBmcm9tIG91ciBlbnZpcm9ubWVudC4KCmBgYHtyLCBzYXZlX1JEU30Kc2F2ZVJEUyhmYXN0cXNfZGVyZXBfRiwgZmlsZSA9IGZpbGUucGF0aChvdXRkaXIsICdmYXN0cXNfZGVyZXBfRi5yZHMnKSkKc2F2ZVJEUyhmYXN0cXNfZGVyZXBfUiwgZmlsZSA9IGZpbGUucGF0aChvdXRkaXIsICdmYXN0cXNfZGVyZXBfUi5yZHMnKSkKCnJtKGZhc3Rxc19kZXJlcF9GLCBmYXN0cXNfZGVyZXBfUikgIyBSZW1vdmUgb2JqZWN0cyBmcm9tIGVudmlyb25tZW50CmBgYAoKLS0tLS0KCiMjIFN0ZXAgNzogQ29uc3RydWN0IGEgU2VxdWVuY2UgVGFibGUKCk5leHQsIHdlIGNvbnN0cnVjdCBhbiBhbXBsaWNvbiBzZXF1ZW5jZSB2YXJpYW50IHRhYmxlIChBU1YpIHRhYmxlOgoKYGBge3IgbWFrZV9zZXF0YWJ9CnNlcXRhYl9hbGwgPC0gbWFrZVNlcXVlbmNlVGFibGUobWVyZ2VycykKCiMgVGhlIGRpbWVuc2lvbnMgb2YgdGhlIG9iamVjdCBhcmUgdGhlIG5yIG9mIHNhbXBsZXMgKHJvd3MpIGFuZCB0aGUgbnIgb2YgQVNWcyAoY29sdW1ucyk6CmRpbShzZXF0YWJfYWxsKQpgYGAKCkxldCdzIGluc3BlY3QgdGhlIGRpc3RyaWJ1dGlvbiBvZiBzZXF1ZW5jZSBsZW5ndGhzOgoKYGBge3IgY2hlY2tfc2VxdGFifQp0YWJsZShuY2hhcihnZXRTZXF1ZW5jZXMoc2VxdGFiX2FsbCkpKQoKIyBJZiB5b3UgbmVlZCB0byByZW1vdmUgc2VxdWVuY2VzIG9mIGEgcGFydGljdWxhciBsZW5ndGggKGUuZy4gdG9vIGxvbmcpOgojIHNlcXRhYjIgPC0gc2VxdGFiWywgbmNoYXIoY29sbmFtZXMoc2VxdGFiX2FsbCkpICVpbiUgc2VxKDI1MCwyNTYpXQpgYGAKCgotLS0tLQoKIyMgU3RlcCA4OiBSZW1vdmUgQ2hpbWVyYXMKCk5vdywgd2Ugd2lsbCByZW1vdmUgY2hpbWVyYXMuClRoZSBgZGFkYWAgYWxnb3JpdGhtIG1vZGVscyBhbmQgcmVtb3ZlcyBzdWJzdGl0dXRpb24gZXJyb3JzLApidXQgY2hpbWVyYXMgYXJlIGFub3RoZXIgaW1wb3J0YW5jZSBzb3VyY2Ugb2Ygc3B1cmlvdXMgc2VxdWVuY2VzIGluIGFtcGxpY29uIHNlcXVlbmNpbmcuIENoaW1lcmFzIGFyZSBmb3JtZWQgZHVyaW5nIFBDUiBhbXBsaWZpY2F0aW9uLgpXaGVuIG9uZSBzZXF1ZW5jZSBpcyBpbmNvbXBsZXRlbHkgYW1wbGlmaWVkLCB0aGUgaW5jb21wbGV0ZSBhbXBsaWNvbiBwcmltZXMgdGhlCm5leHQgYW1wbGlmaWNhdGlvbiBzdGVwLCB5aWVsZGluZyBhIHNwdXJpb3VzIGFtcGxpY29uLgpUaGUgcmVzdWx0IGlzIGEgc2VxdWVuY2UgcmVhZCB3aGljaCBpcyBoYWxmIG9mIG9uZSBzYW1wbGUgc2VxdWVuY2UgYW5kIGhhbGYgYW5vdGhlci4KCkZvcnR1bmF0ZWx5LCB0aGUgYWNjdXJhY3kgb2YgdGhlIHNlcXVlbmNlIHZhcmlhbnRzIGFmdGVyIGRlbm9pc2luZyBtYWtlcyBpZGVudGlmeWluZyBjaGltZXJhcyBzaW1wbGVyIHRoYW4gaXQgaXMgd2hlbiBkZWFsaW5nIHdpdGggZnV6enkgT1RVcy4KQ2hpbWVyaWMgc2VxdWVuY2VzIGFyZSBpZGVudGlmaWVkIGlmIHRoZXkgY2FuIGJlIGV4YWN0bHkgcmVjb25zdHJ1Y3RlZCBieSBjb21iaW5pbmcgYSBsZWZ0LXNlZ21lbnQgYW5kIGEgcmlnaHQtc2VnbWVudCBmcm9tIHR3byBtb3JlIGFidW5kYW50ICJwYXJlbnQiIHNlcXVlbmNlcy4KCmBgYHtyIHJtX2NoaW19CnNlcXRhYiA8LSByZW1vdmVCaW1lcmFEZW5vdm8oc2VxdGFiX2FsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSAnY29uc2Vuc3VzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aXRocmVhZCA9IFRSVUUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyYm9zZSA9IFRSVUUpCm5jb2woc2VxdGFiKQoKIyBQcm9wb3J0aW9uIG9mIHJldGFpbmVkIHNlcXVlbmNlczoKc3VtKHNlcXRhYikgLyBzdW0oc2VxdGFiX2FsbCkKYGBgCgpXZSB3aWxsIHNhdmUgdGhlIGBzZXF0YWJgIG9iamVjdCBhcyBhbiBSRFMgZmlsZToKCmBgYHtyLCBzYXZlX1JEU18yfQpzYXZlUkRTKHNlcXRhYiwgZmlsZSA9IGZpbGUucGF0aChvdXRkaXIsICdzZXF0YWJfVjQucmRzJykpCmBgYAoKYGBge3IsIGVjaG89RkFMU0UsIGV2YWw9RkFMU0UsIHB1cmw9RkFMU0V9CiMgc2VxdGFiIDwtIHJlYWRSRFMoZmlsZS5wYXRoKG91dGRpciwgJ3NlcXRhYl9WNC5yZHMnKSkKYGBgCgotLS0tLQoKIyMgU3RlcCA5OiBHZW5lcmF0ZSBhIFN1bW1hcnkgVGFibGUKCkluIHRoaXMgc3RlcCwgd2Ugd2lsbCBnZW5lcmF0ZSBhIHN1bW1hcnkgdGFibGUgb2YgdGhlIG51bWJlciBvZiBzZXF1ZW5jZXMKcHJvY2Vzc2VkIGFuZCBvdXRwdXRzIG9mIGRpZmZlcmVudCBzdGVwcyBvZiB0aGUgcGlwZWxpbmUuCgpUaGlzIGluZm9ybWF0aW9uIGlzIGdlbmVyYWxseSB1c2VkIHRvIGZ1cnRoZXIgZXZhbHVhdGUgY2hhcmFjdGVyaXN0aWNzIGFuZApxdWFsaXR5IG9mIHRoZSBydW4sIHNhbXBsZS10by1zYW1wbGUgdmFyaWF0aW9uLAphbmQgcmVzdWx0aW5nIHNlcXVlbmNpbmcgZGVwdGggZm9yIGVhY2ggc2FtcGxlLiAKCmBgYHtyIHN1bV90YWJsZX0KIyBXZSBkZWZpbmUgYSBmdW5jdGlvbiBgZ2V0TmAsIHdoaWNoIHdpbGwgZ2V0IHRoZSBuciBvZiB1bmlxdWUgcmVhZHMgZm9yIGEgc2FtcGxlOiAKZ2V0TiA8LSBmdW5jdGlvbih4KSBzdW0oZ2V0VW5pcXVlcyh4KSkKCiMgV2UgYXBwbHkgdGhlIGdldE4gZnVuY3Rpb24gdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBkYWRhX0ZzLCBkYWRhX1JzLCBhbmQgbWVyZ2VycyBvYmplY3RzOgojIFRoaXMgZ2l2ZXMgdXMgYSB2ZWN0b3Igd2l0aCB0aGUgbnVtYmVyIG9mIHVuaXF1ZSByZWFkcyBmb3IgZWFjaCBzYW1wbGVzLAojIGZvciBlYWNoIG9mIHRoZXNlIHN0ZXBzOgpkZW5vaXNlZF9GIDwtIHNhcHBseShkYWRhX0ZzLCBnZXROKQpkZW5vaXNlZF9SIDwtIHNhcHBseShkYWRhX1JzLCBnZXROKQptZXJnZWQgPC0gc2FwcGx5KG1lcmdlcnMsIGdldE4pCgojIFdlIGpvaW4gdGhlc2UgdmVjdG9ycyB0b2dldGhlciB3aXRoIHRoZSAiZmlsdGVyX3Jlc3VsdHMiIGRhdGFmcmFtZSwKIyBhbmQgdGhlIG51bWJlciBvZiBub25jaGltZXJpYyByZWFkczoKbnJlYWRzX3N1bW1hcnkgPC0gZGF0YS5mcmFtZShmaWx0ZXJfcmVzdWx0cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZW5vaXNlZF9GLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbm9pc2VkX1IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9uY2hpbSA9IHJvd1N1bXMoc2VxdGFiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cubmFtZXMgPSBzYW1wbGVJRHMpCmNvbG5hbWVzKG5yZWFkc19zdW1tYXJ5KVsxOjJdIDwtIGMoJ2lucHV0JywgJ2ZpbHRlcmVkJykKCiMgSGF2ZSBhIGxvb2sgYXQgdGhlIGZpcnN0IGZldyByb3dzOgpoZWFkKG5yZWFkc19zdW1tYXJ5KQoKIyBXZSdsbCB3cml0ZSB0aGlzIHRhYmxlIHRvIGZpbGU6CndyaXRlLnRhYmxlKG5yZWFkc19zdW1tYXJ5LCBmaWxlID0gZmlsZS5wYXRoKG91dGRpciwgJ25yZWFkc19zdW1tYXJ5LnR4dCcpLAogICAgICAgICAgICBzZXAgPSAiXHQiLCBxdW90ZSA9IEZBTFNFLCByb3cubmFtZXMgPSBUUlVFKQpgYGAKCi0tLS0tCgojIyBTdGVwIDEwOiBBc3NpZ24gVGF4b25vbXkgdG8gQVNWcwoKTm93LCB3ZSB3aWxsIGFzc2lnbiB0YXhvbm9teSB0byBvdXIgQVNWcy4KCkRlcGVuZGluZyBvbiB0aGUgbWFya2VyIGdlbmUgYW5kIHRoZSBkYXRhLAp5b3Ugd2lsbCBoYXZlIHRvIGNob29zZSB0aGUgYXBwcm9wcmlhdGUgcmVmZXJlbmNlIGZpbGUgZm9yIHRoaXMgc3RlcC4KClNldmVyYWwgZmlsZXMgaGF2ZSBiZWVuIGZvcm1hdHRlZCBmb3IgdGF4b25vbXkgYXNzaWdubWVudHMgaW4gREFEQTIgcGlwZWxpbmUgYW5kIGFyZSBhdmFpbGFibGUgYXQgdGhlIFtEQURBMiB3ZWJzaXRlXShodHRwczovL2JlbmpqbmViLmdpdGh1Yi5pby9kYWRhMi9pbmRleC5odG1sKS4KCmBgYHtyIGFzc2lnbl90YXh9CnByaW50KCdBc3NpZ25pbmcgdGF4YSB0byBBU1ZzLi4uJykKU3lzLnRpbWUoKQoKdGF4YSA8LSBhc3NpZ25UYXhvbm9teShzZXF0YWIsIHRheF9rZXksIG11bHRpdGhyZWFkID0gVFJVRSkKY29sbmFtZXModGF4YSkgPC0gYygnS2luZ2RvbScsICdQaHlsdW0nLCAnQ2xhc3MnLCAnT3JkZXInLCAnRmFtaWx5JywgJ0dlbnVzJykKCnByaW50KCcuLi5Eb25lLicpClN5cy50aW1lKCkKYGBgCgpgYGB7ciwgZWNobz1GQUxTRX0Kc2F2ZVJEUyh0YXhhLCBmaWxlID0gZmlsZS5wYXRoKG91dGRpciwgJ3RheGEucmRzJykpCiMgdGF4YSA8LSByZWFkUkRTKGZpbGUucGF0aChvdXRkaXIsICd0YXhhLnJkcycpKQpgYGAKCi0tLS0tCgojIyBTdGVwIDExOiBHZW5lcmF0ZSBPdXRwdXQgRmlsZXMKCkluIHRoaXMgc3RlcCwgd2Ugd2lsbCBnZW5lcmF0ZSBvdXRwdXQgZmlsZXMgZm9ybWF0dGVkIGZvciBkb3duc3RyZWFtIGFuYWx5c2lzCmluICpwaHlsb3NlcSouCkRhdGEgd2lsbCBiZSBleHRyYWN0ZWQgZnJvbSB0aGUgREFEQTIgb3V0cHV0cyBhbmQgZm9ybWF0dGVkIGZvciBkb3duc3RyZWFtCmFuYWx5c2lzIGFuZCBkYXRhIGluc3BlY3Rpb24uClRoZSBsYXN0IHN0ZXAgb2YgdGhpcyBwaXBlbGluZSBzYXZlcyBhICpwaHlsb3NlcSogb2JqZWN0IGFzIGFuIC5SRFMgZmlsZSwKd2hpY2ggY2FuIGJlIGltcG9ydGVkIGRpcmVjdGx5IGJ5ICpwaHlsb3NlcSouCgpGaXJzdCwgd2Ugd2lsbCB3cml0ZSBhIGZhc3RhIGZpbGUgd2l0aCB0aGUgZmluYWwgQVNWIHNlcXVlbmNlcy4KVGhpcyBmYXN0YSBmaWxlIGNhbiBhbHNvIGJlIHVzZWQgZm9yIHBoeWxvZ2VuZXRpYyB0cmVlIGluZmVyZW5jZSBpbiBkaWZmZXJlbnQgcGxhdGZvcm1zLgoKYGBge3Igd3JpdGVfZmFzdGF9CiMgUHJlcGFyZSBzZXF1ZW5jZXMgYW5kIGhlYWRlcnM6CmFzdl9zZXFzIDwtIGNvbG5hbWVzKHNlcXRhYikKYXN2X2hlYWRlcnMgPC0gcGFzdGUoJz5BU1YnLCAxOm5jb2woc2VxdGFiKSwgc2VwID0gJ18nKQoKIyBJbnRlcmxlYXZlIGhlYWRlcnMgYW5kIHNlcXVlbmNlczoKYXN2X2Zhc3RhIDwtIGMocmJpbmQoYXN2X2hlYWRlcnMsIGFzdl9zZXFzKSkKCiMgV3JpdGUgZmFzdGEgZmlsZToKd3JpdGUoYXN2X2Zhc3RhLCBmaWxlID0gZmlsZS5wYXRoKG91dGRpciwgJ0FTVnMuZmEnKSkKYGBgCgpCdWlsZCB0aGUgZmluYWwgKnBoeWxvc2VxKiBvYmplY3QuIE5vdGVzOgoKICAtIFdoaWxlIHdlIHdpbGwgbm90IGFkZCBwaHlsb2dlbmV0aWMgdHJlZSBub3csCiAgICB0aGlzIGNhbiBhbHNvIGJlIGFkZGVkIHRvIGEgKnBoeWxvc2VxKiBvYmplY3QuCgogIC0gT3VyIG1ldGFkYXRhIGRhdGFmcmFtZSBjb250YWlucyB0aHJlZSBzYW1wbGVzIHRoYXQgd2UgZG9uJ3QgaGF2ZSBzZXF1ZW5jZXMgZm9yLgogICAgSG93ZXZlciwgdGhpcyBpcyBub3QgYSBwcm9ibGVtOiAqcGh5bG9zZXEqIHdpbGwgbWF0Y2ggdGhlIHNhbXBsZSBJRHMgaW4gdGhlCiAgICBtZXRhZGF0YSB3aXRoIHRob3NlIGluIHRoZSBPVFUgdGFibGUsIGFuZCBkaXNyZWdhcmQgSURzIG5vdCBwcmVzZW50IGluIHRoZQogICAgT1RVIHRhYmxlLgoKYGBge3IgbWtfcGh5bG9zZXF9CnBzIDwtIHBoeWxvc2VxKG90dV90YWJsZShzZXF0YWIsIHRheGFfYXJlX3Jvd3MgPSBGQUxTRSksCiAgICAgICAgICAgICAgIHNhbXBsZV9kYXRhKG1ldGFkYXRhX2RmKSwKICAgICAgICAgICAgICAgdGF4X3RhYmxlKHRheGEpKQoKc2F2ZVJEUyhwcywgZmlsZSA9IGZpbGUucGF0aChvdXRkaXIsICdwc19WNC5yZHMnKSkKYGBgCgpSZXBvcnQgdGhhdCB3ZSBhcmUgZG9uZSEKCmBgYHtyIHJlcG9ydF9kb25lfQpwcmludCgnRG9uZSB3aXRoIEFTViBpbmZlcmVuY2UuJykKYGBgCgotLS0tLQoKIyMgUmVzb3VyY2VzCgotIFtDYWxsYWhhbiBldCBhbC4gMjAwNjogIkJpb2NvbmR1Y3RvciBXb3JrZmxvdyBmb3IgTWljcm9iaW9tZSBEYXRhIEFuYWx5c2lzOiBmcm9tIHJhdyByZWFkcyB0byBjb21tdW5pdHkgYW5hbHlzZXMiXShodHRwczovL2YxMDAwcmVzZWFyY2guY29tL2FydGljbGVzLzUtMTQ5Mi92MikKLSBbYGRhZGEyYCBkb2N1bWVudGF0aW9uIGFuZCB0dXRvcmlhbHNdKGh0dHBzOi8vYmVuampuZWIuZ2l0aHViLmlvL2RhZGEyL2luZGV4Lmh0bWwgKQotIFtUYXhvbm9taWMgcmVmZXJlbmNlcyBmb3IgYGRhZGEyYF0oaHR0cHM6Ly9iZW5qam5lYi5naXRodWIuaW8vZGFkYTIvdHJhaW5pbmcuaHRtbCkKLSBbYGN1dGFkYXB0YCBkb2N1bWVudGF0aW9uIGFuZCB0dXRvcmlhbHNdKGh0dHBzOi8vY3V0YWRhcHQucmVhZHRoZWRvY3MuaW8vZW4vc3RhYmxlL2luZGV4Lmh0bWwpCgoKLS0tLS0KCiMjIEJvbnVzOiBQaHlsb2dlbmV0aWMgVHJlZSBFc3RpbWF0aW9uCgpBIHBoeWxvZ2VuZXRpYyB0cmVlIGNhbiBiZSBlc3RpbWF0ZWQgZm9yIHRoZSBzZXF1ZW5jZSBkYXRhIHlvdSBnZW5lcmF0ZWQuCkRlcGVuZGluZyBvbiB0aGUgbnVtYmVyIG9mIEFTVnMgcmVjb3ZlcmVkIGFuZCB0aGUgcGh5bG9nZW5ldGljIHRyZWUgYWxnb3JpdGhtIG9mIGNob2ljZSwgdGhpcyBzdGVwIGNvdWxkIHRha2Ugc2V2ZXJhbCBkYXlzLgpTaW1wbGVyIHRyZWVzIHdpbGwgYmUgbGVzcyBjb21wdXRhdGlvbmFsbHkgaW50ZW5zaXZlLiBEZXBlbmRpbmcgb24gdGhlIG1hcmtlciBnZW5lIHlvdSBhcmUgd29ya2luZyBvbiwgeW91IG1pZ2h0IGNob29zZSBvciBub3QgdG8gdXNlIHRoaXMgb3B0aW9uLgoKVGhpcyBzdGVwIGNhbiBiZSBjb25kdWN0ZWQgYWZ0ZXIgU3RlcCAxMCwKYW5kIHRoZW4gdGhlIHBoeWxvZ2VueSBjYW4gYmUgaW5jbHVkZWQgaW4gdGhlICpwaHlsb3NlcSogb2JqZWN0IGluIFN0ZXAgMTEuCgpgYGB7ciwgZXZhbCA9IEZBTFNFfQojc2VxdGFiPC0gcmVhZFJEUygnc2VxdGFiX1Y0LnJkcycpCgpzZXFzIDwtIGdldFNlcXVlbmNlcyhzZXF0YWIpCgojIFRoaXMgcHJvcGFnYXRlcyB0byB0aGUgdGlwIGxhYmVscyBvZiB0aGUgdHJlZS4KIyBBdCB0aGlzIHN0YWdlIEFTViBsYWJlbHMgYXJlIGZ1bGwgQVNWIHNlcXVlbmNlCm5hbWVzKHNlcXMpIDwtIHNlcXMgCmFsaWdubWVudCA8LSBBbGlnblNlcXMoRE5BU3RyaW5nU2V0KHNlcXMpLAogICAgICAgICAgICAgICAgICAgICAgIGFuY2hvciA9IE5BLAogICAgICAgICAgICAgICAgICAgICAgIGl0ZXJhdGlvbnMgPSA1LAogICAgICAgICAgICAgICAgICAgICAgIHJlZmluZW1lbnRzID0gNSkKCnByaW50KCdDb21wdXRpbmcgcGFpcndpc2UgZGlzdGFuY2VzIGZyb20gQVNWcy4uLicpClN5cy50aW1lKCkKcGhhbmcuYWxpZ24gPC0gcGh5RGF0KGFzKGFsaWdubWVudCwgJ21hdHJpeCcpLCB0eXBlID0gJ0ROQScpCmRtIDwtIGRpc3QubWwocGhhbmcuYWxpZ24pCnRyZWVOSiA8LSBOSihkbSkgIyBOb3RlLCB0aXAgb3JkZXIgaXMgbm90IHNlcXVlbmNlIG9yZGVyCmZpdCA9IHBtbCh0cmVlTkosIGRhdGEgPSBwaGFuZy5hbGlnbikKcHJpbnQoJy4uLkRvbmUuJykKU3lzLnRpbWUoKQoKcHJpbnQoJy4uLi4nKQpTeXMudGltZSgpCmZpdEdUUiA8LSB1cGRhdGUoZml0LCBrID0gNCwgaW52ID0gMC4yKQpwcmludCgnLi4uRG9uZS4nKQpTeXMudGltZSgpCgpwcmludCgnQ29tcHV0aW5nIGxpa2VsaWhvb2Qgb2YgdHJlZS4uLicpClN5cy50aW1lKCkKZml0R1RSIDwtIG9wdGltLnBtbChmaXRHVFIsCiAgICAgICAgICAgICAgICAgICAgbW9kZWwgPSAnR1RSJywKICAgICAgICAgICAgICAgICAgICBvcHRJbnYgPSBUUlVFLAogICAgICAgICAgICAgICAgICAgIG9wdEdhbW1hID0gVFJVRSwKICAgICAgICAgICAgICAgICAgICByZWFycmFuZ2VtZW50ID0gJ3N0b2NoYXN0aWMnLAogICAgICAgICAgICAgICAgICAgIGNvbnRyb2wgPSBwbWwuY29udHJvbCh0cmFjZSA9IDApKQpwcmludCgnLi4uRG9uZScuKQpTeXMudGltZSgpCmBgYAoKLS0tLS0KCiMjIEJvbnVzOiBTdWJtaXQgc2NyaXB0IGFzIGFuIE9TQyBqb2IKCkV4dHJhY3QgUiBjb2RlIGZyb20gdGhpcyBkb2N1bWVudDoKYGBge3IsIGV2YWwgPSBGQUxTRX0Ka25pdHI6OnB1cmwoaW5wdXQgPSAnbWFya2Rvd24vMDctQVNWLWluZmVyZW5jZS5SbWQnLAogICAgICAgICAgICBvdXRwdXQgPSAnc2NyaXB0cy8wMi1BU1YtaW5mZXJlbmNlLlInKQpgYGAKCk91ciBzY3JpcHQgYDAyLUFTVi1pbmZlcmVuY2Uuc2hgIHdpdGggKlNMVVJNKiBkaXJlY3RpdmVzIHRoYXQgd2lsbCBzdWJtaXQgdGhlIFIKc2NyaXB0IGZyb20gdGhlIHNoZWxsIHVzaW5nIGBSc2NyaXB0YDoKCmBgYHtiYXNoLCBldmFsID0gRkFMU0V9CiMhL2Jpbi9iYXNoCiNTQkFUQ0ggLS1ub2Rlcz0xCiNTQkFUQ0ggLS1udGFza3MtcGVyLW5vZGU9OAojU0JBVENIIC0tdGltZT0yOjAwOjAwCiNTQkFUQ0ggLS1hY2NvdW50PVBBUzA0NzEKCm1vZHVsZSBsb2FkIGdudS85LjEuMAptb2R1bGUgbG9hZCBta2wvMjAxOS4wLjUKbW9kdWxlIGxvYWQgUi80LjAuMgoKUnNjcmlwdCBzY3JpcHRzLzAyLUFTVi1pbmZlcmVuY2UuUgpgYGAKClN1Ym1pdCB0aGUgc2NyaXB0OgoKYGBge2Jhc2gsIGV2YWwgPSBGQUxTRX0Kc2JhdGNoIHNjcmlwdHMvMDItQVNWLWluZmVyZW5jZS5zaApgYGAKCjxicj48YnI+Cg==</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("07-ASV-inference.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
